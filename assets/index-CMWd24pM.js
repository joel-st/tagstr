(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const Jg=!1,Xg=(e,t)=>e===t,Rn=Symbol("solid-proxy"),xo=Symbol("solid-track"),bi={equals:Xg};let rf=cf;const hn=1,mi=2,sf={owned:null,cleanups:null,context:null,owner:null};var le=null;let Ms=null,Qg=null,ne=null,Se=null,Rt=null,ji=0;function ai(e,t){const n=ne,r=le,i=e.length===0,s=t===void 0?r:t,o=i?sf:{owned:null,cleanups:null,context:s?s.context:null,owner:s},a=i?e:()=>e(()=>Ln(()=>Or(o)));le=o,ne=null;try{return dr(a,!0)}finally{ne=n,le=r}}function de(e,t){t=t?Object.assign({},bi,t):bi;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(n.value)),af(n,i));return[of.bind(n),r]}function re(e,t,n){const r=la(e,t,!1,hn);zr(r)}function Eo(e,t,n){rf=ny;const r=la(e,t,!1,hn);r.user=!0,Rt?Rt.push(r):zr(r)}function Zn(e,t,n){n=n?Object.assign({},bi,n):bi;const r=la(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,zr(r),of.bind(r)}function Yg(e){return dr(e,!1)}function Ln(e){if(ne===null)return e();const t=ne;ne=null;try{return e()}finally{ne=t}}function ca(e){Eo(()=>Ln(e))}function Wi(e){return le===null||(le.cleanups===null?le.cleanups=[e]:le.cleanups.push(e)),e}function $o(){return ne}function of(){if(this.sources&&this.state)if(this.state===hn)zr(this);else{const e=Se;Se=null,dr(()=>Ei(this),!1),Se=e}if(ne){const e=this.observers?this.observers.length:0;ne.sources?(ne.sources.push(this),ne.sourceSlots.push(e)):(ne.sources=[this],ne.sourceSlots=[e]),this.observers?(this.observers.push(ne),this.observerSlots.push(ne.sources.length-1)):(this.observers=[ne],this.observerSlots=[ne.sources.length-1])}return this.value}function af(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&dr(()=>{for(let i=0;i<e.observers.length;i+=1){const s=e.observers[i],o=Ms&&Ms.running;o&&Ms.disposed.has(s),(o?!s.tState:!s.state)&&(s.pure?Se.push(s):Rt.push(s),s.observers&&lf(s)),o||(s.state=hn)}if(Se.length>1e6)throw Se=[],new Error},!1)),t}function zr(e){if(!e.fn)return;Or(e);const t=ji;ey(e,e.value,t)}function ey(e,t,n){let r;const i=le,s=ne;ne=le=e;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=hn,e.owned&&e.owned.forEach(Or),e.owned=null),e.updatedAt=n+1,uf(o)}finally{ne=s,le=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?af(e,r):e.value=r,e.updatedAt=n)}function la(e,t,n,r=hn,i){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:le,context:le?le.context:null,pure:n};return le===null||le!==sf&&(le.owned?le.owned.push(s):le.owned=[s]),s}function xi(e){if(e.state===0)return;if(e.state===mi)return Ei(e);if(e.suspense&&Ln(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ji);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===hn)zr(e);else if(e.state===mi){const r=Se;Se=null,dr(()=>Ei(e,t[0]),!1),Se=r}}function dr(e,t){if(Se)return e();let n=!1;t||(Se=[]),Rt?n=!0:Rt=[],ji++;try{const r=e();return ty(n),r}catch(r){n||(Rt=null),Se=null,uf(r)}}function ty(e){if(Se&&(cf(Se),Se=null),e)return;const t=Rt;Rt=null,t.length&&dr(()=>rf(t),!1)}function cf(e){for(let t=0;t<e.length;t++)xi(e[t])}function ny(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:xi(r)}for(t=0;t<n;t++)xi(e[t])}function Ei(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const i=r.state;i===hn?r!==t&&(!r.updatedAt||r.updatedAt<ji)&&xi(r):i===mi&&Ei(r,t)}}}function lf(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=mi,n.pure?Se.push(n):Rt.push(n),n.observers&&lf(n))}}function Or(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),o=n.observerSlots.pop();r<i.length&&(s.sourceSlots[o]=r,i[r]=s,n.observerSlots[r]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Or(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Or(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function ry(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function uf(e,t=le){throw ry(e)}const iy=Symbol("fallback");function Rl(e){for(let t=0;t<e.length;t++)e[t]()}function sy(e,t,n={}){let r=[],i=[],s=[],o=0,a=t.length>1?[]:null;return Wi(()=>Rl(s)),()=>{let c=e()||[],l=c.length,u,f;return c[xo],Ln(()=>{let h,g,p,y,v,$,S,_,I;if(l===0)o!==0&&(Rl(s),s=[],r=[],i=[],o=0,a&&(a=[])),n.fallback&&(r=[iy],i[0]=ai(k=>(s[0]=k,n.fallback())),o=1);else if(o===0){for(i=new Array(l),f=0;f<l;f++)r[f]=c[f],i[f]=ai(d);o=l}else{for(p=new Array(l),y=new Array(l),a&&(v=new Array(l)),$=0,S=Math.min(o,l);$<S&&r[$]===c[$];$++);for(S=o-1,_=l-1;S>=$&&_>=$&&r[S]===c[_];S--,_--)p[_]=i[S],y[_]=s[S],a&&(v[_]=a[S]);for(h=new Map,g=new Array(_+1),f=_;f>=$;f--)I=c[f],u=h.get(I),g[f]=u===void 0?-1:u,h.set(I,f);for(u=$;u<=S;u++)I=r[u],f=h.get(I),f!==void 0&&f!==-1?(p[f]=i[u],y[f]=s[u],a&&(v[f]=a[u]),f=g[f],h.set(I,f)):s[u]();for(f=$;f<l;f++)f in p?(i[f]=p[f],s[f]=y[f],a&&(a[f]=v[f],a[f](f))):i[f]=ai(d);i=i.slice(0,o=l),r=c.slice(0)}return i});function d(h){if(s[f]=h,a){const[g,p]=de(f);return a[f]=p,t(c[f],g)}return t(c[f])}}}function q(e,t){return Ln(()=>e(t||{}))}const oy=e=>`Stale read from <${e}>.`;function ln(e){const t="fallback"in e&&{fallback:()=>e.fallback};return Zn(sy(()=>e.each,e.children,t||void 0))}function Fe(e){const t=e.keyed,n=Zn(()=>e.when,void 0,void 0),r=t?n:Zn(n,void 0,{equals:(i,s)=>!i==!s});return Zn(()=>{const i=r();if(i){const s=e.children;return typeof s=="function"&&s.length>0?Ln(()=>s(t?i:()=>{if(!Ln(r))throw oy("Show");return n()})):s}return e.fallback},void 0,void 0)}const ke=e=>Zn(()=>e());function ay(e,t,n){let r=n.length,i=t.length,s=r,o=0,a=0,c=t[i-1].nextSibling,l=null;for(;o<i||a<s;){if(t[o]===n[a]){o++,a++;continue}for(;t[i-1]===n[s-1];)i--,s--;if(i===o){const u=s<r?a?n[a-1].nextSibling:n[s-a]:c;for(;a<s;)e.insertBefore(n[a++],u)}else if(s===a)for(;o<i;)(!l||!l.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[s-1]&&n[a]===t[i-1]){const u=t[--i].nextSibling;e.insertBefore(n[a++],t[o++].nextSibling),e.insertBefore(n[--s],u),t[i]=n[s]}else{if(!l){l=new Map;let f=a;for(;f<s;)l.set(n[f],f++)}const u=l.get(t[o]);if(u!=null)if(a<u&&u<s){let f=o,d=1,h;for(;++f<i&&f<s&&!((h=l.get(t[f]))==null||h!==u+d);)d++;if(d>u-a){const g=t[o];for(;a<u;)e.insertBefore(n[a++],g)}else e.replaceChild(n[a++],t[o++])}else o++;else t[o++].remove()}}}const Ll="_$DX_DELEGATE";function cy(e,t,n,r={}){let i;return ai(s=>{i=s,t===document?e():T(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function D(e,t,n,r){let i;const s=()=>{const a=document.createElement("template");return a.innerHTML=e,a.content.firstChild},o=()=>(i||(i=s())).cloneNode(!0);return o.cloneNode=o,o}function Vr(e,t=window.document){const n=t[Ll]||(t[Ll]=new Set);for(let r=0,i=e.length;r<i;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,ly))}}function De(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function Jn(e,t){t==null?e.removeAttribute("class"):e.className=t}function kr(e,t,n){if(!t)return n?De(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let i,s;for(s in n)t[s]==null&&r.removeProperty(s),delete n[s];for(s in t)i=t[s],i!==n[s]&&(r.setProperty(s,i),n[s]=i);return n}function T(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return $i(e,t,r,n);re(i=>$i(e,t(),i,n),r)}function ly(e){let t=e.target;const n=`$$${e.type}`,r=e.target,i=e.currentTarget,s=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),o=()=>{const c=t[n];if(c&&!t.disabled){const l=t[`${n}Data`];if(l!==void 0?c.call(t,l,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},a=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const c=e.composedPath();s(c[0]);for(let l=0;l<c.length-2&&(t=c[l],!!o());l++){if(t._$host){t=t._$host,a();break}if(t.parentNode===i)break}}else a();s(r)}function $i(e,t,n,r,i){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,o=r!==void 0;if(e=o&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(s==="number"&&(t=t.toString(),t===n))return n;if(o){let a=n[0];a&&a.nodeType===3?a.data!==t&&(a.data=t):a=document.createTextNode(t),n=Fn(e,n,r,a)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean")n=Fn(e,n,r);else{if(s==="function")return re(()=>{let a=t();for(;typeof a=="function";)a=a();n=$i(e,a,n,r)}),()=>n;if(Array.isArray(t)){const a=[],c=n&&Array.isArray(n);if(So(a,t,n,i))return re(()=>n=$i(e,a,n,r,!0)),()=>n;if(a.length===0){if(n=Fn(e,n,r),o)return n}else c?n.length===0?Tl(e,a,r):ay(e,n,a):(n&&Fn(e),Tl(e,a));n=a}else if(t.nodeType){if(Array.isArray(n)){if(o)return n=Fn(e,n,r,t);Fn(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function So(e,t,n,r){let i=!1;for(let s=0,o=t.length;s<o;s++){let a=t[s],c=n&&n[e.length],l;if(!(a==null||a===!0||a===!1))if((l=typeof a)=="object"&&a.nodeType)e.push(a);else if(Array.isArray(a))i=So(e,a,c)||i;else if(l==="function")if(r){for(;typeof a=="function";)a=a();i=So(e,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||i}else e.push(a),i=!0;else{const u=String(a);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return i}function Tl(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function Fn(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let s=!1;for(let o=t.length-1;o>=0;o--){const a=t[o];if(i!==a){const c=a.parentNode===e;!s&&!o?c?e.replaceChild(i,a):e.insertBefore(i,n):c&&a.remove()}else s=!0}}else e.insertBefore(i,n);return[i]}const[ff,df]=de(window.location.hash||"#/"),Si=e=>{const t=e.startsWith("#")?e:`#${e}`;window.location.hash=t,df(t)},uy=()=>{const e=ff().replace("#",""),t=e.split("/");return e.startsWith("/hashtag/")&&t.length>=3?{tag:decodeURIComponent(t[2])}:{}},fy=()=>{const e=()=>{df(window.location.hash||"#/")};return window.addEventListener("hashchange",e),window.location.hash||Si("/"),()=>{window.removeEventListener("hashchange",e)}},dy=()=>ff().replace("#","").startsWith("/hashtag/")?"hashtag":"home",_i=Symbol("store-raw"),Xn=Symbol("store-node"),Et=Symbol("store-has"),hf=Symbol("store-self");function pf(e){let t=e[Rn];if(!t&&(Object.defineProperty(e,Rn,{value:t=new Proxy(e,gy)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let i=0,s=n.length;i<s;i++){const o=n[i];r[o].get&&Object.defineProperty(e,o,{enumerable:r[o].enumerable,get:r[o].get.bind(t)})}}return t}function nr(e){let t;return e!=null&&typeof e=="object"&&(e[Rn]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function rr(e,t=new Set){let n,r,i,s;if(n=e!=null&&e[_i])return n;if(!nr(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let o=0,a=e.length;o<a;o++)i=e[o],(r=rr(i,t))!==i&&(e[o]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const o=Object.keys(e),a=Object.getOwnPropertyDescriptors(e);for(let c=0,l=o.length;c<l;c++)s=o[c],!a[s].get&&(i=e[s],(r=rr(i,t))!==i&&(e[s]=r))}return e}function ki(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Nr(e,t,n){if(e[t])return e[t];const[r,i]=de(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function hy(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===Rn||t===Xn||(delete n.value,delete n.writable,n.get=()=>e[Rn][t]),n}function gf(e){$o()&&Nr(ki(e,Xn),hf)()}function py(e){return gf(e),Reflect.ownKeys(e)}const gy={get(e,t,n){if(t===_i)return e;if(t===Rn)return n;if(t===xo)return gf(e),n;const r=ki(e,Xn),i=r[t];let s=i?i():e[t];if(t===Xn||t===Et||t==="__proto__")return s;if(!i){const o=Object.getOwnPropertyDescriptor(e,t);$o()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(o&&o.get)&&(s=Nr(r,t,s)())}return nr(s)?pf(s):s},has(e,t){return t===_i||t===Rn||t===xo||t===Xn||t===Et||t==="__proto__"?!0:($o()&&Nr(ki(e,Et),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:py,getOwnPropertyDescriptor:hy};function ir(e,t,n,r=!1){if(!r&&e[t]===n)return;const i=e[t],s=e.length;n===void 0?(delete e[t],e[Et]&&e[Et][t]&&i!==void 0&&e[Et][t].$()):(e[t]=n,e[Et]&&e[Et][t]&&i===void 0&&e[Et][t].$());let o=ki(e,Xn),a;if((a=Nr(o,t,i))&&a.$(()=>n),Array.isArray(e)&&e.length!==s){for(let c=e.length;c<s;c++)(a=o[c])&&a.$();(a=Nr(o,"length",s))&&a.$(e.length)}(a=o[hf])&&a.$()}function yf(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const i=n[r];ir(e,i,t[i])}}function yy(e,t){if(typeof t=="function"&&(t=t(e)),t=rr(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const i=t[n];e[n]!==i&&ir(e,n,i)}ir(e,"length",r)}else yf(e,t)}function Ar(e,t,n=[]){let r,i=e;if(t.length>1){r=t.shift();const o=typeof r,a=Array.isArray(e);if(Array.isArray(r)){for(let c=0;c<r.length;c++)Ar(e,[r[c]].concat(t),n);return}else if(a&&o==="function"){for(let c=0;c<e.length;c++)r(e[c],c)&&Ar(e,[c].concat(t),n);return}else if(a&&o==="object"){const{from:c=0,to:l=e.length-1,by:u=1}=r;for(let f=c;f<=l;f+=u)Ar(e,[f].concat(t),n);return}else if(t.length>1){Ar(e[r],t,[r].concat(n));return}i=e[r],n=[r].concat(n)}let s=t[0];typeof s=="function"&&(s=s(i,n),s===i)||r===void 0&&s==null||(s=rr(s),r===void 0||nr(i)&&nr(s)&&!Array.isArray(s)?yf(i,s):ir(e,r,s))}function Kr(...[e,t]){const n=rr(e||{}),r=Array.isArray(n),i=pf(n);function s(...o){Yg(()=>{r&&o.length===1?yy(n,o[0]):Ar(n,o)})}return[i,s]}const Ai=new WeakMap,wf={get(e,t){if(t===_i)return e;const n=e[t];let r;return nr(n)?Ai.get(n)||(Ai.set(n,r=new Proxy(n,wf)),r):n},set(e,t,n){return ir(e,t,rr(n)),!0},deleteProperty(e,t){return ir(e,t,void 0,!0),!0}};function qi(e){return t=>{if(nr(t)){let n;(n=Ai.get(t))||Ai.set(t,n=new Proxy(t,wf)),e(n)}return t}}const ei={SETTINGS:"tagstr_settings"},Il={theme:"wireframe",autoRefresh:!0,refreshInterval:3e4,maxEvents:1e3,defaultSort:"count",relaySettings:{autoDiscover:!0,maxRelays:999999,timeout:5e3,minTrustScore:2,trustDecayHours:168,discoveryInterval:3e4}};class wy{getSettings(){try{const t=localStorage.getItem(ei.SETTINGS);if(t)return{...Il,...JSON.parse(t)}}catch(t){console.warn("Failed to load settings from storage:",t)}return Il}saveSettings(t){try{localStorage.setItem(ei.SETTINGS,JSON.stringify(t))}catch(n){console.error("Failed to save settings:",n)}}exportSettings(){return this.getSettings()}importSettings(t){try{this.saveSettings(t),console.log("Settings imported successfully")}catch(n){throw console.error("Failed to import settings:",n),n}}clearSettings(){localStorage.removeItem(ei.SETTINGS),console.log("Settings cleared")}getStorageInfo(){let t=0,n=0;try{const r=localStorage.getItem(ei.SETTINGS);return r&&(t=r.length*2),n=10*1024*1024,{used:t,available:n-t,quota:n,percentage:t/n*100}}catch{return{used:0,available:0,quota:0,percentage:0}}}}const ci=new wy;function Ul(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function vf(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function vy(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Ul(e.outputLen),Ul(e.blockLen)}function Ci(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function by(e,t){vf(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Ps=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const bf=e=>e instanceof Uint8Array,Hs=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),et=(e,t)=>e<<32-t|e>>>t,my=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!my)throw new Error("Non little-endian hardware is not supported");function xy(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ua(e){if(typeof e=="string"&&(e=xy(e)),!bf(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Ey(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!bf(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let mf=class{clone(){return this._cloneInto()}};function $y(e){const t=r=>e().update(ua(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function xf(e=32){if(Ps&&typeof Ps.getRandomValues=="function")return Ps.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Sy(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}let _y=class extends mf{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Hs(this.buffer)}update(t){Ci(this);const{view:n,buffer:r,blockLen:i}=this;t=ua(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Hs(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ci(this),by(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;Sy(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Hs(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}};const ky=(e,t,n)=>e&t^~e&n,Ay=(e,t,n)=>e&t^e&n^t&n,Cy=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Xt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qt=new Uint32Array(64);let Ry=class extends _y{constructor(){super(64,32,8,!1),this.A=Xt[0]|0,this.B=Xt[1]|0,this.C=Xt[2]|0,this.D=Xt[3]|0,this.E=Xt[4]|0,this.F=Xt[5]|0,this.G=Xt[6]|0,this.H=Xt[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)Qt[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=Qt[f-15],h=Qt[f-2],g=et(d,7)^et(d,18)^d>>>3,p=et(h,17)^et(h,19)^h>>>10;Qt[f]=p+Qt[f-7]+g+Qt[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const d=et(a,6)^et(a,11)^et(a,25),h=u+d+ky(a,c,l)+Cy[f]+Qt[f]|0,p=(et(r,2)^et(r,13)^et(r,22))+Ay(r,i,s)|0;u=l,l=c,c=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){Qt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const _o=$y(()=>new Ry);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ef=BigInt(0),zi=BigInt(1),Ly=BigInt(2),Vi=e=>e instanceof Uint8Array,Ty=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function sr(e){if(!Vi(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ty[e[n]];return t}function $f(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function fa(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function or(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const i=r*2,s=e.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function Te(e){return fa(sr(e))}function da(e){if(!Vi(e))throw new Error("Uint8Array expected");return fa(sr(Uint8Array.from(e).reverse()))}function dn(e,t){return or(e.toString(16).padStart(t*2,"0"))}function ha(e,t){return dn(e,t).reverse()}function Iy(e){return or($f(e))}function ye(e,t,n){let r;if(typeof t=="string")try{r=or(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(Vi(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function Tn(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!Vi(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Uy(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Oy(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Ny(e){let t;for(t=0;e>Ef;e>>=zi,t+=1);return t}function By(e,t){return e>>BigInt(t)&zi}const My=(e,t,n)=>e|(n?zi:Ef)<<BigInt(t),pa=e=>(Ly<<BigInt(e-1))-zi,Fs=e=>new Uint8Array(e),Ol=e=>Uint8Array.from(e);function Sf(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Fs(e),i=Fs(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...f)=>n(i,r,...f),c=(f=Fs())=>{i=a(Ol([0]),f),r=a(),f.length!==0&&(i=a(Ol([1]),f),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<t;){r=a();const h=r.slice();d.push(h),f+=r.length}return Tn(...d)};return(f,d)=>{o(),c(f);let h;for(;!(h=d(l()));)c();return o(),h}}const Py={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Gr(e,t,n={}){const r=(i,s,o)=>{const a=Py[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=e[i];if(!(o&&c===void 0)&&!a(c,e))throw new Error(`Invalid param ${String(i)}=${c} (${typeof c}), expected ${s}`)};for(const[i,s]of Object.entries(t))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return e}const Hy=Object.freeze(Object.defineProperty({__proto__:null,bitGet:By,bitLen:Ny,bitMask:pa,bitSet:My,bytesToHex:sr,bytesToNumberBE:Te,bytesToNumberLE:da,concatBytes:Tn,createHmacDrbg:Sf,ensureBytes:ye,equalBytes:Uy,hexToBytes:or,hexToNumber:fa,numberToBytesBE:dn,numberToBytesLE:ha,numberToHexUnpadded:$f,numberToVarBytesBE:Iy,utf8ToBytes:Oy,validateObject:Gr},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fe=BigInt(0),ie=BigInt(1),_n=BigInt(2),Fy=BigInt(3),ko=BigInt(4),Nl=BigInt(5),Bl=BigInt(8);BigInt(9);BigInt(16);function pe(e,t){const n=e%t;return n>=fe?n:t+n}function Dy(e,t,n){if(n<=fe||t<fe)throw new Error("Expected power/modulo > 0");if(n===ie)return fe;let r=ie;for(;t>fe;)t&ie&&(r=r*e%n),e=e*e%n,t>>=ie;return r}function Me(e,t,n){let r=e;for(;t-- >fe;)r*=r,r%=n;return r}function Ao(e,t){if(e===fe||t<=fe)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=pe(e,t),r=t,i=fe,s=ie;for(;n!==fe;){const a=r/n,c=r%n,l=i-s*a;r=n,n=c,i=s,s=l}if(r!==ie)throw new Error("invert: does not exist");return pe(i,t)}function jy(e){const t=(e-ie)/_n;let n,r,i;for(n=e-ie,r=0;n%_n===fe;n/=_n,r++);for(i=_n;i<e&&Dy(i,t,e)!==e-ie;i++);if(r===1){const o=(e+ie)/ko;return function(c,l){const u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}const s=(n+ie)/_n;return function(a,c){if(a.pow(c,t)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,u=a.pow(a.mul(a.ONE,i),n),f=a.pow(c,s),d=a.pow(c,n);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let h=1;for(let p=a.sqr(d);h<l&&!a.eql(p,a.ONE);h++)p=a.sqr(p);const g=a.pow(u,ie<<BigInt(l-h-1));u=a.sqr(g),f=a.mul(f,g),d=a.mul(d,u),l=h}return f}}function Wy(e){if(e%ko===Fy){const t=(e+ie)/ko;return function(r,i){const s=r.pow(i,t);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(e%Bl===Nl){const t=(e-Nl)/Bl;return function(r,i){const s=r.mul(i,_n),o=r.pow(s,t),a=r.mul(i,o),c=r.mul(r.mul(a,_n),o),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),i))throw new Error("Cannot find square root");return l}}return jy(e)}const qy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function zy(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=qy.reduce((r,i)=>(r[i]="function",r),t);return Gr(e,n)}function Vy(e,t,n){if(n<fe)throw new Error("Expected power > 0");if(n===fe)return e.ONE;if(n===ie)return t;let r=e.ONE,i=t;for(;n>fe;)n&ie&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ie;return r}function Ky(e,t){const n=new Array(t.length),r=t.reduce((s,o,a)=>e.is0(o)?s:(n[a]=s,e.mul(s,o)),e.ONE),i=e.inv(r);return t.reduceRight((s,o,a)=>e.is0(o)?s:(n[a]=e.mul(s,n[a]),e.mul(s,o)),i),n}function _f(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Gy(e,t,n=!1,r={}){if(e<=fe)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:s}=_f(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Wy(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:pa(i),ZERO:fe,ONE:ie,create:c=>pe(c,e),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return fe<=c&&c<e},is0:c=>c===fe,isOdd:c=>(c&ie)===ie,neg:c=>pe(-c,e),eql:(c,l)=>c===l,sqr:c=>pe(c*c,e),add:(c,l)=>pe(c+l,e),sub:(c,l)=>pe(c-l,e),mul:(c,l)=>pe(c*l,e),pow:(c,l)=>Vy(a,c,l),div:(c,l)=>pe(c*Ao(l,e),e),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ao(c,e),sqrt:r.sqrt||(c=>o(a,c)),invertBatch:c=>Ky(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?ha(c,s):dn(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?da(c):Te(c)}});return Object.freeze(a)}function kf(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Af(e){const t=kf(e);return t+Math.ceil(t/2)}function Zy(e,t,n=!1){const r=e.length,i=kf(t),s=Af(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=n?Te(e):da(e),a=pe(o,t-ie)+ie;return n?ha(a,i):dn(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Jy=BigInt(0),Ds=BigInt(1);function Xy(e,t){const n=(i,s)=>{const o=s.negate();return i?o:s},r=i=>{const s=Math.ceil(t/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:n,unsafeLadder(i,s){let o=e.ZERO,a=i;for(;s>Jy;)s&Ds&&(o=o.add(a)),a=a.double(),s>>=Ds;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=r(s),c=[];let l=i,u=l;for(let f=0;f<o;f++){u=l,c.push(u);for(let d=1;d<a;d++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(i,s,o){const{windows:a,windowSize:c}=r(i);let l=e.ZERO,u=e.BASE;const f=BigInt(2**i-1),d=2**i,h=BigInt(i);for(let g=0;g<a;g++){const p=g*c;let y=Number(o&f);o>>=h,y>c&&(y-=d,o+=Ds);const v=p,$=p+Math.abs(y)-1,S=g%2!==0,_=y<0;y===0?u=u.add(n(S,s[v])):l=l.add(n(_,s[$]))}return{p:l,f:u}},wNAFCached(i,s,o,a){const c=i._WINDOW_SIZE||1;let l=s.get(i);return l||(l=this.precomputeWindow(i,c),c!==1&&s.set(i,a(l))),this.wNAF(c,l,o)}}}function Cf(e){return zy(e.Fp),Gr(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({..._f(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Qy(e){const t=Cf(e);Gr(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:Yy,hexToBytes:ew}=Hy,kn={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=kn;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Yy(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=kn,n=typeof e=="string"?ew(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:s}=kn._parseInt(n.subarray(2)),{d:o,l:a}=kn._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){const t=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{const u=l.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),i=t(n(e.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},$t=BigInt(0),He=BigInt(1);BigInt(2);const Ml=BigInt(3);BigInt(4);function tw(e){const t=Qy(e),{Fp:n}=t,r=t.toBytes||((g,p,y)=>{const v=p.toAffine();return Tn(Uint8Array.from([4]),n.toBytes(v.x),n.toBytes(v.y))}),i=t.fromBytes||(g=>{const p=g.subarray(1),y=n.fromBytes(p.subarray(0,n.BYTES)),v=n.fromBytes(p.subarray(n.BYTES,2*n.BYTES));return{x:y,y:v}});function s(g){const{a:p,b:y}=t,v=n.sqr(g),$=n.mul(v,g);return n.add(n.add($,n.mul(g,p)),y)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(g){return typeof g=="bigint"&&$t<g&&g<t.n}function a(g){if(!o(g))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(g){const{allowedPrivateKeyLengths:p,nByteLength:y,wrapPrivateKey:v,n:$}=t;if(p&&typeof g!="bigint"){if(g instanceof Uint8Array&&(g=sr(g)),typeof g!="string"||!p.includes(g.length))throw new Error("Invalid key");g=g.padStart(y*2,"0")}let S;try{S=typeof g=="bigint"?g:Te(ye("private key",g,y))}catch{throw new Error(`private key must be ${y} bytes, hex or bigint, not ${typeof g}`)}return v&&(S=pe(S,$)),a(S),S}const l=new Map;function u(g){if(!(g instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(p,y,v){if(this.px=p,this.py=y,this.pz=v,p==null||!n.isValid(p))throw new Error("x required");if(y==null||!n.isValid(y))throw new Error("y required");if(v==null||!n.isValid(v))throw new Error("z required")}static fromAffine(p){const{x:y,y:v}=p||{};if(!p||!n.isValid(y)||!n.isValid(v))throw new Error("invalid affine point");if(p instanceof f)throw new Error("projective point not allowed");const $=S=>n.eql(S,n.ZERO);return $(y)&&$(v)?f.ZERO:new f(y,v,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(p){const y=n.invertBatch(p.map(v=>v.pz));return p.map((v,$)=>v.toAffine(y[$])).map(f.fromAffine)}static fromHex(p){const y=f.fromAffine(i(ye("pointHex",p)));return y.assertValidity(),y}static fromPrivateKey(p){return f.BASE.multiply(c(p))}_setWindowSize(p){this._WINDOW_SIZE=p,l.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:p,y}=this.toAffine();if(!n.isValid(p)||!n.isValid(y))throw new Error("bad point: x or y not FE");const v=n.sqr(y),$=s(p);if(!n.eql(v,$))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:p}=this.toAffine();if(n.isOdd)return!n.isOdd(p);throw new Error("Field doesn't support isOdd")}equals(p){u(p);const{px:y,py:v,pz:$}=this,{px:S,py:_,pz:I}=p,k=n.eql(n.mul(y,I),n.mul(S,$)),R=n.eql(n.mul(v,I),n.mul(_,$));return k&&R}negate(){return new f(this.px,n.neg(this.py),this.pz)}double(){const{a:p,b:y}=t,v=n.mul(y,Ml),{px:$,py:S,pz:_}=this;let I=n.ZERO,k=n.ZERO,R=n.ZERO,A=n.mul($,$),H=n.mul(S,S),M=n.mul(_,_),w=n.mul($,S);return w=n.add(w,w),R=n.mul($,_),R=n.add(R,R),I=n.mul(p,R),k=n.mul(v,M),k=n.add(I,k),I=n.sub(H,k),k=n.add(H,k),k=n.mul(I,k),I=n.mul(w,I),R=n.mul(v,R),M=n.mul(p,M),w=n.sub(A,M),w=n.mul(p,w),w=n.add(w,R),R=n.add(A,A),A=n.add(R,A),A=n.add(A,M),A=n.mul(A,w),k=n.add(k,A),M=n.mul(S,_),M=n.add(M,M),A=n.mul(M,w),I=n.sub(I,A),R=n.mul(M,H),R=n.add(R,R),R=n.add(R,R),new f(I,k,R)}add(p){u(p);const{px:y,py:v,pz:$}=this,{px:S,py:_,pz:I}=p;let k=n.ZERO,R=n.ZERO,A=n.ZERO;const H=t.a,M=n.mul(t.b,Ml);let w=n.mul(y,S),m=n.mul(v,_),x=n.mul($,I),L=n.add(y,v),b=n.add(S,_);L=n.mul(L,b),b=n.add(w,m),L=n.sub(L,b),b=n.add(y,$);let E=n.add(S,I);return b=n.mul(b,E),E=n.add(w,x),b=n.sub(b,E),E=n.add(v,$),k=n.add(_,I),E=n.mul(E,k),k=n.add(m,x),E=n.sub(E,k),A=n.mul(H,b),k=n.mul(M,x),A=n.add(k,A),k=n.sub(m,A),A=n.add(m,A),R=n.mul(k,A),m=n.add(w,w),m=n.add(m,w),x=n.mul(H,x),b=n.mul(M,b),m=n.add(m,x),x=n.sub(w,x),x=n.mul(H,x),b=n.add(b,x),w=n.mul(m,b),R=n.add(R,w),w=n.mul(E,b),k=n.mul(L,k),k=n.sub(k,w),w=n.mul(L,m),A=n.mul(E,A),A=n.add(A,w),new f(k,R,A)}subtract(p){return this.add(p.negate())}is0(){return this.equals(f.ZERO)}wNAF(p){return h.wNAFCached(this,l,p,y=>{const v=n.invertBatch(y.map($=>$.pz));return y.map(($,S)=>$.toAffine(v[S])).map(f.fromAffine)})}multiplyUnsafe(p){const y=f.ZERO;if(p===$t)return y;if(a(p),p===He)return this;const{endo:v}=t;if(!v)return h.unsafeLadder(this,p);let{k1neg:$,k1:S,k2neg:_,k2:I}=v.splitScalar(p),k=y,R=y,A=this;for(;S>$t||I>$t;)S&He&&(k=k.add(A)),I&He&&(R=R.add(A)),A=A.double(),S>>=He,I>>=He;return $&&(k=k.negate()),_&&(R=R.negate()),R=new f(n.mul(R.px,v.beta),R.py,R.pz),k.add(R)}multiply(p){a(p);let y=p,v,$;const{endo:S}=t;if(S){const{k1neg:_,k1:I,k2neg:k,k2:R}=S.splitScalar(y);let{p:A,f:H}=this.wNAF(I),{p:M,f:w}=this.wNAF(R);A=h.constTimeNegate(_,A),M=h.constTimeNegate(k,M),M=new f(n.mul(M.px,S.beta),M.py,M.pz),v=A.add(M),$=H.add(w)}else{const{p:_,f:I}=this.wNAF(y);v=_,$=I}return f.normalizeZ([v,$])[0]}multiplyAndAddUnsafe(p,y,v){const $=f.BASE,S=(I,k)=>k===$t||k===He||!I.equals($)?I.multiplyUnsafe(k):I.multiply(k),_=S(this,y).add(S(p,v));return _.is0()?void 0:_}toAffine(p){const{px:y,py:v,pz:$}=this,S=this.is0();p==null&&(p=S?n.ONE:n.inv($));const _=n.mul(y,p),I=n.mul(v,p),k=n.mul($,p);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(k,n.ONE))throw new Error("invZ was invalid");return{x:_,y:I}}isTorsionFree(){const{h:p,isTorsionFree:y}=t;if(p===He)return!0;if(y)return y(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:p,clearCofactor:y}=t;return p===He?this:y?y(f,this):this.multiplyUnsafe(t.h)}toRawBytes(p=!0){return this.assertValidity(),r(f,this,p)}toHex(p=!0){return sr(this.toRawBytes(p))}}f.BASE=new f(t.Gx,t.Gy,n.ONE),f.ZERO=new f(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,h=Xy(f,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function nw(e){const t=Cf(e);return Gr(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function rw(e){const t=nw(e),{Fp:n,n:r}=t,i=n.BYTES+1,s=2*n.BYTES+1;function o(b){return $t<b&&b<n.ORDER}function a(b){return pe(b,r)}function c(b){return Ao(b,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:f,isWithinCurveOrder:d}=tw({...t,toBytes(b,E,C){const B=E.toAffine(),N=n.toBytes(B.x),F=Tn;return C?F(Uint8Array.from([E.hasEvenY()?2:3]),N):F(Uint8Array.from([4]),N,n.toBytes(B.y))},fromBytes(b){const E=b.length,C=b[0],B=b.subarray(1);if(E===i&&(C===2||C===3)){const N=Te(B);if(!o(N))throw new Error("Point is not on curve");const F=f(N);let O=n.sqrt(F);const P=(O&He)===He;return(C&1)===1!==P&&(O=n.neg(O)),{x:N,y:O}}else if(E===s&&C===4){const N=n.fromBytes(B.subarray(0,n.BYTES)),F=n.fromBytes(B.subarray(n.BYTES,2*n.BYTES));return{x:N,y:F}}else throw new Error(`Point of length ${E} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),h=b=>sr(dn(b,t.nByteLength));function g(b){const E=r>>He;return b>E}function p(b){return g(b)?a(-b):b}const y=(b,E,C)=>Te(b.slice(E,C));class v{constructor(E,C,B){this.r=E,this.s=C,this.recovery=B,this.assertValidity()}static fromCompact(E){const C=t.nByteLength;return E=ye("compactSignature",E,C*2),new v(y(E,0,C),y(E,C,2*C))}static fromDER(E){const{r:C,s:B}=kn.toSig(ye("DER",E));return new v(C,B)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new v(this.r,this.s,E)}recoverPublicKey(E){const{r:C,s:B,recovery:N}=this,F=R(ye("msgHash",E));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const O=N===2||N===3?C+t.n:C;if(O>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const P=N&1?"03":"02",K=l.fromHex(P+h(O)),ae=c(O),We=a(-F*ae),Be=a(B*ae),Ie=l.BASE.multiplyAndAddUnsafe(K,We,Be);if(!Ie)throw new Error("point at infinify");return Ie.assertValidity(),Ie}hasHighS(){return g(this.s)}normalizeS(){return this.hasHighS()?new v(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return or(this.toDERHex())}toDERHex(){return kn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return or(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const $={isValidPrivateKey(b){try{return u(b),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const b=Af(t.n);return Zy(t.randomBytes(b),t.n)},precompute(b=8,E=l.BASE){return E._setWindowSize(b),E.multiply(BigInt(3)),E}};function S(b,E=!0){return l.fromPrivateKey(b).toRawBytes(E)}function _(b){const E=b instanceof Uint8Array,C=typeof b=="string",B=(E||C)&&b.length;return E?B===i||B===s:C?B===2*i||B===2*s:b instanceof l}function I(b,E,C=!0){if(_(b))throw new Error("first arg must be private key");if(!_(E))throw new Error("second arg must be public key");return l.fromHex(E).multiply(u(b)).toRawBytes(C)}const k=t.bits2int||function(b){const E=Te(b),C=b.length*8-t.nBitLength;return C>0?E>>BigInt(C):E},R=t.bits2int_modN||function(b){return a(k(b))},A=pa(t.nBitLength);function H(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!($t<=b&&b<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return dn(b,t.nByteLength)}function M(b,E,C=w){if(["recovered","canonical"].some(wt=>wt in C))throw new Error("sign() legacy options not supported");const{hash:B,randomBytes:N}=t;let{lowS:F,prehash:O,extraEntropy:P}=C;F==null&&(F=!0),b=ye("msgHash",b),O&&(b=ye("prehashed msgHash",B(b)));const K=R(b),ae=u(E),We=[H(ae),H(K)];if(P!=null){const wt=P===!0?N(n.BYTES):P;We.push(ye("extraEntropy",wt))}const Be=Tn(...We),Ie=K;function yt(wt){const Gt=k(wt);if(!d(Gt))return;const Qr=c(Gt),Ue=l.BASE.multiply(Gt).toAffine(),Zt=a(Ue.x);if(Zt===$t)return;const mn=a(Qr*a(Ie+Zt*ae));if(mn===$t)return;let xr=(Ue.x===Zt?0:2)|Number(Ue.y&He),j=mn;return F&&g(mn)&&(j=p(mn),xr^=1),new v(Zt,j,xr)}return{seed:Be,k2sig:yt}}const w={lowS:t.lowS,prehash:!1},m={lowS:t.lowS,prehash:!1};function x(b,E,C=w){const{seed:B,k2sig:N}=M(b,E,C),F=t;return Sf(F.hash.outputLen,F.nByteLength,F.hmac)(B,N)}l.BASE._setWindowSize(8);function L(b,E,C,B=m){const N=b;if(E=ye("msgHash",E),C=ye("publicKey",C),"strict"in B)throw new Error("options.strict was renamed to lowS");const{lowS:F,prehash:O}=B;let P,K;try{if(typeof N=="string"||N instanceof Uint8Array)try{P=v.fromDER(N)}catch(Ue){if(!(Ue instanceof kn.Err))throw Ue;P=v.fromCompact(N)}else if(typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint"){const{r:Ue,s:Zt}=N;P=new v(Ue,Zt)}else throw new Error("PARSE");K=l.fromHex(C)}catch(Ue){if(Ue.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(F&&P.hasHighS())return!1;O&&(E=t.hash(E));const{r:ae,s:We}=P,Be=R(E),Ie=c(We),yt=a(Be*Ie),wt=a(ae*Ie),Gt=l.BASE.multiplyAndAddUnsafe(K,yt,wt)?.toAffine();return Gt?a(Gt.x)===ae:!1}return{CURVE:t,getPublicKey:S,getSharedSecret:I,sign:x,verify:L,ProjectivePoint:l,Signature:v,utils:$}}let Rf=class extends mf{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,vy(t);const r=ua(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return Ci(this),this.iHash.update(t),this}digestInto(t){Ci(this),vf(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Lf=(e,t,n)=>new Rf(e,t).update(n).digest();Lf.create=(e,t)=>new Rf(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function iw(e){return{hash:e,hmac:(t,...n)=>Lf(e,t,Ey(...n)),randomBytes:xf}}function sw(e,t){const n=r=>rw({...e,...iw(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ki=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ri=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Tf=BigInt(1),Li=BigInt(2),Pl=(e,t)=>(e+t/Li)/t;function If(e){const t=Ki,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,u=l*l*e%t,f=Me(u,n,t)*u%t,d=Me(f,n,t)*u%t,h=Me(d,Li,t)*l%t,g=Me(h,i,t)*h%t,p=Me(g,s,t)*g%t,y=Me(p,a,t)*p%t,v=Me(y,c,t)*y%t,$=Me(v,a,t)*p%t,S=Me($,n,t)*u%t,_=Me(S,o,t)*g%t,I=Me(_,r,t)*l%t,k=Me(I,Li,t);if(!Co.eql(Co.sqr(k),e))throw new Error("Cannot find square root");return k}const Co=Gy(Ki,void 0,void 0,{sqrt:If}),Le=sw({a:BigInt(0),b:BigInt(7),Fp:Co,n:Ri,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Ri,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Tf*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=Pl(s*e,t),c=Pl(-r*e,t);let l=pe(e-a*n-c*i,t),u=pe(-a*r-c*s,t);const f=l>o,d=u>o;if(f&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:f,k1:l,k2neg:d,k2:u}}}},_o),Gi=BigInt(0),Uf=e=>typeof e=="bigint"&&Gi<e&&e<Ki,ow=e=>typeof e=="bigint"&&Gi<e&&e<Ri,Hl={};function Ti(e,...t){let n=Hl[e];if(n===void 0){const r=_o(Uint8Array.from(e,i=>i.charCodeAt(0)));n=Tn(r,r),Hl[e]=n}return _o(Tn(n,...t))}const ga=e=>e.toRawBytes(!0).slice(1),Ro=e=>dn(e,32),js=e=>pe(e,Ki),Br=e=>pe(e,Ri),ya=Le.ProjectivePoint,aw=(e,t,n)=>ya.BASE.multiplyAndAddUnsafe(e,t,n);function Lo(e){let t=Le.utils.normPrivateKeyToScalar(e),n=ya.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Br(-t),bytes:ga(n)}}function Of(e){if(!Uf(e))throw new Error("bad x: need 0 < x < p");const t=js(e*e),n=js(t*e+BigInt(7));let r=If(n);r%Li!==Gi&&(r=js(-r));const i=new ya(e,r,Tf);return i.assertValidity(),i}function Nf(...e){return Br(Te(Ti("BIP0340/challenge",...e)))}function cw(e){return Lo(e).bytes}function lw(e,t,n=xf(32)){const r=ye("message",e),{bytes:i,scalar:s}=Lo(t),o=ye("auxRand",n,32),a=Ro(s^Te(Ti("BIP0340/aux",o))),c=Ti("BIP0340/nonce",a,i,r),l=Br(Te(c));if(l===Gi)throw new Error("sign failed: k is zero");const{bytes:u,scalar:f}=Lo(l),d=Nf(u,i,r),h=new Uint8Array(64);if(h.set(u,0),h.set(Ro(Br(f+d*s)),32),!Bf(h,r,i))throw new Error("sign: Invalid signature produced");return h}function Bf(e,t,n){const r=ye("signature",e,64),i=ye("message",t),s=ye("publicKey",n,32);try{const o=Of(Te(s)),a=Te(r.subarray(0,32));if(!Uf(a))return!1;const c=Te(r.subarray(32,64));if(!ow(c))return!1;const l=Nf(Ro(a),ga(o),i),u=aw(o,c,Br(-l));return!(!u||!u.hasEvenY()||u.toAffine().x!==a)}catch{return!1}}const oe={getPublicKey:cw,sign:lw,verify:Bf,utils:{randomPrivateKey:Le.utils.randomPrivateKey,lift_x:Of,pointToBytes:ga,numberToBytesBE:dn,bytesToNumberBE:Te,taggedHash:Ti,mod:pe}},Ws=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wa=e=>e instanceof Uint8Array,qs=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),tt=(e,t)=>e<<32-t|e>>>t,uw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!uw)throw new Error("Non little-endian hardware is not supported");const fw=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function we(e){if(!wa(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=fw[e[n]];return t}function In(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const i=r*2,s=e.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function dw(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Mr(e){if(typeof e=="string"&&(e=dw(e)),!wa(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Zi(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!wa(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Mf=class{clone(){return this._cloneInto()}};function Pf(e){const t=r=>e().update(Mr(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Hf(e=32){if(Ws&&typeof Ws.getRandomValues=="function")return Ws.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function To(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function hw(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Ff(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function pw(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");To(e.outputLen),To(e.blockLen)}function gw(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function yw(e,t){Ff(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ot={number:To,bool:hw,bytes:Ff,hash:pw,exists:gw,output:yw};function ww(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}let vw=class extends Mf{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=qs(this.buffer)}update(t){ot.exists(this);const{view:n,buffer:r,blockLen:i}=this;t=Mr(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=qs(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ot.exists(this),ot.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;ww(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=qs(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}};const bw=(e,t,n)=>e&t^~e&n,mw=(e,t,n)=>e&t^e&n^t&n,xw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Yt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),en=new Uint32Array(64);let Df=class extends vw{constructor(){super(64,32,8,!1),this.A=Yt[0]|0,this.B=Yt[1]|0,this.C=Yt[2]|0,this.D=Yt[3]|0,this.E=Yt[4]|0,this.F=Yt[5]|0,this.G=Yt[6]|0,this.H=Yt[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)en[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=en[f-15],h=en[f-2],g=tt(d,7)^tt(d,18)^d>>>3,p=tt(h,17)^tt(h,19)^h>>>10;en[f]=p+en[f-7]+g+en[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const d=tt(a,6)^tt(a,11)^tt(a,25),h=u+d+bw(a,c,l)+xw[f]+en[f]|0,p=(tt(r,2)^tt(r,13)^tt(r,22))+mw(r,i,s)|0;u=l,l=c,c=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){en.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},Ew=class extends Df{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const Pn=Pf(()=>new Df);Pf(()=>new Ew);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function hr(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Bt(...e){const t=(i,s)=>o=>i(s(o)),n=Array.from(e).reverse().reduce((i,s)=>i?t(i,s.encode):s.encode,void 0),r=e.reduce((i,s)=>i?t(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Mt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(hr(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function Pt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Ji(e,t="="){if(hr(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function jf(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Fl(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach(o=>{if(hr(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[c]=Math.floor(u/n),!Number.isSafeInteger(s[c])||s[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(i.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)i.push(0);return i.reverse()}const Wf=(e,t)=>t?Wf(t,e%t):e,Ii=(e,t)=>e+(t-Wf(e,t));function Io(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ii(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ii(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const c of e){if(hr(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(i=i<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function $w(e){return hr(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Fl(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Fl(t,e,2**8))}}}function pn(e,t=!1){if(hr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ii(8,e)>32||Ii(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Io(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Io(n,e,8,t))}}}function Dl(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const Sw=Bt(pn(4),Mt("0123456789ABCDEF"),Pt("")),_w=Bt(pn(5),Mt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ji(5),Pt(""));Bt(pn(5),Mt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Ji(5),Pt(""));Bt(pn(5),Mt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Pt(""),jf(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Lt=Bt(pn(6),Mt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Ji(6),Pt("")),kw=Bt(pn(6),Mt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Ji(6),Pt("")),va=e=>Bt($w(58),Mt(e),Pt("")),Uo=va("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");va("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");va("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const jl=[0,2,3,5,6,7,9,10,11],Aw={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Uo.encode(r).padStart(jl[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=jl.indexOf(r.length),s=Uo.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},Oo=Bt(Mt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Pt("")),Wl=[996825010,642813549,513874426,1027748829,705979059];function Er(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Wl.length;r++)(t>>r&1)===1&&(n^=Wl[r]);return n}function ql(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=Er(i)^o>>5}i=Er(i);for(let s=0;s<r;s++)i=Er(i)^e.charCodeAt(s)&31;for(let s of t)i=Er(i)^s;for(let s=0;s<6;s++)i=Er(i);return i^=n,Oo.encode(Io([i%2**30],30,5,!1))}function qf(e){const t=e==="bech32"?1:734539939,n=pn(5),r=n.decode,i=n.encode,s=Dl(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);return u=u.toLowerCase(),`${u}1${Oo.encode(f)}${ql(u,f,t)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=d;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=u.slice(0,h),p=u.slice(h+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");const y=Oo.decode(p).slice(0,-6),v=ql(g,y,t);if(!p.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:g,words:y}}const c=Dl(a);function l(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const ar=qf("bech32");qf("bech32m");const Cw={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Rw=Bt(pn(4),Mt("0123456789abcdef"),Pt(""),jf(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Lw={utf8:Cw,hex:Rw,base16:Sw,base32:_w,base64:Lt,base64url:kw,base58:Uo,base58xmr:Aw};`${Object.keys(Lw).join(", ")}`;function zs(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function zl(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Tw(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function at(e,...t){if(!Tw(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const $e=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Iw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Iw)throw new Error("Non little-endian hardware is not supported");const Uw=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Dn(e){at(e);let t="";for(let n=0;n<e.length;n++)t+=Uw[e[n]];return t}const bt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Vl(e){if(e>=bt._0&&e<=bt._9)return e-bt._0;if(e>=bt._A&&e<=bt._F)return e-(bt._A-10);if(e>=bt._a&&e<=bt._f)return e-(bt._a-10)}function zf(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Vl(e.charCodeAt(s)),a=Vl(e.charCodeAt(s+1));if(o===void 0||a===void 0){const c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Ow(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Xi(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const Nw=(e,t)=>(Object.assign(t,e),t),fn=16,Bw=283;function ba(e){return e<<1^Bw&-(e>>7)}function Gn(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=ba(e);return n}const No=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=ba(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),Mw=No.map((e,t)=>No.indexOf(t)),Pw=e=>e<<24|e>>>8,Vs=e=>e<<8|e>>>24;function Vf(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((l,u)=>t(e[u])),r=n.map(Vs),i=r.map(Vs),s=i.map(Vs),o=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let u=0;u<256;u++){const f=l*256+u;o[f]=n[l]^r[u],a[f]=i[l]^s[u],c[f]=e[l]<<8|e[u]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const ma=Vf(No,e=>Gn(e,3)<<24|e<<16|e<<8|Gn(e,2)),Kf=Vf(Mw,e=>Gn(e,11)<<24|Gn(e,13)<<16|Gn(e,9)<<8|Gn(e,14)),Hw=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=ba(n))e[t]=n;return e})();function Gf(e){at(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=ma,r=$e(e),i=r.length,s=a=>ct(n,a,a,a,a),o=new Uint32Array(t+28);o.set(r);for(let a=i;a<o.length;a++){let c=o[a-1];a%i===0?c=s(Pw(c))^Hw[a/i-1]:i>6&&a%i===4&&(c=s(c)),o[a]=o[a-i]^c}return o}function Fw(e){const t=Gf(e),n=t.slice(),r=t.length,{sbox2:i}=ma,{T0:s,T1:o,T2:a,T3:c}=Kf;for(let l=0;l<r;l+=4)for(let u=0;u<4;u++)n[l+u]=t[r-l-4+u];t.fill(0);for(let l=4;l<r-4;l++){const u=n[l],f=ct(i,u,u,u,u);n[l]=s[f&255]^o[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return n}function un(e,t,n,r,i,s){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|s>>>24&255]}function ct(e,t,n,r,i){return e[t&255|n&65280]|e[r>>>16&255|i>>>16&65280]<<16}function Kl(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=ma;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let g=0;g<l;g++){const p=e[c++]^un(o,a,t,n,r,i),y=e[c++]^un(o,a,n,r,i,t),v=e[c++]^un(o,a,r,i,t,n),$=e[c++]^un(o,a,i,t,n,r);t=p,n=y,r=v,i=$}const u=e[c++]^ct(s,t,n,r,i),f=e[c++]^ct(s,n,r,i,t),d=e[c++]^ct(s,r,i,t,n),h=e[c++]^ct(s,i,t,n,r);return{s0:u,s1:f,s2:d,s3:h}}function Dw(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=Kf;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const l=e.length/4-2;for(let g=0;g<l;g++){const p=e[c++]^un(o,a,t,i,r,n),y=e[c++]^un(o,a,n,t,i,r),v=e[c++]^un(o,a,r,n,t,i),$=e[c++]^un(o,a,i,r,n,t);t=p,n=y,r=v,i=$}const u=e[c++]^ct(s,t,i,r,n),f=e[c++]^ct(s,n,t,i,r),d=e[c++]^ct(s,r,n,t,i),h=e[c++]^ct(s,i,r,n,t);return{s0:u,s1:f,s2:d,s3:h}}function Zf(e,t){if(!t)return new Uint8Array(e);if(at(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function jw(e){if(at(e),e.length%fn!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${fn}`)}function Ww(e,t,n){let r=e.length;const i=r%fn;if(!t&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=$e(e);if(t){let c=fn-i;c||(c=fn),r=r+c}const o=Zf(r,n),a=$e(o);return{b:s,o:a,out:o}}function qw(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}function zw(e){const t=new Uint8Array(16),n=$e(t);t.set(e);const r=fn-e.length;for(let i=fn-r;i<fn;i++)t[i]=r;return n}const gn=Nw({blockSize:16,nonceLength:16},function(t,n,r={}){at(t),at(n,16);const i=!r.disablePadding;return{encrypt:(s,o)=>{const a=Gf(t),{b:c,o:l,out:u}=Ww(s,i,o),f=$e(n);let d=f[0],h=f[1],g=f[2],p=f[3],y=0;for(;y+4<=c.length;)d^=c[y+0],h^=c[y+1],g^=c[y+2],p^=c[y+3],{s0:d,s1:h,s2:g,s3:p}=Kl(a,d,h,g,p),l[y++]=d,l[y++]=h,l[y++]=g,l[y++]=p;if(i){const v=zw(s.subarray(y*4));d^=v[0],h^=v[1],g^=v[2],p^=v[3],{s0:d,s1:h,s2:g,s3:p}=Kl(a,d,h,g,p),l[y++]=d,l[y++]=h,l[y++]=g,l[y++]=p}return a.fill(0),u},decrypt:(s,o)=>{jw(s);const a=Fw(t),c=$e(n),l=Zf(s.length,o),u=$e(s),f=$e(l);let d=c[0],h=c[1],g=c[2],p=c[3];for(let y=0;y+4<=u.length;){const v=d,$=h,S=g,_=p;d=u[y+0],h=u[y+1],g=u[y+2],p=u[y+3];const{s0:I,s1:k,s2:R,s3:A}=Dw(a,d,h,g,p);f[y++]=I^v,f[y++]=k^$,f[y++]=R^S,f[y++]=A^_}return a.fill(0),qw(l,i)}}}),Jf=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),Vw=Jf("expand 16-byte k"),Kw=Jf("expand 32-byte k"),Gw=$e(Vw),Xf=$e(Kw);Xf.slice();function W(e,t){return e<<t|e>>>32-t}function Bo(e){return e.byteOffset%4===0}const ti=64,Zw=16,Qf=2**32-1,Gl=new Uint32Array;function Jw(e,t,n,r,i,s,o,a){const c=i.length,l=new Uint8Array(ti),u=$e(l),f=Bo(i)&&Bo(s),d=f?$e(i):Gl,h=f?$e(s):Gl;for(let g=0;g<c;o++){if(e(t,n,r,u,o,a),o>=Qf)throw new Error("arx: counter overflow");const p=Math.min(ti,c-g);if(f&&p===ti){const y=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,$;v<Zw;v++)$=y+v,h[$]=d[$]^u[v];g+=ti;continue}for(let y=0,v;y<p;y++)v=g+y,s[v]=i[v]^l[y];g+=p}}function Xw(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=Ow({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return zs(i),zs(o),zl(s),zl(n),(a,c,l,u,f=0)=>{at(a),at(c),at(l);const d=l.length;if(u||(u=new Uint8Array(d)),at(u),zs(f),f<0||f>=Qf)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const h=[];let g=a.length,p,y;if(g===32)p=a.slice(),h.push(p),y=Xf;else if(g===16&&n)p=new Uint8Array(32),p.set(a),p.set(a,16),y=Gw,h.push(p);else throw new Error(`arx: invalid 32-byte key, got length=${g}`);Bo(c)||(c=c.slice(),h.push(c));const v=$e(p);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,v,$e(c.subarray(0,16)),v),c=c.subarray(16)}const $=16-i;if($!==c.length)throw new Error(`arx: nonce must be ${$} or 16 bytes`);if($!==12){const _=new Uint8Array(12);_.set(c,s?0:12-c.length),c=_,h.push(c)}const S=$e(c);for(Jw(e,y,v,S,l,u,f,o);h.length>0;)h.pop().fill(0);return u}}function Qw(e,t,n,r,i,s=20){let o=e[0],a=e[1],c=e[2],l=e[3],u=t[0],f=t[1],d=t[2],h=t[3],g=t[4],p=t[5],y=t[6],v=t[7],$=i,S=n[0],_=n[1],I=n[2],k=o,R=a,A=c,H=l,M=u,w=f,m=d,x=h,L=g,b=p,E=y,C=v,B=$,N=S,F=_,O=I;for(let K=0;K<s;K+=2)k=k+M|0,B=W(B^k,16),L=L+B|0,M=W(M^L,12),k=k+M|0,B=W(B^k,8),L=L+B|0,M=W(M^L,7),R=R+w|0,N=W(N^R,16),b=b+N|0,w=W(w^b,12),R=R+w|0,N=W(N^R,8),b=b+N|0,w=W(w^b,7),A=A+m|0,F=W(F^A,16),E=E+F|0,m=W(m^E,12),A=A+m|0,F=W(F^A,8),E=E+F|0,m=W(m^E,7),H=H+x|0,O=W(O^H,16),C=C+O|0,x=W(x^C,12),H=H+x|0,O=W(O^H,8),C=C+O|0,x=W(x^C,7),k=k+w|0,O=W(O^k,16),E=E+O|0,w=W(w^E,12),k=k+w|0,O=W(O^k,8),E=E+O|0,w=W(w^E,7),R=R+m|0,B=W(B^R,16),C=C+B|0,m=W(m^C,12),R=R+m|0,B=W(B^R,8),C=C+B|0,m=W(m^C,7),A=A+x|0,N=W(N^A,16),L=L+N|0,x=W(x^L,12),A=A+x|0,N=W(N^A,8),L=L+N|0,x=W(x^L,7),H=H+M|0,F=W(F^H,16),b=b+F|0,M=W(M^b,12),H=H+M|0,F=W(F^H,8),b=b+F|0,M=W(M^b,7);let P=0;r[P++]=o+k|0,r[P++]=a+R|0,r[P++]=c+A|0,r[P++]=l+H|0,r[P++]=u+M|0,r[P++]=f+w|0,r[P++]=d+m|0,r[P++]=h+x|0,r[P++]=g+L|0,r[P++]=p+b|0,r[P++]=y+E|0,r[P++]=v+C|0,r[P++]=$+B|0,r[P++]=S+N|0,r[P++]=_+F|0,r[P++]=I+O|0}const yn=Xw(Qw,{counterRight:!1,counterLength:4,allowShortKeys:!1});let Yf=class extends Mf{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ot.hash(t);const r=Mr(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return ot.exists(this),this.iHash.update(t),this}digestInto(t){ot.exists(this),ot.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Qi=(e,t,n)=>new Yf(e,t).update(n).digest();Qi.create=(e,t)=>new Yf(e,t);function Yw(e,t,n){return ot.hash(e),Qi(e,Mr(n),Mr(t))}const Ks=new Uint8Array([0]),Zl=new Uint8Array;function ev(e,t,n,r=32){if(ot.hash(e),ot.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);n===void 0&&(n=Zl);const s=new Uint8Array(i*e.outputLen),o=Qi.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)Ks[0]=l+1,a.update(l===0?Zl:c).update(n).update(Ks).digestInto(c),s.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Ks.fill(0),s.slice(0,r)}var tv=Object.defineProperty,V=(e,t)=>{for(var n in t)tv(e,n,{get:t[n],enumerable:!0})},jn=Symbol("verified"),nv=e=>e instanceof Object;function xa(e){if(!nv(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var rv={};V(rv,{Queue:()=>av,QueueNode:()=>ed,binarySearch:()=>Ea,bytesToHex:()=>we,hexToBytes:()=>In,insertEventIntoAscendingList:()=>ov,insertEventIntoDescendingList:()=>sv,normalizeURL:()=>iv,utf8Decoder:()=>_t,utf8Encoder:()=>Ke});var _t=new TextDecoder("utf-8"),Ke=new TextEncoder;function iv(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function sv(e,t){const[n,r]=Ea(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function ov(e,t){const[n,r]=Ea(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return r||e.splice(n,0,t),e}function Ea(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var ed=class{value;next=null;prev=null;constructor(t){this.value=t}},av=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const n=new ed(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},cv=class{generateSecretKey(){return oe.utils.randomPrivateKey()}getPublicKey(t){return we(oe.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=we(oe.getPublicKey(n)),r.id=li(r),r.sig=we(oe.sign(li(r),n)),r[jn]=!0,r}verifyEvent(t){if(typeof t[jn]=="boolean")return t[jn];const n=li(t);if(n!==t.id)return t[jn]=!1,!1;try{const r=oe.verify(t.sig,n,t.pubkey);return t[jn]=r,r}catch{return t[jn]=!1,!1}}};function lv(e){if(!xa(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function li(e){let t=Pn(Ke.encode(lv(e)));return we(t)}var Yi=new cv,uv=Yi.generateSecretKey,$a=Yi.getPublicKey,dt=Yi.finalizeEvent,Sa=Yi.verifyEvent,fv={};V(fv,{Application:()=>$b,BadgeAward:()=>bv,BadgeDefinition:()=>yb,BlockedRelaysList:()=>Qv,BlossomServerList:()=>sb,BookmarkList:()=>Zv,Bookmarksets:()=>hb,Calendar:()=>Lb,CalendarEventRSVP:()=>Tb,ChannelCreation:()=>od,ChannelHideMessage:()=>ld,ChannelMessage:()=>cd,ChannelMetadata:()=>ad,ChannelMuteUser:()=>ud,ChatMessage:()=>mv,ClassifiedListing:()=>kb,ClientAuth:()=>dd,Comment:()=>Rv,CommunitiesList:()=>Jv,CommunityDefinition:()=>Nb,CommunityPostApproval:()=>Mv,Contacts:()=>yv,CreateOrUpdateProduct:()=>bb,CreateOrUpdateStall:()=>vb,Curationsets:()=>pb,Date:()=>Cb,DirectMessageRelaysList:()=>rb,DraftClassifiedListing:()=>Ab,DraftLong:()=>xb,Emojisets:()=>Eb,EncryptedDirectMessage:()=>wv,EventDeletion:()=>vv,FavoriteRelays:()=>eb,FileMessage:()=>Ev,FileMetadata:()=>Cv,FileServerPreference:()=>ib,Followsets:()=>ub,ForumThread:()=>xv,GenericRepost:()=>Ra,Genericlists:()=>fb,GiftWrap:()=>fd,GroupMetadata:()=>Bb,HTTPAuth:()=>La,Handlerinformation:()=>Ob,Handlerrecommendation:()=>Ub,Highlights:()=>qv,InterestsList:()=>tb,Interestsets:()=>wb,JobFeedback:()=>Fv,JobRequest:()=>Pv,JobResult:()=>Hv,Label:()=>Bv,LightningPubRPC:()=>ab,LiveChatMessage:()=>Lv,LiveEvent:()=>Sb,LongFormArticle:()=>mb,Metadata:()=>pv,Mutelist:()=>Vv,NWCWalletInfo:()=>ob,NWCWalletRequest:()=>hd,NWCWalletResponse:()=>cb,NormalVideo:()=>Sv,NostrConnect:()=>lb,OpenTimestamps:()=>kv,Photo:()=>$v,Pinlist:()=>Kv,Poll:()=>Av,PollResponse:()=>zv,PrivateDirectMessage:()=>sd,ProblemTracker:()=>Uv,ProfileBadges:()=>gb,PublicChatsList:()=>Xv,Reaction:()=>Ca,RecommendRelay:()=>gv,RelayList:()=>Gv,RelayReview:()=>Ib,Relaysets:()=>db,Report:()=>Ov,Reporting:()=>Nv,Repost:()=>Aa,Seal:()=>id,SearchRelaysList:()=>Yv,ShortTextNote:()=>rd,ShortVideo:()=>_v,Time:()=>Rb,UserEmojiList:()=>nb,UserStatuses:()=>_b,Voice:()=>Tv,VoiceComment:()=>Iv,Zap:()=>Wv,ZapGoal:()=>Dv,ZapRequest:()=>jv,classifyKind:()=>dv,isAddressableKind:()=>ka,isEphemeralKind:()=>nd,isKind:()=>hv,isRegularKind:()=>td,isReplaceableKind:()=>_a});function td(e){return e<1e4&&e!==0&&e!==3}function _a(e){return e===0||e===3||1e4<=e&&e<2e4}function nd(e){return 2e4<=e&&e<3e4}function ka(e){return 3e4<=e&&e<4e4}function dv(e){return td(e)?"regular":_a(e)?"replaceable":nd(e)?"ephemeral":ka(e)?"parameterized":"unknown"}function hv(e,t){const n=t instanceof Array?t:[t];return xa(e)&&n.includes(e.kind)||!1}var pv=0,rd=1,gv=2,yv=3,wv=4,vv=5,Aa=6,Ca=7,bv=8,mv=9,xv=11,id=13,sd=14,Ev=15,Ra=16,$v=20,Sv=21,_v=22,od=40,ad=41,cd=42,ld=43,ud=44,kv=1040,fd=1059,Av=1068,Cv=1063,Rv=1111,Lv=1311,Tv=1222,Iv=1244,Uv=1971,Ov=1984,Nv=1984,Bv=1985,Mv=4550,Pv=5999,Hv=6999,Fv=7e3,Dv=9041,jv=9734,Wv=9735,qv=9802,zv=1018,Vv=1e4,Kv=10001,Gv=10002,Zv=10003,Jv=10004,Xv=10005,Qv=10006,Yv=10007,eb=10012,tb=10015,nb=10030,rb=10050,ib=10096,sb=10063,ob=13194,ab=21e3,dd=22242,hd=23194,cb=23195,lb=24133,La=27235,ub=3e4,fb=30001,db=30002,hb=30003,pb=30004,gb=30008,yb=30009,wb=30015,vb=30017,bb=30018,mb=30023,xb=30024,Eb=30030,$b=30078,Sb=30311,_b=30315,kb=30402,Ab=30403,Cb=31922,Rb=31923,Lb=31924,Tb=31925,Ib=31987,Ub=31989,Ob=31990,Nb=34550,Bb=39e3,Mb={};V(Mb,{getHex64:()=>Ta,getInt:()=>pd,getSubscriptionId:()=>Pb,matchEventId:()=>Hb,matchEventKind:()=>Db,matchEventPubkey:()=>Fb});function Ta(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function pd(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function Pb(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return e.slice(r+1,s)}function Hb(e,t){return t===Ta(e,"id")}function Fb(e,t){return t===Ta(e,"pubkey")}function Db(e,t){return t===pd(e,"kind")}var jb={};V(jb,{makeAuthEvent:()=>Wb});function Wb(e,t){return{kind:dd,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var qb;try{qb=WebSocket}catch{}var zb;try{zb=WebSocket}catch{}var gd={};V(gd,{BECH32_REGEX:()=>yd,Bech32MaxSize:()=>Ia,NostrTypeGuard:()=>Vb,decode:()=>es,decodeNostrURI:()=>Gb,encodeBytes:()=>ns,naddrEncode:()=>em,neventEncode:()=>Yb,noteEncode:()=>Xb,nprofileEncode:()=>Qb,npubEncode:()=>Jb,nsecEncode:()=>Zb});var Vb={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Ia=5e3,yd=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Kb(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Gb(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),es(e)}catch{return{type:"invalid",data:null}}}function es(e){let{prefix:t,words:n}=ar.decode(e,Ia),r=new Uint8Array(ar.fromWords(n));switch(t){case"nprofile":{let i=Gs(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:we(i[0][0]),relays:i[1]?i[1].map(s=>_t.decode(s)):[]}}}case"nevent":{let i=Gs(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:we(i[0][0]),relays:i[1]?i[1].map(s=>_t.decode(s)):[],author:i[2]?.[0]?we(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(we(i[3][0]),16):void 0}}}case"naddr":{let i=Gs(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:_t.decode(i[0][0]),pubkey:we(i[2][0]),kind:parseInt(we(i[3][0]),16),relays:i[1]?i[1].map(s=>_t.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:we(r)};default:throw new Error(`unknown prefix ${t}`)}}function Gs(e){let t={},n=e;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function Zb(e){return ns("nsec",e)}function Jb(e){return ns("npub",In(e))}function Xb(e){return ns("note",In(e))}function ts(e,t){let n=ar.toWords(t);return ar.encode(e,n,Ia)}function ns(e,t){return ts(e,t)}function Qb(e){let t=Ua({0:[In(e.pubkey)],1:(e.relays||[]).map(n=>Ke.encode(n))});return ts("nprofile",t)}function Yb(e){let t;e.kind!==void 0&&(t=Kb(e.kind));let n=Ua({0:[In(e.id)],1:(e.relays||[]).map(r=>Ke.encode(r)),2:e.author?[In(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return ts("nevent",n)}function em(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=Ua({0:[Ke.encode(e.identifier)],1:(e.relays||[]).map(r=>Ke.encode(r)),2:[In(e.pubkey)],3:[new Uint8Array(t)]});return ts("naddr",n)}function Ua(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),t.push(s)})}),Zi(...t)}var tm={};V(tm,{decrypt:()=>nm,encrypt:()=>wd});function wd(e,t,n){const r=e instanceof Uint8Array?we(e):e,i=Le.getSharedSecret(r,"02"+t),s=vd(i);let o=Uint8Array.from(Hf(16)),a=Ke.encode(n),c=gn(s,o).encrypt(a),l=Lt.encode(new Uint8Array(c)),u=Lt.encode(new Uint8Array(o.buffer));return`${l}?iv=${u}`}function nm(e,t,n){const r=e instanceof Uint8Array?we(e):e;let[i,s]=n.split("?iv="),o=Le.getSharedSecret(r,"02"+t),a=vd(o),c=Lt.decode(s),l=Lt.decode(i),u=gn(a,c).decrypt(l);return _t.decode(u)}function vd(e){return e.slice(1,33)}var rm={};V(rm,{NIP05_REGEX:()=>Oa,isNip05:()=>im,isValid:()=>am,queryProfile:()=>bd,searchDomain:()=>om,useFetchImplementation:()=>sm});var Oa=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,im=e=>Oa.test(e||""),rs;try{rs=fetch}catch{}function sm(e){rs=e}async function om(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await rs(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function bd(e){const t=e.match(Oa);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await rs(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function am(e,t){const n=await bd(t);return n?n.pubkey===e:!1}var cm={};V(cm,{parse:()=>lm});function lm(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if(s[0]==="e"&&s[1]){const[o,a,c,l,u]=s,f={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=f;continue}if(l==="reply"){t.reply=f;continue}if(l==="mention"){t.mentions.push(f);continue}n?r=f:n=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let s=t.mentions.indexOf(i);if(s!==-1&&t.mentions.splice(s,1),i.author){let o=t.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let s=t.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),t}var um={};V(um,{fetchRelayInformation:()=>dm,useFetchImplementation:()=>fm});var md;try{md=fetch}catch{}function fm(e){md=e}async function dm(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var hm={};V(hm,{fastEventHash:()=>Ed,getPow:()=>xd,minePow:()=>pm});function xd(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function pm(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=Ed(r),xd(r.id)>=t)break}return r}function Ed(e){return we(Pn(Ke.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var gm={};V(gm,{unwrapEvent:()=>Am,unwrapManyEvents:()=>Cm,wrapEvent:()=>Nd,wrapManyEvents:()=>km});var ym={};V(ym,{createRumor:()=>Td,createSeal:()=>Id,createWrap:()=>Ud,unwrapEvent:()=>Ha,unwrapManyEvents:()=>Od,wrapEvent:()=>Ui,wrapManyEvents:()=>Sm});var wm={};V(wm,{decrypt:()=>Pa,encrypt:()=>Ma,getConversationKey:()=>Na,v2:()=>Em});var $d=1,Sd=65535;function Na(e,t){const n=Le.getSharedSecret(e,"02"+t).subarray(1,33);return Yw(Pn,n,"nip44-v2")}function _d(e,t){const n=ev(Pn,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Ba(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function vm(e){if(!Number.isSafeInteger(e)||e<$d||e>Sd)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function bm(e){const t=Ke.encode(e),n=t.length,r=vm(n),i=new Uint8Array(Ba(n)-n);return Zi(r,t,i)}function mm(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<$d||t>Sd||n.length!==t||e.length!==2+Ba(t))throw new Error("invalid padding");return _t.decode(n)}function kd(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Zi(n,t);return Qi(Pn,e,r)}function xm(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=Lt.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Ma(e,t,n=Hf(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=_d(t,n),o=bm(e),a=yn(r,i,o),c=kd(s,a,n);return Lt.encode(Zi(new Uint8Array([2]),n,a,c))}function Pa(e,t){const{nonce:n,ciphertext:r,mac:i}=xm(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=_d(t,n),c=kd(a,r,n);if(!Xi(c,i))throw new Error("invalid MAC");const l=yn(s,o,r);return mm(l)}var Em={utils:{getConversationKey:Na,calcPaddedLen:Ba},encrypt:Ma,decrypt:Pa},$m=2*24*60*60,Ad=()=>Math.round(Date.now()/1e3),Cd=()=>Math.round(Ad()-Math.random()*$m),Rd=(e,t)=>Na(e,t),Ld=(e,t,n)=>Ma(JSON.stringify(e),Rd(t,n)),Jl=(e,t)=>JSON.parse(Pa(e.content,Rd(t,e.pubkey)));function Td(e,t){const n={created_at:Ad(),content:"",tags:[],...e,pubkey:$a(t)};return n.id=li(n),n}function Id(e,t,n){return dt({kind:id,content:Ld(e,t,n),created_at:Cd(),tags:[]},t)}function Ud(e,t){const n=uv();return dt({kind:fd,content:Ld(e,n,t),created_at:Cd(),tags:[["p",t]]},n)}function Ui(e,t,n){const r=Td(e,t),i=Id(r,t,n);return Ud(i,n)}function Sm(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=$a(t),i=[Ui(e,t,r)];return n.forEach(s=>{i.push(Ui(e,t,s))}),i}function Ha(e,t){const n=Jl(e,t);return Jl(n,t)}function Od(e,t){let n=[];return e.forEach(r=>{n.push(Ha(r,t))}),n.sort((r,i)=>r.created_at-i.created_at),n}function _m(e,t,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:sd,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function Nd(e,t,n,r,i){const s=_m(t,n,r,i);return Ui(s,e,t.publicKey)}function km(e,t,n,r,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:$a(e)},...t].map(o=>Nd(e,o,n,r,i))}var Am=Ha,Cm=Od,Rm={};V(Rm,{finishRepostEvent:()=>Lm,getRepostedEvent:()=>Tm,getRepostedEventPointer:()=>Bd});function Lm(e,t,n,r){let i;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===rd?i=Aa:(i=Ra,s.push(["k",String(t.kind)])),dt({kind:i,tags:s,content:e.content===""||t.tags?.find(o=>o[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function Bd(e){if(![Aa,Ra].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Tm(e,{skipVerification:t}={}){const n=Bd(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!Sa(r)))return r}var Im={};V(Im,{NOSTR_URI_REGEX:()=>Fa,parse:()=>Om,test:()=>Um});var Fa=new RegExp(`nostr:(${yd.source})`);function Um(e){return typeof e=="string"&&new RegExp(`^${Fa.source}$`).test(e)}function Om(e){const t=e.match(new RegExp(`^${Fa.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:es(t[1])}}var Nm={};V(Nm,{finishReactionEvent:()=>Bm,getReactedEventPointer:()=>Mm});function Bm(e,t,n){const r=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return dt({...e,kind:Ca,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Mm(e){if(e.kind!==Ca)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Pm={};V(Pm,{parse:()=>Fm});var Xl=/\W/m,Ql=/[^\w\/] |[^\w\/]$|$|,| /m,Hm=42;function*Fm(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){const o=e.tags[s];o[0]==="emoji"&&o.length>=3&&t.push({type:"emoji",shortcode:o[1],url:o[2]})}e=e.content}const n=e.length;let r=0,i=0;e:for(;i<n;){const s=e.indexOf(":",i),o=e.indexOf("#",i);if(s===-1&&o===-1)break e;if(s===-1||o>=0&&o<s){if(o===0||e[o-1]===" "){const a=e.slice(o+1,o+Hm).match(Xl),c=a?o+1+a.index:n;yield{type:"text",text:e.slice(r,o)},yield{type:"hashtag",value:e.slice(o+1,c)},i=c,r=i;continue e}i=o+1;continue e}if(e.slice(s-5,s)==="nostr"){const a=e.slice(s+60).match(Xl),c=a?s+60+a.index:n;try{let l,{data:u,type:f}=es(e.slice(s+1,c));switch(f){case"npub":l={pubkey:u};break;case"note":l={id:u};break;case"nsec":i=c+1;continue;default:l=u}r!==s-5&&(yield{type:"text",text:e.slice(r,s-5)}),yield{type:"reference",pointer:l},i=c,r=i;continue e}catch{i=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){const a=e.slice(s+4).match(Ql),c=a?s+4+a.index:n,l=e[s-1]==="s"?5:4;try{let u=new URL(e.slice(s-l,c));if(u.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-l&&(yield{type:"text",text:e.slice(r,s-l)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(u.pathname)){yield{type:"image",url:u.toString()},i=c,r=i;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(u.pathname)){yield{type:"video",url:u.toString()},i=c,r=i;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(u.pathname)){yield{type:"audio",url:u.toString()},i=c,r=i;continue e}yield{type:"url",url:u.toString()},i=c,r=i;continue e}catch{i=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){const a=e.slice(s+4).match(Ql),c=a?s+4+a.index:n,l=e[s-1]==="s"?3:2;try{let u=new URL(e.slice(s-l,c));if(u.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-l&&(yield{type:"text",text:e.slice(r,s-l)}),yield{type:"relay",url:u.toString()},i=c,r=i;continue e}catch{i=c+1;continue e}}else{for(let a=0;a<t.length;a++){const c=t[a];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){r!==s&&(yield{type:"text",text:e.slice(r,s)}),yield c,i=s+c.shortcode.length+2,r=i;continue e}}i=s+1;continue e}}r!==n&&(yield{type:"text",text:e.slice(r)})}var Dm={};V(Dm,{channelCreateEvent:()=>jm,channelHideMessageEvent:()=>zm,channelMessageEvent:()=>qm,channelMetadataEvent:()=>Wm,channelMuteUserEvent:()=>Vm});var jm=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return dt({kind:od,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Wm=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return dt({kind:ad,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},qm=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),dt({kind:cd,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},zm=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return dt({kind:ld,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Vm=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return dt({kind:ud,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},Km={};V(Km,{EMOJI_SHORTCODE_REGEX:()=>Md,matchAll:()=>Gm,regex:()=>Da,replaceAll:()=>Zm});var Md=/:(\w+):/,Da=()=>new RegExp(`\\B${Md.source}\\B`,"g");function*Gm(e){const t=e.matchAll(Da());for(const n of t)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function Zm(e,t){return e.replaceAll(Da(),(n,r)=>t({shortcode:n,name:r}))}var Jm={};V(Jm,{useFetchImplementation:()=>Xm,validateGithub:()=>Qm});var ja;try{ja=fetch}catch{}function Xm(e){ja=e}async function Qm(e,t,n){try{return await(await ja(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var Ym={};V(Ym,{makeNwcRequestEvent:()=>t1,parseConnectionString:()=>e1});function e1(e){const{host:t,pathname:n,searchParams:r}=new URL(e),i=n||t,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function t1(e,t,n){const i=wd(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:hd,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return dt(s,t)}var n1={};V(n1,{normalizeIdentifier:()=>r1});function r1(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var i1={};V(i1,{getSatoshisAmountFromBolt11:()=>u1,getZapEndpoint:()=>o1,makeZapReceipt:()=>l1,makeZapRequest:()=>a1,useFetchImplementation:()=>s1,validateZapRequest:()=>c1});var Wa;try{Wa=fetch}catch{}function s1(e){Wa=e}async function o1(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(r){let[o,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else if(n){let{words:o}=ar.decode(n,1e3),a=ar.fromWords(o);t=_t.decode(a)}else return null;let s=await(await Wa(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function a1(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),_a(e.event.kind)){const n=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(n)}else if(ka(e.event.kind)){let n=e.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${e.event.kind}:${e.event.pubkey}:${n[1]}`];t.tags.push(r)}t.tags.push(["k",e.event.kind.toString()])}return t}function c1(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!xa(t))return"Zap request is not a valid Nostr event.";if(!Sa(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function l1({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}function u1(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const c=parseInt(r.substring(0,a));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var f1={};V(f1,{Negentropy:()=>Hd,NegentropyStorageVector:()=>p1,NegentropySync:()=>g1});var Zs=97,Qn=32,Pd=16,Sn={Skip:0,Fingerprint:1,IdList:2},St=class{_raw;length;constructor(e){typeof e=="number"?(this._raw=new Uint8Array(e),this.length=0):e instanceof Uint8Array?(this._raw=new Uint8Array(e),this.length=e.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(e){if(e instanceof St&&(e=e.unwrap()),typeof e.length!="number")throw Error("bad length");const t=e.length+this.length;if(this.capacity<t){const n=this._raw,r=Math.max(this.capacity*2,t);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(e,this.length),this.length+=e.length}shift(){const e=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,e}shiftN(e=1){const t=this._raw.subarray(0,e);return this._raw=this._raw.subarray(e),this.length-=e,t}};function ni(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let n=e.shift();if(t=t<<7|n&127,!(n&128))break}return t}function xt(e){if(e===0)return new St(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let n=0;n<t.length-1;n++)t[n]|=128;return new St(new Uint8Array(t))}function d1(e){return ui(e,1)[0]}function ui(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var h1=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Qn)}add(e){let t=0,n=0,r=new DataView(this.buf.buffer),i=new DataView(e.buffer);for(let s=0;s<8;s++){let o=s*4,a=r.getUint32(o,!0),c=i.getUint32(o,!0),l=a;l+=t,l+=c,l>4294967295&&(n=1),r.setUint32(o,l&4294967295,!0),t=n,n=0}}negate(){let e=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;e.setUint32(r,~e.getUint32(r,!0))}let t=new Uint8Array(Qn);t[0]=1,this.add(t)}getFingerprint(e){let t=new St;return t.extend(this.buf),t.extend(xt(e)),Pn(t.unwrap()).subarray(0,Pd)}},p1=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(e,t){if(this.sealed)throw Error("already sealed");const n=zf(t);if(n.byteLength!==Qn)throw Error("bad id size for added item");this.items.push({timestamp:e,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(Js);for(let e=1;e<this.items.length;e++)if(Js(this.items[e-1],this.items[e])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(e){if(this._checkSealed(),e>=this.items.length)throw Error("out of range");return this.items[e]}iterate(e,t,n){this._checkSealed(),this._checkBounds(e,t);for(let r=e;r<t&&n(this.items[r],r);++r);}findLowerBound(e,t,n){return this._checkSealed(),this._checkBounds(e,t),this._binarySearch(this.items,e,t,r=>Js(r,n)<0)}fingerprint(e,t){let n=new h1;return n.setToZero(),this.iterate(e,t,r=>(n.add(r.id),!0)),n.getFingerprint(t-e)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(e,t){if(e>t||t>this.items.length)throw Error("bad range")}_binarySearch(e,t,n,r){let i=n-t;for(;i>0;){let s=t,o=Math.floor(i/2);s+=o,r(e[s])?(t=++s,i-=o+1):i=o}return t}},Hd=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(e,t=6e4){if(t<4096)throw Error("frameSizeLimit too small");this.storage=e,this.frameSizeLimit=t,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(e,t){return{timestamp:e,id:t||new Uint8Array(0)}}initiate(){let e=new St;return e.extend(new Uint8Array([Zs])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),e),Dn(e.unwrap())}reconcile(e,t,n){const r=new St(zf(e));this.lastTimestampIn=this.lastTimestampOut=0;let i=new St;i.extend(new Uint8Array([Zs]));let s=d1(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==Zs)throw Error("unsupported negentropy protocol version requested: "+(s-96));let o=this.storage.size(),a=this._bound(0),c=0,l=!1;for(;r.length!==0;){let u=new St,f=()=>{l&&(l=!1,u.extend(this.encodeBound(a)),u.extend(xt(Sn.Skip)))},d=this.decodeBound(r),h=ni(r),g=c,p=this.storage.findLowerBound(c,o,d);if(h===Sn.Skip)l=!0;else if(h===Sn.Fingerprint){let y=ui(r,Pd),v=this.storage.fingerprint(g,p);Fd(y,v)!==0?(f(),this.splitRange(g,p,d,u)):l=!0}else if(h===Sn.IdList){let y=ni(r),v={};for(let $=0;$<y;$++){let S=ui(r,Qn);v[Dn(S)]=S}if(l=!0,this.storage.iterate(g,p,$=>{let S=$.id;const _=Dn(S);return v[_]?delete v[Dn(S)]:t?.(_),!0}),n)for(let $ of Object.values(v))n(Dn($))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(i.length+u.length)){let y=this.storage.fingerprint(p,o);i.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),i.extend(xt(Sn.Fingerprint)),i.extend(y);break}else i.extend(u);c=p,a=d}return i.length===1?null:Dn(i.unwrap())}splitRange(e,t,n,r){let i=t-e,s=16;if(i<s*2)r.extend(this.encodeBound(n)),r.extend(xt(Sn.IdList)),r.extend(xt(i)),this.storage.iterate(e,t,o=>(r.extend(o.id),!0));else{let o=Math.floor(i/s),a=i%s,c=e;for(let l=0;l<s;l++){let u=o+(l<a?1:0),f=this.storage.fingerprint(c,c+u);c+=u;let d;if(c===t)d=n;else{let h,g;this.storage.iterate(c-1,c+1,(p,y)=>(y===c-1?h=p:g=p,!0)),d=this.getMinimalBound(h,g)}r.extend(this.encodeBound(d)),r.extend(xt(Sn.Fingerprint)),r.extend(f)}}}exceededFrameSizeLimit(e){return e>this.frameSizeLimit-200}decodeTimestampIn(e){let t=ni(e);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(e){let t=this.decodeTimestampIn(e),n=ni(e);if(n>Qn)throw Error("bound key too long");let r=ui(e,n);return{timestamp:t,id:r}}encodeTimestampOut(e){if(e===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,xt(0);let t=e;return e-=this.lastTimestampOut,this.lastTimestampOut=t,xt(e+1)}encodeBound(e){let t=new St;return t.extend(this.encodeTimestampOut(e.timestamp)),t.extend(xt(e.id.length)),t.extend(e.id),t}getMinimalBound(e,t){if(t.timestamp!==e.timestamp)return this._bound(t.timestamp);{let n=0,r=t.id,i=e.id;for(let s=0;s<Qn&&r[s]===i[s];s++)n++;return this._bound(t.timestamp,t.id.subarray(0,n+1))}}};function Fd(e,t){for(let n=0;n<e.byteLength;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function Js(e,t){return e.timestamp===t.timestamp?Fd(e.id,t.id):e.timestamp-t.timestamp}var g1=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(e,t,n,r={}){this.relay=e,this.storage=t,this.neg=new Hd(t),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=i=>{switch(i[0]){case"NEG-MSG":{i.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${i}`);try{const s=this.neg.reconcile(i[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{const s=i[2];console.warn("negentropy error:",s),r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){const e=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${e}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},y1={};V(y1,{getToken:()=>w1,hashPayload:()=>qa,unpackEventFromToken:()=>jd,validateEvent:()=>Gd,validateEventKind:()=>qd,validateEventMethodTag:()=>Vd,validateEventPayloadTag:()=>Kd,validateEventTimestamp:()=>Wd,validateEventUrlTag:()=>zd,validateToken:()=>v1});var Dd="Nostr ";async function w1(e,t,n,r=!1,i){const s={kind:La,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",qa(i)]);const o=await n(s);return(r?Dd:"")+Lt.encode(Ke.encode(JSON.stringify(o)))}async function v1(e,t,n){const r=await jd(e).catch(s=>{throw s});return await Gd(r,t,n).catch(s=>{throw s})}async function jd(e){if(!e)throw new Error("Missing token");e=e.replace(Dd,"");const t=_t.decode(Lt.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Wd(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function qd(e){return e.kind===La}function zd(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Vd(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function qa(e){const t=Pn(Ke.encode(JSON.stringify(e)));return we(t)}function Kd(e,t){const n=e.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=qa(t);return n.length>0&&n[1]===r}async function Gd(e,t,n,r){if(!Sa(e))throw new Error("Invalid nostr event, signature invalid");if(!qd(e))throw new Error("Invalid nostr event, kind invalid");if(!Wd(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!zd(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Vd(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Kd(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function Oi(e){const n=Date.now()/1e3-e;return n<60?"now":n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:n<604800?`${Math.floor(n/86400)}d`:n<2592e3?`${Math.floor(n/604800)}w`:`${Math.floor(n/2592e3)}mo`}function Ne(e){return e<1e3?e.toString():e<1e6?(e/1e3).toFixed(1)+"k":e<1e9?(e/1e6).toFixed(1)+"m":(e/1e9).toFixed(1)+"b"}function b1(e){try{const t=new URL(e);return t.protocol==="ws:"||t.protocol==="wss:"}catch{return!1}}function Zd(e,t,n="desc"){return[...e].sort((i,s)=>{let o=0;switch(t){case"count":o=i.count-s.count;break;case"recent":o=i.lastSeen-s.lastSeen;break;case"trending":o=(i.trending?1:0)-(s.trending?1:0),o===0&&(o=i.count-s.count);break;case"alphabetical":o=i.hashtag.localeCompare(s.hashtag);break}return n==="desc"?-o:o})}function ri(e){try{return gd.npubEncode(e)}catch(t){return console.error(`Failed to encode npub: ${t}`),"invalid npub"}}function Cr(e){const t=["#ef4444","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e"];let n=0;for(let r=0;r<e.length;r++)n=e.charCodeAt(r)+((n<<5)-n);return t[Math.abs(n)%t.length]}const[Mo,Yl]=Kr(ci.getSettings()),m1={settings:Mo,updateSettings:e=>{Yl(qi(t=>Object.assign(t,e))),ci.saveSettings({...Mo,...e})},resetSettings:()=>{const e=ci.getSettings();Yl(e),ci.saveSettings(e)}},[Xs,eu]=Kr([]),x1={relays:Xs,setRelays:e=>{eu(e)},reset:()=>eu([]),get activeRelays(){return Xs.filter(e=>e.enabled&&e.metrics.connected)},get enabledRelays(){return Xs.filter(e=>e.enabled)}},[Wn,tu]=Kr([]),[E1,nu]=de(null),$1={hashtags:Wn,selectedHashtag:E1,setSelectedHashtag:nu,reset:()=>{tu([]),nu(null)},get trendingHashtags(){const e=Date.now(),t=60*60*1e3;return Wn.filter(n=>n.trending||n.lastSeen>e-t&&n.count>5)},updateHashtagCount:(e,t,n=1)=>{tu(qi(r=>{const i=r.find(s=>s.hashtag===e);i?(i.count+=n,t*1e3>i.lastSeen&&(i.lastSeen=t*1e3)):r.push({hashtag:e,count:n,lastSeen:t*1e3,trending:!1})})),Jd.setStat("uniqueHashtags",Wn.length)},getSortedHashtags:(e,t="desc")=>Zd([...Wn],e,t),get totalHashtags(){return Wn.length},get totalCounts(){return Wn.reduce((e,t)=>e+t.count,0)}},[ru,iu]=Kr({}),S1={profiles:ru,getProfile:e=>ru[e],setProfile:e=>{iu(qi(t=>{t[e.pubkey]=e}))},reset:()=>iu({})},[_1,Qs]=de(null),[k1,A1]=de(""),[C1,R1]=de({key:Mo.defaultSort,label:"Count",direction:"desc"}),[L1,T1]=de({}),[I1,U1]=de(!1),O1={activePanel:_1,setActivePanel:Qs,searchQuery:k1,setSearchQuery:A1,currentSort:C1,setCurrentSort:R1,eventFilter:L1,setEventFilter:T1,isLoading:I1,setIsLoading:U1,togglePanel:e=>{Qs(t=>t===e?null:e)},closePanel:()=>{Qs(null)}},[qn,su]=Kr({eventsReceived:0,uniqueHashtags:0,activeRelays:0,uptime:0,lastUpdate:0}),Jd={stats:qn,setStat:(e,t)=>{su(qi(n=>{n[e]=t}))},reset:()=>su({eventsReceived:0,uniqueHashtags:0,activeRelays:0,uptime:0,lastUpdate:0}),get formattedStats(){return{eventsReceived:Ne(qn.eventsReceived),uniqueHashtags:Ne(qn.uniqueHashtags),activeRelays:qn.activeRelays.toString(),uptime:Math.floor(qn.uptime/1e3/60),lastUpdate:qn.lastUpdate}}},U={settings:m1,relays:x1,hashtags:$1,profiles:S1,ui:O1,stats:Jd},ou=()=>{const e=U.ui.searchQuery().toLowerCase(),t=U.ui.currentSort();if(!U.hashtags.hashtags||!Array.isArray(U.hashtags.hashtags))return[];let n=[...U.hashtags.hashtags];return e&&(n=n.filter(r=>r.hashtag.toLowerCase().includes(e))),Zd(n,t.key,t.direction)};var N1=D('<header class="wireframe-border bg-wireframe-50 border-b sticky top-0 z-30"><div class="px-4 py-3 flex items-center justify-between"><a href=/#/ class="flex items-center space-x-2"title="Tagstr - Nostr hashtag explorer"><h1 class="text-xl font-bold tracking-tight"title="Application name">tagstr</h1><div class="text-xs text-wireframe-500 hidden sm:block"title="Current version">v0.1.0</div></a><div class="flex-1 max-w-md mx-4"><div><input id=search-input type=text placeholder="Search hashtags..."class="wireframe-input w-full pl-8 pr-4 text-sm placeholder-wireframe-500"title="Search through discovered hashtags by name"><div class="absolute left-2 top-1/2 transform -translate-y-1/2 text-wireframe-400"title="Search icon"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div></div><div class="text-xs text-wireframe-400 mt-1 text-center"></div></div><div class="flex items-center space-x-2"><button title="Open relay monitor - view and manage Nostr relay connections"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path></svg><div class="absolute -top-1 -right-1 bg-wireframe-600 text-wireframe-50 text-xs rounded-full w-5 h-5 flex items-center justify-center"title="Number of active relay connections"></div></button></div></div><div class="px-4 py-2 border-t border-wireframe-200 bg-wireframe-50 flex items-center justify-between text-sm"title="Hashtag sorting and statistics"><div class="flex items-center space-x-4"><h2 class="text-lg font-semibold"title="Main content area showing all discovered hashtags">Hashtag Feed</h2></div><div class="text-wireframe-500 text-xs"title="Total hashtags discovered and their combined usage count"> hashtags  <!> total uses'),B1=D('<button class="absolute right-2 top-1/2 transform -translate-y-1/2 text-wireframe-400 hover:text-wireframe-600"title="Clear search query"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M6 18L18 6M6 6l12 12">'),M1=D('<div class=animate-pulse-slow title="Loading data from relays"><svg class="w-5 h-5 text-wireframe-400"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">');const P1=()=>{const[e,t]=de(!1),n=o=>{const a=o.target;U.ui.setSearchQuery(a.value)},r=()=>{t(!0)},i=()=>{t(!1)},s=()=>{U.ui.togglePanel("relay")};return(()=>{var o=N1(),a=o.firstChild,c=a.firstChild,l=c.nextSibling,u=l.firstChild,f=u.firstChild;f.nextSibling;var d=u.nextSibling,h=l.nextSibling,g=h.firstChild,p=g.firstChild,y=p.nextSibling,v=a.nextSibling,$=v.firstChild,S=$.nextSibling,_=S.firstChild,I=_.nextSibling;return I.nextSibling,f.addEventListener("blur",i),f.addEventListener("focus",r),f.$$input=n,T(u,(()=>{var k=ke(()=>!!U.ui.searchQuery());return()=>k()&&(()=>{var R=B1();return R.$$click=()=>U.ui.setSearchQuery(""),R})()})(),null),T(d,()=>e()&&"Press Esc to close  Ctrl+/ to focus"),g.$$click=s,T(y,()=>U.relays.activeRelays.length),T(h,(()=>{var k=ke(()=>!!U.ui.isLoading());return()=>k()&&M1()})(),null),T(S,()=>U.hashtags.totalHashtags,_),T(S,()=>U.hashtags.totalCounts,I),re(k=>{var R=`relative transition-all duration-200 ${e()?"scale-105":""}`,A=`wireframe-button p-2 relative ${U.ui.activePanel()==="relay"?"bg-wireframe-200 border-wireframe-600":"hover:bg-wireframe-100"}`;return R!==k.e&&Jn(u,k.e=R),A!==k.t&&Jn(g,k.t=A),k},{e:void 0,t:void 0}),re(()=>f.value=U.ui.searchQuery()),o})()};Vr(["input","click"]);const H1=e=>{const[t,n]=de(Oi(e.timestamp));let r;return ca(()=>{r=setInterval(()=>{n(Oi(e.timestamp))},1e4)}),Wi(()=>{clearInterval(r)}),ke(t)};var F1=D('<div class="flex flex-col items-center justify-center py-16 px-4 text-center"title="No hashtags to display"><div class="w-16 h-16 border border-wireframe-300 rounded-full flex items-center justify-center mb-4"title="Hashtag icon"><svg class="w-8 h-8 text-wireframe-400"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg></div><h3 class="text-lg font-medium text-wireframe-700 mb-2"title="Current state message"></h3><p class="text-wireframe-500 max-w-sm">'),D1=D('<div class="flex-1 overflow-auto"><div class="divide-y divide-wireframe-200"title="List of discovered hashtags">'),j1=D('<button class="wireframe-button mt-4 px-4 py-2 hover:bg-wireframe-100"title="Open relay configuration to connect to Nostr relays and start discovering hashtags">Configure Relays'),W1=D('<div class="flex items-center space-x-1 text-xs text-red-500"title="This hashtag is currently trending with high activity"><div class="w-1.5 h-1.5 bg-red-500 rounded-full animate-pulse"title="Trending indicator"></div><span>trending'),q1=D('<div class="hashtag-item group"><div class="flex items-center space-x-3"><div class="w-3 h-3 rounded-full border border-wireframe-300"></div><div class="flex-1 min-w-0"><div class="flex items-center space-x-2"><span class="font-medium text-wireframe-800">#</span></div><div class="text-xs text-wireframe-500"title="When this hashtag was last seen in an event">Last seen </div></div></div><div class="flex items-center space-x-2"><div class=text-right><div class="font-semibold text-wireframe-800"></div><div class="text-xs text-wireframe-500">uses</div></div><div class="text-wireframe-400 group-hover:text-wireframe-600 transition-colors"title="Click to view hashtag details"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9 5l7 7-7 7">');const z1=()=>{const e=t=>{U.hashtags.setSelectedHashtag(t),Si(`/hashtag/${encodeURIComponent(t)}`)};return(()=>{var t=D1(),n=t.firstChild;return T(t,q(Fe,{get when(){return!ou()?.length},get children(){var r=F1(),i=r.firstChild,s=i.nextSibling,o=s.nextSibling;return T(s,()=>U.ui.searchQuery()?"No hashtags found":"No hashtags yet"),T(o,(()=>{var a=ke(()=>!!U.ui.searchQuery());return()=>a()?`No hashtags match "${U.ui.searchQuery()}". Try a different search term.`:"Connect to relays and start discovering hashtags from the nostr network."})()),T(r,(()=>{var a=ke(()=>!U.ui.searchQuery());return()=>a()&&(()=>{var c=j1();return c.$$click=()=>U.ui.setActivePanel("relay"),c})()})(),null),r}}),n),T(n,q(ln,{get each(){return ou()||[]},children:(r,i)=>(()=>{var s=q1(),o=s.firstChild,a=o.firstChild,c=a.nextSibling,l=c.firstChild,u=l.firstChild;u.firstChild;var f=l.nextSibling;f.firstChild;var d=o.nextSibling,h=d.firstChild,g=h.firstChild;return s.$$click=()=>e(r.hashtag),T(u,()=>r.hashtag,null),T(l,q(Fe,{get when(){return r.trending},get children(){return W1()}}),null),T(f,q(H1,{get timestamp(){return r.lastSeen/1e3}}),null),T(g,()=>r.count.toLocaleString()),re(p=>{var y=`Click to view detailed insights for #${r.hashtag} - used ${r.count} times`,v=`background-color: ${Cr(r.hashtag)}`,$=`Color identifier for #${r.hashtag}`,S=`Hashtag: ${r.hashtag}`,_=`This hashtag has been used ${r.count} times`;return y!==p.e&&De(s,"title",p.e=y),p.t=kr(a,v,p.t),$!==p.a&&De(a,"title",p.a=$),S!==p.o&&De(u,"title",p.o=S),_!==p.i&&De(h,"title",p.i=_),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),s})()})),t})()};Vr(["click"]);var V1=D('<footer class="stats-bar sticky bottom-0 z-20"title="Real-time application statistics and connection status"><div class="flex items-center space-x-4"title="Connection status and performance metrics"><div class="flex items-center space-x-2"title="Nostr relay connection status"><div title="Connection status indicator"><div></div></div><span title="Number of active relay connections out of total enabled relays">/<!> relays</span></div><div class="flex items-center space-x-1"title="Total number of Nostr events received from all relays"><svg class="w-3 h-3 text-wireframe-600"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg><span> events</span></div><div class="flex items-center space-x-1"title="Number of unique hashtags discovered in events"><svg class="w-3 h-3 text-wireframe-600"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"></path></svg><span> tags</span></div></div><div class="flex items-center space-x-4"title="System uptime and activity information"><div class="flex items-center space-x-1"title="How long the application has been running"><svg class="w-3 h-3 text-wireframe-600"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M13 12a1 1 0 11-2 0 1 1 0 012 0z"></path></svg><span>'),K1=D('<div class="flex items-center space-x-1"title="Fetching events seen in the last 30min"><svg class="w-3 h-3 text-wireframe-600"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>30m'),G1=D('<div class="flex items-center space-x-1"title="When the last event was received from any relay"><svg class="w-3 h-3 text-wireframe-600"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>');const Z1=e=>{const[t,n]=de(0),[r,i]=de({used:0,total:0});Eo(()=>{const a=setInterval(()=>{n(Math.floor((Date.now()-(Date.now()-U.stats.stats.uptime))/1e3))},1e3);return()=>clearInterval(a)}),Eo(()=>{if(e.nostrService){const a=e.nostrService.dbQuota$.subscribe(c=>{i(c)});return()=>a.unsubscribe()}});const s=a=>{if(a<60)return`${a}s`;if(a<3600)return`${Math.floor(a/60)}m ${a%60}s`;const c=Math.floor(a/3600),l=Math.floor(a%3600/60);return`${c}h ${l}m`},o=()=>{const a=U.relays.activeRelays.length,c=U.relays.enabledRelays.length;return a===0?{status:"disconnected",color:"text-red-500"}:a<c?{status:"partial",color:"text-yellow-500"}:{status:"connected",color:"text-green-500"}};return(()=>{var a=V1(),c=a.firstChild,l=c.firstChild,u=l.firstChild,f=u.firstChild,d=u.nextSibling,h=d.firstChild,g=h.nextSibling;g.nextSibling;var p=l.nextSibling,y=p.firstChild,v=y.nextSibling,$=v.firstChild,S=p.nextSibling,_=S.firstChild,I=_.nextSibling,k=I.firstChild,R=c.nextSibling,A=R.firstChild,H=A.firstChild,M=H.nextSibling;return T(d,()=>U.relays.activeRelays.length,h),T(d,()=>U.relays.enabledRelays.length,g),T(v,()=>Ne(U.stats.stats.eventsReceived),$),T(I,()=>Ne(U.hashtags.hashtags.length),k),T(R,(()=>{var w=ke(()=>U.stats.stats.lastUpdate>0);return()=>w()&&K1()})(),A),T(R,(()=>{var w=ke(()=>U.stats.stats.lastUpdate>0);return()=>w()&&(()=>{var m=G1(),x=m.firstChild,L=x.nextSibling;return T(L,()=>Oi(U.stats.stats.lastUpdate/1e3)),m})()})(),A),T(M,()=>s(t())),re(w=>{var m=`w-2 h-2 rounded-full ${o().color}`,x=`w-full h-full rounded-full animate-pulse ${o().status==="connected"?"bg-green-500":o().status==="partial"?"bg-yellow-500":"bg-red-500"}`,L=o().color;return m!==w.e&&Jn(u,w.e=m),x!==w.t&&Jn(f,w.t=x),L!==w.a&&Jn(d,w.a=L),w},{e:void 0,t:void 0,a:void 0}),a})()};var J1=D('<div class="flex flex-col items-center justify-center py-16 px-4 text-center"><div class="w-12 h-12 border border-wireframe-300 rounded-full flex items-center justify-center mb-4"><svg class="w-6 h-6 text-wireframe-400"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"></path></svg></div><h3 class="text-lg font-medium text-wireframe-700 mb-2">No relays configured</h3><p class="text-wireframe-500 max-w-sm">Add relay URLs above to start receiving events from the nostr network.'),X1=D('<div class="h-full flex flex-col"><div class="p-4 border-b border-wireframe-300 flex items-center justify-between"><div><h2 class="text-lg font-semibold">Relay Monitor</h2><p class="text-sm text-wireframe-500"> of <!> relays connected</p></div><button class="wireframe-button p-2 hover:bg-wireframe-100"title="Close relay monitor"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M6 18L18 6M6 6l12 12"></path></svg></button></div><div class="p-4 border-b border-wireframe-200 bg-wireframe-50"><div class=space-y-3><label class="block text-sm font-medium text-wireframe-700">Add New Relay</label><div class="flex space-x-2"><input type=text placeholder=wss://relay.example.com class="wireframe-input flex-1 text-sm"><button class="wireframe-button px-4 py-2 hover:bg-wireframe-100 disabled:opacity-50 disabled:cursor-not-allowed"></button></div></div></div><div class="flex-1 overflow-auto"><div class="divide-y divide-wireframe-200">'),Q1=D('<svg class="w-4 h-4 animate-spin"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">'),Y1=D('<p class="text-xs text-red-500 mt-1 ml-5">'),e2=D('<div class="p-2 hover:bg-wireframe-50"><div class="flex items-center justify-between space-x-3"><div class="flex-1 min-w-0"><div class="flex items-center space-x-2"><div></div><span class="font-medium text-sm truncate"></span><span class="text-xs bg-wireframe-200 text-wireframe-600 px-2 py-0.5 rounded-full">Events: </span></div></div><div class="flex items-center space-x-2"><button class="wireframe-button p-1 hover:bg-red-50 hover:border-red-300 text-red-600"title="Remove relay"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">');const t2=e=>{const[t,n]=de(""),[r,i]=de(!1),s=()=>{U.ui.closePanel()},o=()=>{const c=t().trim();if(!c)return;if(!b1(c)){alert("Please enter a valid WebSocket URL (ws:// or wss://)");return}if(U.relays.relays.find(u=>u.url===c)){alert("This relay is already added");return}i(!0),e.nostrService.connectToRelay(c),n(""),setTimeout(()=>{i(!1)},2e3)},a=c=>{confirm(`Remove relay ${c}?`)&&e.nostrService.removeRelay(c)};return(()=>{var c=X1(),l=c.firstChild,u=l.firstChild,f=u.firstChild,d=f.nextSibling,h=d.firstChild,g=h.nextSibling;g.nextSibling;var p=u.nextSibling,y=l.nextSibling,v=y.firstChild,$=v.firstChild,S=$.nextSibling,_=S.firstChild,I=_.nextSibling,k=y.nextSibling,R=k.firstChild;return T(d,()=>U.relays.activeRelays.length,h),T(d,()=>U.relays.relays.length,g),p.$$click=s,_.addEventListener("keypress",A=>A.key==="Enter"&&o()),_.$$input=A=>n(A.target.value),I.$$click=o,T(I,(()=>{var A=ke(()=>!!r());return()=>A()?Q1():"Add"})()),T(R,q(ln,{get each(){return U.relays.relays},children:A=>(()=>{var H=e2(),M=H.firstChild,w=M.firstChild,m=w.firstChild,x=m.firstChild,L=x.nextSibling,b=L.nextSibling;b.firstChild;var E=w.nextSibling,C=E.firstChild;return T(L,()=>A.url.replace(/^wss?:\/\//,"")),T(b,()=>Ne(A.metrics.eventsReceived),null),T(w,q(Fe,{get when(){return ke(()=>!A.metrics.connected)()&&A.metrics.error},get children(){var B=Y1();return T(B,()=>A.metrics.error),B}}),null),C.$$click=()=>a(A.url),re(()=>Jn(x,`w-3 h-3 rounded-full flex-shrink-0 ${A.metrics.connected?"bg-green-500":"bg-red-500"}`)),H})()})),T(k,q(Fe,{get when(){return U.relays.relays.length===0},get children(){return J1()}}),null),re(A=>{var H=r(),M=r()||!t().trim();return H!==A.e&&(_.disabled=A.e=H),M!==A.t&&(I.disabled=A.t=M),A},{e:void 0,t:void 0}),re(()=>_.value=t()),c})()};Vr(["click","input"]);var n2=D("<div>"),r2=D("<br>"),i2=D('<img class="max-w-full rounded-lg my-2">'),s2=D('<video controls class="max-w-full rounded-lg my-2">'),o2=D('<a target=_blank rel="noopener noreferrer"class="text-blue-500 hover:underline">');const a2=/(https?:\/\/\S+)/g,c2=[".jpg",".jpeg",".png",".gif",".webp"],l2=[".mp4",".webm",".mov"],u2=e=>{const t=()=>{const n=e.content,r=[];let i=0,s;for(;(s=a2.exec(n))!==null;){s.index>i&&r.push(n.substring(i,s.index));const o=s[0],a=c2.some(l=>o.toLowerCase().endsWith(l)),c=l2.some(l=>o.toLowerCase().endsWith(l));a?r.push({type:"image",url:o}):c?r.push({type:"video",url:o}):r.push({type:"link",url:o}),i=s.index+o.length}return i<n.length&&r.push(n.substring(i)),r};return(()=>{var n=n2();return T(n,q(ln,{get each(){return t()},children:r=>{if(typeof r=="string"){const i=r.split(`
`);return q(ln,{each:i,children:(s,o)=>[s,ke(()=>ke(()=>o()<i.length-1)()&&r2())]})}if(r.type==="image")return(()=>{var i=i2();return re(()=>De(i,"src",r.url)),i})();if(r.type==="video")return(()=>{var i=s2();return re(()=>De(i,"src",r.url)),i})();if(r.type==="link")return(()=>{var i=o2();return T(i,()=>r.url),re(()=>De(i,"href",r.url)),i})()}})),n})()};var f2=D('<div class="flex flex-col items-center justify-center py-16 px-4 text-center"><div class="w-16 h-16 border border-wireframe-300 rounded-full flex items-center justify-center mb-4"><svg class="w-8 h-8 text-wireframe-400"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg></div><h3 class="text-lg font-medium text-wireframe-700 mb-2"></h3><p class="text-wireframe-500 max-w-sm"></p><button class="wireframe-button mt-4 px-4 py-2 hover:bg-wireframe-100">Back to Hashtag List'),d2=D('<div class="text-center text-wireframe-500 py-4">No related hashtags found'),h2=D('<div class="p-8 text-center text-wireframe-500">'),p2=D('<div class="p-4 grid grid-cols-1 lg:grid-cols-2 lg:gap-6"><div class="lg:col-span-1 space-y-6"><div class="grid grid-cols-2 md:grid-cols-2 gap-4"><div class="wireframe-border p-4 text-center"><div class="text-2xl font-bold text-wireframe-800"></div><div class="text-sm text-wireframe-500">Total Events</div></div><div class="wireframe-border p-4 text-center"><div class="text-2xl font-bold text-wireframe-800"></div><div class="text-sm text-wireframe-500">Unique Authors</div></div><div class="wireframe-border p-4 text-center"><div class="text-2xl font-bold text-wireframe-800"></div><div class="text-sm text-wireframe-500">Related Tags</div></div><div class="wireframe-border p-4 text-center"><div class="text-2xl font-bold text-wireframe-800"></div><div class="text-sm text-wireframe-500">Source Relays</div></div></div><div class=wireframe-border><div class="p-4 border-b border-wireframe-200"><h2 class="text-lg font-semibold">Related Hashtags</h2><p class="text-sm text-wireframe-500">Tags commonly used with #</p></div><div class=p-4><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-2"></div></div></div><div class=wireframe-border><div class="p-4 border-b border-wireframe-200"><h2 class="text-lg font-semibold">Top Authors</h2><p class="text-sm text-wireframe-500">Most active users for #</p></div><div class="divide-y divide-wireframe-200"></div></div></div><div class=lg:col-span-1><div class=wireframe-border><div class="p-4 border-b border-wireframe-200"><h2 class="text-lg font-semibold">Recent Events</h2><p class="text-sm text-wireframe-500">Latest posts mentioning #</p></div><div class="divide-y divide-wireframe-200">'),g2=D('<div class="flex-1 overflow-auto"><div class="sticky top-0 bg-wireframe-50 border-b border-wireframe-200 px-4 py-4 z-10"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><button class="wireframe-button p-2 hover:bg-wireframe-100"title="Back to hashtag list"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=2 d="M15 19l-7-7 7-7"></path></svg></button><div class="flex items-center space-x-3"><div class="w-6 h-6 rounded-full border border-wireframe-300"></div><div><h1 class="text-xl font-bold">#</h1><div class="text-sm text-wireframe-500"></div></div></div></div><div class="flex items-center space-x-2"></div></div></div><div class=h-4>'),y2=D('<div class="flex items-center space-x-1 text-red-500 text-sm"><div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div><span>Trending'),w2=D('<button class="wireframe-button text-left p-3 hover:bg-wireframe-100 flex items-center justify-between"><div class="flex items-center space-x-2"><div class="w-3 h-3 rounded-full"></div><span class=font-medium>#</span></div><span class="text-sm text-wireframe-500">'),au=D('<img alt="profile picture"class="w-8 h-8 rounded-full flex-shrink-0">'),v2=D('<div class="p-4 flex items-center justify-between"><div class="flex flex-1 items-center space-x-3 min-w-0"><div class=min-w-0><div class="font-medium truncate"><a target=_blank></a></div><div class="text-sm text-wireframe-500 truncate"></div></div></div><div class=text-right><div class=font-semibold></div><div class="text-xs text-wireframe-500">events'),cu=D('<div class="w-8 h-8 rounded-full flex-shrink-0">'),b2=D('<div class=p-4><div class="flex items-start space-x-3"><div class="flex-1 min-w-0"><div class="flex items-center space-x-2 mb-1"><div class="text-sm font-medium truncate"><a target=_blank></a></div><span class="text-xs text-wireframe-500"></span></div><div class="text-sm text-wireframe-700 break-words"></div><div class="flex flex-wrap gap-1 mt-2">'),m2=D('<span class="inline-block bg-wireframe-100 text-wireframe-600 text-xs px-2 py-1 rounded">#');const x2=e=>{const t=Zn(()=>uy().tag||""),[n,r]=de([]),[i,s]=de(null),[o,a]=de(!0);let c=null;const l=d=>{const h=e.nostrService.getHashtagEvents(d);r(h);const g=U.hashtags.hashtags.find(S=>S.hashtag.toLowerCase()===d.toLowerCase()),p=new Map,y=new Map;h.forEach(S=>{p.set(S.pubkey,(p.get(S.pubkey)||0)+1),S.tags.forEach(_=>{_[0]==="t"&&_[1]!==d&&y.set(_[1],(y.get(_[1])||0)+1)})});const v=e.nostrService.getHashtagRelayDistribution(d),$={hashtag:d,totalEvents:h.length||(g?g.count:0),uniqueAuthors:p.size,relatedTags:Array.from(y.entries()).map(([S,_])=>({tag:S,count:_})).sort((S,_)=>_.count-S.count).slice(0,20),topAuthors:Array.from(p.entries()).map(([S,_])=>({pubkey:S,count:_,profile:U.profiles.getProfile(S)})).sort((S,_)=>_.count-S.count).slice(0,10),relayDistribution:v.sort((S,_)=>_.count-S.count),timeDistribution:[]};s($)};ca(async()=>{const d=t();if(d){a(!0);try{console.log("Loading hashtag data for:",d),l(d);const h=U.hashtags.hashtags.find(g=>g.hashtag.toLowerCase()===d.toLowerCase());console.log("Hashtag in store:",h),console.log("Events found:",n().length),c=e.nostrService.events$.subscribe(g=>{g&&g.tags.some(p=>p[0]==="t"&&p[1]?.toLowerCase()===d.toLowerCase())&&(console.log("New event for hashtag:",d,g),l(d))})}catch(h){console.error("Error loading hashtag data:",h)}finally{a(!1)}}}),Wi(()=>{c&&c.unsubscribe()});const u=()=>{Si("/"),U.hashtags.setSelectedHashtag(null)},f=d=>{Si(`/hashtag/${encodeURIComponent(d)}`),U.hashtags.setSelectedHashtag(d)};return(()=>{var d=g2(),h=d.firstChild,g=h.firstChild,p=g.firstChild,y=p.firstChild,v=y.nextSibling,$=v.firstChild,S=$.nextSibling,_=S.firstChild;_.firstChild;var I=_.nextSibling,k=p.nextSibling,R=h.nextSibling;return y.$$click=u,T(_,t,null),T(I,(()=>{var A=ke(()=>!!i());return()=>A()?`${Ne(i().totalEvents)} events from ${Ne(i().uniqueAuthors)} authors`:o()?"Loading insights...":"No data available"})()),T(k,()=>U.hashtags.hashtags.find(H=>H.hashtag===t())?.trending&&y2()),T(d,q(Fe,{get when(){return ke(()=>!o())()&&(!i()||i().totalEvents===0)},get children(){var A=f2(),H=A.firstChild,M=H.nextSibling,w=M.nextSibling,m=w.nextSibling;return T(M,()=>{const x=U.hashtags.hashtags.find(L=>L.hashtag.toLowerCase()===t().toLowerCase());return x&&x.count>0?`Waiting for new #${t()} events`:`No data for #${t()}`}),T(w,()=>{const x=U.hashtags.hashtags.find(L=>L.hashtag.toLowerCase()===t().toLowerCase());return x&&x.count>0?`This hashtag has been used ${x.count} times, but detailed event data is only available for new events received while the app is running.`:"This hashtag hasn't been seen in recent events. It might be new or not actively used."}),m.$$click=u,A}}),R),T(d,q(Fe,{get when(){return ke(()=>!!(!o()&&i()))()&&i().totalEvents>0},get children(){var A=p2(),H=A.firstChild,M=H.firstChild,w=M.firstChild,m=w.firstChild,x=w.nextSibling,L=x.firstChild,b=x.nextSibling,E=b.firstChild,C=b.nextSibling,B=C.firstChild,N=M.nextSibling,F=N.firstChild,O=F.firstChild,P=O.nextSibling;P.firstChild;var K=F.nextSibling,ae=K.firstChild,We=N.nextSibling,Be=We.firstChild,Ie=Be.firstChild,yt=Ie.nextSibling;yt.firstChild;var wt=Be.nextSibling,Gt=H.nextSibling,Qr=Gt.firstChild,Ue=Qr.firstChild,Zt=Ue.firstChild,mn=Zt.nextSibling;mn.firstChild;var xr=Ue.nextSibling;return T(m,()=>Ne(i().totalEvents)),T(L,()=>Ne(i().uniqueAuthors)),T(E,()=>Ne(i().relatedTags.length)),T(B,()=>Ne(i().relayDistribution.length)),T(P,t,null),T(K,q(Fe,{get when(){return i().relatedTags.length===0},get children(){return d2()}}),ae),T(ae,q(ln,{get each(){return i().relatedTags.slice(0,12)},children:j=>(()=>{var qe=w2(),Ye=qe.firstChild,vt=Ye.firstChild,Jt=vt.nextSibling;Jt.firstChild;var xn=Ye.nextSibling;return qe.$$click=()=>f(j.tag),T(Jt,()=>j.tag,null),T(xn,()=>Ne(j.count)),re(En=>kr(vt,`background-color: ${Cr(j.tag)}`,En)),qe})()})),T(yt,t,null),T(wt,q(ln,{get each(){return i().topAuthors.slice(0,10)},children:(j,qe)=>(()=>{var Ye=v2(),vt=Ye.firstChild,Jt=vt.firstChild,xn=Jt.firstChild,En=xn.firstChild,Ns=xn.nextSibling,Yr=vt.nextSibling,Bs=Yr.firstChild;return T(vt,q(Fe,{get when(){return j.profile?.picture},get fallback(){return(()=>{var ue=cu();return re($n=>kr(ue,`background-color: ${Cr(j.pubkey)}`,$n)),ue})()},get children(){var ue=au();return re(()=>De(ue,"src",j.profile.picture)),ue}}),Jt),T(En,()=>j.profile?.display_name||j.profile?.name||ri(j.pubkey)),T(Ns,()=>ri(j.pubkey)),T(Bs,()=>Ne(j.count)),re(()=>De(En,"href",`https://nostr.at/${ri(j.pubkey)}`)),Ye})()})),T(mn,t,null),T(xr,q(ln,{get each(){return n().filter(j=>j.kind!==0&&j.kind!==10002).slice(0,20)},children:j=>(()=>{var qe=b2(),Ye=qe.firstChild,vt=Ye.firstChild,Jt=vt.firstChild,xn=Jt.firstChild,En=xn.firstChild,Ns=xn.nextSibling,Yr=Jt.nextSibling,Bs=Yr.nextSibling;return T(Ye,q(Fe,{get when(){return U.profiles.profiles[j.pubkey]?.picture},get fallback(){return(()=>{var ue=cu();return re($n=>kr(ue,`background-color: ${Cr(j.pubkey)}`,$n)),ue})()},get children(){var ue=au();return re(()=>De(ue,"src",U.profiles.profiles[j.pubkey].picture)),ue}}),vt),T(En,()=>{const ue=U.profiles.profiles[j.pubkey];return ue?.display_name||ue?.name||ri(j.pubkey)}),T(Ns,()=>Oi(j.created_at)),T(Yr,q(u2,{get content(){return j.content}})),T(Bs,q(ln,{get each(){return j.tags.filter(ue=>ue[0]==="t").slice(0,5)},children:ue=>(()=>{var $n=m2();return $n.firstChild,T($n,()=>ue[1],null),$n})()})),re(()=>De(En,"href",`https://nostr.at/${j.id}`)),qe})()}),null),T(xr,q(Fe,{get when(){return ke(()=>!o())()&&n().length===0},get children(){var j=h2();return T(j,()=>{const qe=U.hashtags.hashtags.find(Ye=>Ye.hashtag.toLowerCase()===t().toLowerCase());return qe&&qe.count>0?`This hashtag has ${qe.count} recorded uses, but detailed events are not available yet. New events will appear here as they are received.`:`No recent events found for #${t()}`}),j}}),null),A}}),R),re(A=>kr($,`background-color: ${Cr(t())}`,A)),d})()};Vr(["click"]);const Ys=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const za=e=>e instanceof Uint8Array,eo=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),nt=(e,t)=>e<<32-t|e>>>t,E2=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!E2)throw new Error("Non little-endian hardware is not supported");const $2=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function ve(e){if(!za(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=$2[e[n]];return t}function Un(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const i=r*2,s=e.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function S2(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Pr(e){if(typeof e=="string"&&(e=S2(e)),!za(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function is(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!za(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Xd=class{clone(){return this._cloneInto()}};function Qd(e){const t=r=>e().update(Pr(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Yd(e=32){if(Ys&&typeof Ys.getRandomValues=="function")return Ys.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Po(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function _2(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function eh(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function k2(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Po(e.outputLen),Po(e.blockLen)}function A2(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function C2(e,t){eh(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const lt={number:Po,bool:_2,bytes:eh,hash:k2,exists:A2,output:C2};function R2(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}let L2=class extends Xd{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=eo(this.buffer)}update(t){lt.exists(this);const{view:n,buffer:r,blockLen:i}=this;t=Pr(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=eo(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){lt.exists(this),lt.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;R2(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=eo(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}};const T2=(e,t,n)=>e&t^~e&n,I2=(e,t,n)=>e&t^e&n^t&n,U2=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),tn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),nn=new Uint32Array(64);let th=class extends L2{constructor(){super(64,32,8,!1),this.A=tn[0]|0,this.B=tn[1]|0,this.C=tn[2]|0,this.D=tn[3]|0,this.E=tn[4]|0,this.F=tn[5]|0,this.G=tn[6]|0,this.H=tn[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)nn[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=nn[f-15],h=nn[f-2],g=nt(d,7)^nt(d,18)^d>>>3,p=nt(h,17)^nt(h,19)^h>>>10;nn[f]=p+nn[f-7]+g+nn[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const d=nt(a,6)^nt(a,11)^nt(a,25),h=u+d+T2(a,c,l)+U2[f]+nn[f]|0,p=(nt(r,2)^nt(r,13)^nt(r,22))+I2(r,i,s)|0;u=l,l=c,c=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){nn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},O2=class extends th{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const pr=Qd(()=>new th);Qd(()=>new O2);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function gr(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Ht(...e){const t=(i,s)=>o=>i(s(o)),n=Array.from(e).reverse().reduce((i,s)=>i?t(i,s.encode):s.encode,void 0),r=e.reduce((i,s)=>i?t(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Ft(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(gr(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function Dt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function ss(e,t="="){if(gr(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function nh(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function lu(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach(o=>{if(gr(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[c]=Math.floor(u/n),!Number.isSafeInteger(s[c])||s[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(i.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)i.push(0);return i.reverse()}const rh=(e,t)=>t?rh(t,e%t):e,Ni=(e,t)=>e+(t-rh(e,t));function Ho(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Ni(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Ni(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const c of e){if(gr(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(i=i<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function N2(e){return gr(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return lu(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(lu(t,e,2**8))}}}function wn(e,t=!1){if(gr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Ni(8,e)>32||Ni(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ho(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ho(n,e,8,t))}}}function uu(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const B2=Ht(wn(4),Ft("0123456789ABCDEF"),Dt("")),M2=Ht(wn(5),Ft("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ss(5),Dt(""));Ht(wn(5),Ft("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ss(5),Dt(""));Ht(wn(5),Ft("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Dt(""),nh(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Tt=Ht(wn(6),Ft("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ss(6),Dt("")),P2=Ht(wn(6),Ft("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ss(6),Dt("")),Va=e=>Ht(N2(58),Ft(e),Dt("")),Fo=Va("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Va("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Va("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const fu=[0,2,3,5,6,7,9,10,11],H2={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Fo.encode(r).padStart(fu[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=fu.indexOf(r.length),s=Fo.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},Do=Ht(Ft("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Dt("")),du=[996825010,642813549,513874426,1027748829,705979059];function $r(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<du.length;r++)(t>>r&1)===1&&(n^=du[r]);return n}function hu(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=$r(i)^o>>5}i=$r(i);for(let s=0;s<r;s++)i=$r(i)^e.charCodeAt(s)&31;for(let s of t)i=$r(i)^s;for(let s=0;s<6;s++)i=$r(i);return i^=n,Do.encode(Ho([i%2**30],30,5,!1))}function ih(e){const t=e==="bech32"?1:734539939,n=wn(5),r=n.decode,i=n.encode,s=uu(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);return u=u.toLowerCase(),`${u}1${Do.encode(f)}${hu(u,f,t)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=d;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=u.slice(0,h),p=u.slice(h+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");const y=Do.decode(p).slice(0,-6),v=hu(g,y,t);if(!p.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:g,words:y}}const c=uu(a);function l(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const cr=ih("bech32");ih("bech32m");const F2={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},D2=Ht(wn(4),Ft("0123456789abcdef"),Dt(""),nh(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),j2={utf8:F2,hex:D2,base16:B2,base32:M2,base64:Tt,base64url:P2,base58:Fo,base58xmr:H2};`${Object.keys(j2).join(", ")}`;let sh=class extends Xd{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,lt.hash(t);const r=Pr(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return lt.exists(this),this.iHash.update(t),this}digestInto(t){lt.exists(this),lt.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const os=(e,t,n)=>new sh(e,t).update(n).digest();os.create=(e,t)=>new sh(e,t);function W2(e,t,n){return lt.hash(e),os(e,Pr(n),Pr(t))}const to=new Uint8Array([0]),pu=new Uint8Array;function q2(e,t,n,r=32){if(lt.hash(e),lt.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);n===void 0&&(n=pu);const s=new Uint8Array(i*e.outputLen),o=os.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)to[0]=l+1,a.update(l===0?pu:c).update(n).update(to).digestInto(c),s.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),to.fill(0),s.slice(0,r)}var z2=Object.defineProperty,J=(e,t)=>{for(var n in t)z2(e,n,{get:t[n],enumerable:!0})},zn=Symbol("verified"),V2=e=>e instanceof Object;function Ka(e){if(!V2(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var K2={};J(K2,{Queue:()=>X2,QueueNode:()=>oh,binarySearch:()=>Ga,bytesToHex:()=>ve,hexToBytes:()=>Un,insertEventIntoAscendingList:()=>J2,insertEventIntoDescendingList:()=>Z2,normalizeURL:()=>G2,utf8Decoder:()=>kt,utf8Encoder:()=>Ge});var kt=new TextDecoder("utf-8"),Ge=new TextEncoder;function G2(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function Z2(e,t){const[n,r]=Ga(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function J2(e,t){const[n,r]=Ga(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return r||e.splice(n,0,t),e}function Ga(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var oh=class{value;next=null;prev=null;constructor(t){this.value=t}},X2=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const n=new oh(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},Q2=class{generateSecretKey(){return oe.utils.randomPrivateKey()}getPublicKey(t){return ve(oe.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=ve(oe.getPublicKey(n)),r.id=fi(r),r.sig=ve(oe.sign(fi(r),n)),r[zn]=!0,r}verifyEvent(t){if(typeof t[zn]=="boolean")return t[zn];const n=fi(t);if(n!==t.id)return t[zn]=!1,!1;try{const r=oe.verify(t.sig,n,t.pubkey);return t[zn]=r,r}catch{return t[zn]=!1,!1}}};function Y2(e){if(!Ka(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function fi(e){let t=pr(Ge.encode(Y2(e)));return ve(t)}var as=new Q2,ex=as.generateSecretKey,Za=as.getPublicKey,ht=as.finalizeEvent,Ja=as.verifyEvent,z={};J(z,{Application:()=>Yx,BadgeAward:()=>cx,BadgeDefinition:()=>Vx,BlockedRelaysList:()=>Lx,BookmarkList:()=>Ax,Bookmarksets:()=>Wx,Calendar:()=>oE,CalendarEventRSVP:()=>aE,ChannelCreation:()=>dh,ChannelHideMessage:()=>gh,ChannelMessage:()=>ph,ChannelMetadata:()=>hh,ChannelMuteUser:()=>yh,ClassifiedListing:()=>nE,ClientAuth:()=>vh,CommunitiesList:()=>Cx,CommunityDefinition:()=>uE,CommunityPostApproval:()=>yx,Contacts:()=>sx,CreateOrUpdateProduct:()=>Zx,CreateOrUpdateStall:()=>Gx,Curationsets:()=>qx,Date:()=>iE,DirectMessageRelaysList:()=>Ox,DraftClassifiedListing:()=>rE,DraftLong:()=>Xx,Emojisets:()=>Qx,EncryptedDirectMessage:()=>ox,EventDeletion:()=>ax,FileMetadata:()=>ux,FileServerPreference:()=>Nx,Followsets:()=>Fx,GenericRepost:()=>tc,Genericlists:()=>Dx,GiftWrap:()=>wh,HTTPAuth:()=>nc,Handlerinformation:()=>lE,Handlerrecommendation:()=>cE,Highlights:()=>$x,InterestsList:()=>Ix,Interestsets:()=>Kx,JobFeedback:()=>bx,JobRequest:()=>wx,JobResult:()=>vx,Label:()=>gx,LightningPubRPC:()=>Mx,LiveChatMessage:()=>fx,LiveEvent:()=>eE,LongFormArticle:()=>Jx,Metadata:()=>rx,Mutelist:()=>Sx,NWCWalletInfo:()=>Bx,NWCWalletRequest:()=>bh,NWCWalletResponse:()=>Px,NostrConnect:()=>Hx,OpenTimestamps:()=>lx,Pinlist:()=>_x,PrivateDirectMessage:()=>fh,ProblemTracker:()=>dx,ProfileBadges:()=>zx,PublicChatsList:()=>Rx,Reaction:()=>ec,RecommendRelay:()=>ix,RelayList:()=>kx,Relaysets:()=>jx,Report:()=>hx,Reporting:()=>px,Repost:()=>Ya,Seal:()=>uh,SearchRelaysList:()=>Tx,ShortTextNote:()=>lh,Time:()=>sE,UserEmojiList:()=>Ux,UserStatuses:()=>tE,Zap:()=>Ex,ZapGoal:()=>mx,ZapRequest:()=>xx,classifyKind:()=>tx,isAddressableKind:()=>Qa,isEphemeralKind:()=>ch,isKind:()=>nx,isRegularKind:()=>ah,isReplaceableKind:()=>Xa});function ah(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Xa(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function ch(e){return 2e4<=e&&e<3e4}function Qa(e){return 3e4<=e&&e<4e4}function tx(e){return ah(e)?"regular":Xa(e)?"replaceable":ch(e)?"ephemeral":Qa(e)?"parameterized":"unknown"}function nx(e,t){const n=t instanceof Array?t:[t];return Ka(e)&&n.includes(e.kind)||!1}var rx=0,lh=1,ix=2,sx=3,ox=4,ax=5,Ya=6,ec=7,cx=8,uh=13,fh=14,tc=16,dh=40,hh=41,ph=42,gh=43,yh=44,lx=1040,wh=1059,ux=1063,fx=1311,dx=1971,hx=1984,px=1984,gx=1985,yx=4550,wx=5999,vx=6999,bx=7e3,mx=9041,xx=9734,Ex=9735,$x=9802,Sx=1e4,_x=10001,kx=10002,Ax=10003,Cx=10004,Rx=10005,Lx=10006,Tx=10007,Ix=10015,Ux=10030,Ox=10050,Nx=10096,Bx=13194,Mx=21e3,vh=22242,bh=23194,Px=23195,Hx=24133,nc=27235,Fx=3e4,Dx=30001,jx=30002,Wx=30003,qx=30004,zx=30008,Vx=30009,Kx=30015,Gx=30017,Zx=30018,Jx=30023,Xx=30024,Qx=30030,Yx=30078,eE=30311,tE=30315,nE=30402,rE=30403,iE=31922,sE=31923,oE=31924,aE=31925,cE=31989,lE=31990,uE=34550,fE={};J(fE,{getHex64:()=>rc,getInt:()=>mh,getSubscriptionId:()=>dE,matchEventId:()=>hE,matchEventKind:()=>gE,matchEventPubkey:()=>pE});function rc(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function mh(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function dE(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return e.slice(r+1,s)}function hE(e,t){return t===rc(e,"id")}function pE(e,t){return t===rc(e,"pubkey")}function gE(e,t){return t===mh(e,"kind")}var yE={};J(yE,{makeAuthEvent:()=>wE});function wE(e,t){return{kind:vh,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var vE;try{vE=WebSocket}catch{}var bE;try{bE=WebSocket}catch{}var mE={};J(mE,{BECH32_REGEX:()=>xh,Bech32MaxSize:()=>ic,NostrTypeGuard:()=>xE,decode:()=>cs,decodeNostrURI:()=>$E,encodeBytes:()=>us,naddrEncode:()=>RE,neventEncode:()=>CE,noteEncode:()=>kE,nprofileEncode:()=>AE,npubEncode:()=>_E,nsecEncode:()=>SE});var xE={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},ic=5e3,xh=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function EE(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function $E(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),cs(e)}catch{return{type:"invalid",data:null}}}function cs(e){let{prefix:t,words:n}=cr.decode(e,ic),r=new Uint8Array(cr.fromWords(n));switch(t){case"nprofile":{let i=no(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ve(i[0][0]),relays:i[1]?i[1].map(s=>kt.decode(s)):[]}}}case"nevent":{let i=no(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ve(i[0][0]),relays:i[1]?i[1].map(s=>kt.decode(s)):[],author:i[2]?.[0]?ve(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(ve(i[3][0]),16):void 0}}}case"naddr":{let i=no(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:kt.decode(i[0][0]),pubkey:ve(i[2][0]),kind:parseInt(ve(i[3][0]),16),relays:i[1]?i[1].map(s=>kt.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:ve(r)};default:throw new Error(`unknown prefix ${t}`)}}function no(e){let t={},n=e;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function SE(e){return us("nsec",e)}function _E(e){return us("npub",Un(e))}function kE(e){return us("note",Un(e))}function ls(e,t){let n=cr.toWords(t);return cr.encode(e,n,ic)}function us(e,t){return ls(e,t)}function AE(e){let t=sc({0:[Un(e.pubkey)],1:(e.relays||[]).map(n=>Ge.encode(n))});return ls("nprofile",t)}function CE(e){let t;e.kind!==void 0&&(t=EE(e.kind));let n=sc({0:[Un(e.id)],1:(e.relays||[]).map(r=>Ge.encode(r)),2:e.author?[Un(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return ls("nevent",n)}function RE(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=sc({0:[Ge.encode(e.identifier)],1:(e.relays||[]).map(r=>Ge.encode(r)),2:[Un(e.pubkey)],3:[new Uint8Array(t)]});return ls("naddr",n)}function sc(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),t.push(s)})}),is(...t)}var LE={};J(LE,{decrypt:()=>TE,encrypt:()=>Eh});function Eh(e,t,n){const r=e instanceof Uint8Array?ve(e):e,i=Le.getSharedSecret(r,"02"+t),s=$h(i);let o=Uint8Array.from(Yd(16)),a=Ge.encode(n),c=gn(s,o).encrypt(a),l=Tt.encode(new Uint8Array(c)),u=Tt.encode(new Uint8Array(o.buffer));return`${l}?iv=${u}`}function TE(e,t,n){const r=e instanceof Uint8Array?ve(e):e;let[i,s]=n.split("?iv="),o=Le.getSharedSecret(r,"02"+t),a=$h(o),c=Tt.decode(s),l=Tt.decode(i),u=gn(a,c).decrypt(l);return kt.decode(u)}function $h(e){return e.slice(1,33)}var IE={};J(IE,{NIP05_REGEX:()=>oc,isNip05:()=>UE,isValid:()=>BE,queryProfile:()=>Sh,searchDomain:()=>NE,useFetchImplementation:()=>OE});var oc=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,UE=e=>oc.test(e||""),fs;try{fs=fetch}catch{}function OE(e){fs=e}async function NE(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await fs(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Sh(e){const t=e.match(oc);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await fs(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function BE(e,t){const n=await Sh(t);return n?n.pubkey===e:!1}var ME={};J(ME,{parse:()=>PE});function PE(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if(s[0]==="e"&&s[1]){const[o,a,c,l,u]=s,f={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=f;continue}if(l==="reply"){t.reply=f;continue}if(l==="mention"){t.mentions.push(f);continue}n?r=f:n=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let s=t.mentions.indexOf(i);if(s!==-1&&t.mentions.splice(s,1),i.author){let o=t.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let s=t.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),t}var HE={};J(HE,{fetchRelayInformation:()=>DE,useFetchImplementation:()=>FE});var _h;try{_h=fetch}catch{}function FE(e){_h=e}async function DE(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var jE={};J(jE,{fastEventHash:()=>Ah,getPow:()=>kh,minePow:()=>WE});function kh(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function WE(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=Ah(r),kh(r.id)>=t)break}return r}function Ah(e){return ve(pr(Ge.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var qE={};J(qE,{unwrapEvent:()=>n$,unwrapManyEvents:()=>r$,wrapEvent:()=>Fh,wrapManyEvents:()=>t$});var zE={};J(zE,{createRumor:()=>Bh,createSeal:()=>Mh,createWrap:()=>Ph,unwrapEvent:()=>fc,unwrapManyEvents:()=>Hh,wrapEvent:()=>Bi,wrapManyEvents:()=>YE});var VE={};J(VE,{decrypt:()=>uc,encrypt:()=>lc,getConversationKey:()=>ac,v2:()=>XE});var Ch=1,Rh=65535;function ac(e,t){const n=Le.getSharedSecret(e,"02"+t).subarray(1,33);return W2(pr,n,"nip44-v2")}function Lh(e,t){const n=q2(pr,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function cc(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function KE(e){if(!Number.isSafeInteger(e)||e<Ch||e>Rh)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function GE(e){const t=Ge.encode(e),n=t.length,r=KE(n),i=new Uint8Array(cc(n)-n);return is(r,t,i)}function ZE(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Ch||t>Rh||n.length!==t||e.length!==2+cc(t))throw new Error("invalid padding");return kt.decode(n)}function Th(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=is(n,t);return os(pr,e,r)}function JE(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=Tt.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function lc(e,t,n=Yd(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=Lh(t,n),o=GE(e),a=yn(r,i,o),c=Th(s,a,n);return Tt.encode(is(new Uint8Array([2]),n,a,c))}function uc(e,t){const{nonce:n,ciphertext:r,mac:i}=JE(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=Lh(t,n),c=Th(a,r,n);if(!Xi(c,i))throw new Error("invalid MAC");const l=yn(s,o,r);return ZE(l)}var XE={utils:{getConversationKey:ac,calcPaddedLen:cc},encrypt:lc,decrypt:uc},QE=2*24*60*60,Ih=()=>Math.round(Date.now()/1e3),Uh=()=>Math.round(Ih()-Math.random()*QE),Oh=(e,t)=>ac(e,t),Nh=(e,t,n)=>lc(JSON.stringify(e),Oh(t,n)),gu=(e,t)=>JSON.parse(uc(e.content,Oh(t,e.pubkey)));function Bh(e,t){const n={created_at:Ih(),content:"",tags:[],...e,pubkey:Za(t)};return n.id=fi(n),n}function Mh(e,t,n){return ht({kind:uh,content:Nh(e,t,n),created_at:Uh(),tags:[]},t)}function Ph(e,t){const n=ex();return ht({kind:wh,content:Nh(e,n,t),created_at:Uh(),tags:[["p",t]]},n)}function Bi(e,t,n){const r=Bh(e,t),i=Mh(r,t,n);return Ph(i,n)}function YE(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Za(t),i=[Bi(e,t,r)];return n.forEach(s=>{i.push(Bi(e,t,s))}),i}function fc(e,t){const n=gu(e,t);return gu(n,t)}function Hh(e,t){let n=[];return e.forEach(r=>{n.push(fc(r,t))}),n.sort((r,i)=>r.created_at-i.created_at),n}function e$(e,t,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:fh,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function Fh(e,t,n,r,i){const s=e$(t,n,r,i);return Bi(s,e,t.publicKey)}function t$(e,t,n,r,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Za(e)},...t].map(o=>Fh(e,o,n,r,i))}var n$=fc,r$=Hh,i$={};J(i$,{finishRepostEvent:()=>s$,getRepostedEvent:()=>o$,getRepostedEventPointer:()=>Dh});function s$(e,t,n,r){let i;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===lh?i=Ya:(i=tc,s.push(["k",String(t.kind)])),ht({kind:i,tags:s,content:e.content===""||t.tags?.find(o=>o[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function Dh(e){if(![Ya,tc].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function o$(e,{skipVerification:t}={}){const n=Dh(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!Ja(r)))return r}var a$={};J(a$,{NOSTR_URI_REGEX:()=>dc,parse:()=>l$,test:()=>c$});var dc=new RegExp(`nostr:(${xh.source})`);function c$(e){return typeof e=="string"&&new RegExp(`^${dc.source}$`).test(e)}function l$(e){const t=e.match(new RegExp(`^${dc.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:cs(t[1])}}var u$={};J(u$,{finishReactionEvent:()=>f$,getReactedEventPointer:()=>d$});function f$(e,t,n){const r=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return ht({...e,kind:ec,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function d$(e){if(e.kind!==ec)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var h$={};J(h$,{parse:()=>g$});var p$=/\W/m,yu=/\W |\W$|$|,| /m;function*g$(e){const t=e.length;let n=0,r=0;for(;r<t;){let i=e.indexOf(":",r);if(i===-1)break;if(e.substring(i-5,i)==="nostr"){const s=e.substring(i+60).match(p$),o=s?i+60+s.index:t;try{let a,{data:c,type:l}=cs(e.substring(i+1,o));switch(l){case"npub":a={pubkey:c};break;case"nsec":case"note":r=o+1;continue;default:a=c}n!==i-5&&(yield{type:"text",text:e.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(e.substring(i-5,i)==="https"||e.substring(i-4,i)==="http"){const s=e.substring(i+4).match(yu),o=s?i+4+s.index:t,a=e[i-1]==="s"?5:4;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),c.pathname.endsWith(".png")||c.pathname.endsWith(".jpg")||c.pathname.endsWith(".jpeg")||c.pathname.endsWith(".gif")||c.pathname.endsWith(".webp")){yield{type:"image",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp4")||c.pathname.endsWith(".avi")||c.pathname.endsWith(".webm")||c.pathname.endsWith(".mkv")){yield{type:"video",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp3")||c.pathname.endsWith(".aac")||c.pathname.endsWith(".ogg")||c.pathname.endsWith(".opus")){yield{type:"audio",url:c.toString()},r=o,n=r;continue}yield{type:"url",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(e.substring(i-3,i)==="wss"||e.substring(i-2,i)==="ws"){const s=e.substring(i+4).match(yu),o=s?i+4+s.index:t,a=e[i-1]==="s"?3:2;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),yield{type:"relay",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==t&&(yield{type:"text",text:e.substring(n)})}var y$={};J(y$,{channelCreateEvent:()=>w$,channelHideMessageEvent:()=>m$,channelMessageEvent:()=>b$,channelMetadataEvent:()=>v$,channelMuteUserEvent:()=>x$});var w$=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ht({kind:dh,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},v$=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ht({kind:hh,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},b$=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),ht({kind:ph,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},m$=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ht({kind:gh,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},x$=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return ht({kind:yh,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},E$={};J(E$,{EMOJI_SHORTCODE_REGEX:()=>jh,matchAll:()=>$$,regex:()=>hc,replaceAll:()=>S$});var jh=/:(\w+):/,hc=()=>new RegExp(`\\B${jh.source}\\B`,"g");function*$$(e){const t=e.matchAll(hc());for(const n of t)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function S$(e,t){return e.replaceAll(hc(),(n,r)=>t({shortcode:n,name:r}))}var _$={};J(_$,{useFetchImplementation:()=>k$,validateGithub:()=>A$});var pc;try{pc=fetch}catch{}function k$(e){pc=e}async function A$(e,t,n){try{return await(await pc(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var C$={};J(C$,{makeNwcRequestEvent:()=>L$,parseConnectionString:()=>R$});function R$(e){const{host:t,pathname:n,searchParams:r}=new URL(e),i=n||t,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function L$(e,t,n){const i=Eh(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:bh,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return ht(s,t)}var T$={};J(T$,{normalizeIdentifier:()=>I$});function I$(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var U$={};J(U$,{getSatoshisAmountFromBolt11:()=>H$,getZapEndpoint:()=>N$,makeZapReceipt:()=>P$,makeZapRequest:()=>B$,useFetchImplementation:()=>O$,validateZapRequest:()=>M$});var gc;try{gc=fetch}catch{}function O$(e){gc=e}async function N$(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:o}=cr.decode(n,1e3),a=cr.fromWords(o);t=kt.decode(a)}else if(r){let[o,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await gc(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function B$({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};if(t&&typeof t=="string"&&s.tags.push(["e",t]),t&&typeof t=="object"){if(Xa(t.kind)){const o=["a",`${t.kind}:${t.pubkey}:`];s.tags.push(o)}else if(Qa(t.kind)){let o=t.tags.find(([c,l])=>c==="d"&&l);if(!o)throw new Error("d tag not found or is empty");const a=["a",`${t.kind}:${t.pubkey}:${o[1]}`];s.tags.push(a)}}return s}function M$(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Ka(t))return"Zap request is not a valid Nostr event.";if(!Ja(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function P$({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}function H$(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const c=parseInt(r.substring(0,a));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var F$={};J(F$,{getToken:()=>D$,hashPayload:()=>yc,unpackEventFromToken:()=>qh,validateEvent:()=>Jh,validateEventKind:()=>Vh,validateEventMethodTag:()=>Gh,validateEventPayloadTag:()=>Zh,validateEventTimestamp:()=>zh,validateEventUrlTag:()=>Kh,validateToken:()=>j$});var Wh="Nostr ";async function D$(e,t,n,r=!1,i){const s={kind:nc,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",yc(i)]);const o=await n(s);return(r?Wh:"")+Tt.encode(Ge.encode(JSON.stringify(o)))}async function j$(e,t,n){const r=await qh(e).catch(s=>{throw s});return await Jh(r,t,n).catch(s=>{throw s})}async function qh(e){if(!e)throw new Error("Missing token");e=e.replace(Wh,"");const t=kt.decode(Tt.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function zh(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Vh(e){return e.kind===nc}function Kh(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Gh(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function yc(e){const t=pr(Ge.encode(JSON.stringify(e)));return ve(t)}function Zh(e,t){const n=e.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=yc(t);return n.length>0&&n[1]===r}async function Jh(e,t,n,r){if(!Ja(e))throw new Error("Invalid nostr event, signature invalid");if(!Vh(e))throw new Error("Invalid nostr event, kind invalid");if(!zh(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Kh(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Gh(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Zh(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function W$(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function ds(e){return 3e4<=e&&e<4e4}var jo=function(e,t){return jo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},jo(e,t)};function Qe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");jo(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Wo=function(){return Wo=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Wo.apply(this,arguments)};function q$(e,t,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(f){o(f)}}function c(u){try{l(r.throw(u))}catch(f){o(f)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(e,t||[])).next())})}function Xh(e,t){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=t.call(e,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function On(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function It(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function Ut(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,s;r<i;r++)(s||!(r in t))&&(s||(s=Array.prototype.slice.call(t,0,r)),s[r]=t[r]);return e.concat(s||Array.prototype.slice.call(t))}function Yn(e){return this instanceof Yn?(this.v=e,this):new Yn(e)}function z$(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(h){return function(g){return Promise.resolve(g).then(h,f)}}function a(h,g){r[h]&&(i[h]=function(p){return new Promise(function(y,v){s.push([h,p,y,v])>1||c(h,p)})},g&&(i[h]=g(i[h])))}function c(h,g){try{l(r[h](g))}catch(p){d(s[0][3],p)}}function l(h){h.value instanceof Yn?Promise.resolve(h.value.v).then(u,f):d(s[0][2],h)}function u(h){c("next",h)}function f(h){c("throw",h)}function d(h,g){h(g),s.shift(),s.length&&c(s[0][0],s[0][1])}}function V$(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof On=="function"?On(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=e[s]&&function(o){return new Promise(function(a,c){o=e[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function G(e){return typeof e=="function"}function hs(e){var t=function(r){Error.call(r),r.stack=new Error().stack},n=e(t);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var ro=hs(function(e){return function(n){e(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function Hr(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Hn=function(){function e(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var t,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=On(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(p){t={error:p}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}else o.remove(this);var u=this.initialTeardown;if(G(u))try{u()}catch(p){s=p instanceof ro?p.errors:[p]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var d=On(f),h=d.next();!h.done;h=d.next()){var g=h.value;try{wu(g)}catch(p){s=s??[],p instanceof ro?s=Ut(Ut([],It(s)),It(p.errors)):s.push(p)}}}catch(p){r={error:p}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}}if(s)throw new ro(s)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)wu(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(t)}},e.prototype._hasParent=function(t){var n=this._parentage;return n===t||Array.isArray(n)&&n.includes(t)},e.prototype._addParent=function(t){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t},e.prototype._removeParent=function(t){var n=this._parentage;n===t?this._parentage=null:Array.isArray(n)&&Hr(n,t)},e.prototype.remove=function(t){var n=this._finalizers;n&&Hr(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),Qh=Hn.EMPTY;function Yh(e){return e instanceof Hn||e&&"closed"in e&&G(e.remove)&&G(e.add)&&G(e.unsubscribe)}function wu(e){G(e)?e():e.unsubscribe()}var K$={Promise:void 0},G$={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,Ut([e,t],It(n)))},clearTimeout:function(e){return clearTimeout(e)},delegate:void 0};function ep(e){G$.setTimeout(function(){throw e})}function lr(){}function di(e){e()}var ps=function(e){Qe(t,e);function t(n){var r=e.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Yh(n)&&n.add(r)):r.destination=X$,r}return t.create=function(n,r,i){return new Fr(n,r,i)},t.prototype.next=function(n){this.isStopped||this._next(n)},t.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(n){this.destination.next(n)},t.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Hn),Z$=function(){function e(t){this.partialObserver=t}return e.prototype.next=function(t){var n=this.partialObserver;if(n.next)try{n.next(t)}catch(r){ii(r)}},e.prototype.error=function(t){var n=this.partialObserver;if(n.error)try{n.error(t)}catch(r){ii(r)}else ii(t)},e.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(n){ii(n)}},e}(),Fr=function(e){Qe(t,e);function t(n,r,i){var s=e.call(this)||this,o;return G(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new Z$(o),s}return t}(ps);function ii(e){ep(e)}function J$(e){throw e}var X$={closed:!0,next:lr,error:J$,complete:lr},wc=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ze(e){return e}function Q$(e){return e.length===0?Ze:e.length===1?e[0]:function(n){return e.reduce(function(r,i){return i(r)},n)}}var ee=function(){function e(t){t&&(this._subscribe=t)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(t,n,r){var i=this,s=e3(t)?t:new Fr(t,n,r);return di(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(n){t.error(n)}},e.prototype.forEach=function(t,n){var r=this;return n=vu(n),new n(function(i,s){var o=new Fr({next:function(a){try{t(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},e.prototype._subscribe=function(t){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(t)},e.prototype[wc]=function(){return this},e.prototype.pipe=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return Q$(t)(this)},e.prototype.toPromise=function(t){var n=this;return t=vu(t),new t(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},e.create=function(t){return new e(t)},e}();function vu(e){var t;return(t=e??K$.Promise)!==null&&t!==void 0?t:Promise}function Y$(e){return e&&G(e.next)&&G(e.error)&&G(e.complete)}function e3(e){return e&&e instanceof ps||Y$(e)&&Yh(e)}function t3(e){return G(e?.lift)}function te(e){return function(t){if(t3(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Z(e,t,n,r,i){return new n3(e,t,n,r,i)}var n3=function(e){Qe(t,e);function t(n,r,i,s,o,a){var c=e.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(u){n.error(u)}}:e.prototype._next,c._error=s?function(l){try{s(l)}catch(u){n.error(u)}finally{this.unsubscribe()}}:e.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:e.prototype._complete,c}return t.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},t}(ps),r3=hs(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ae=function(e){Qe(t,e);function t(){var n=e.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return t.prototype.lift=function(n){var r=new qo(this,this);return r.operator=n,r},t.prototype._throwIfClosed=function(){if(this.closed)throw new r3},t.prototype.next=function(n){var r=this;di(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=On(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},t.prototype.error=function(n){var r=this;di(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},t.prototype.complete=function(){var n=this;di(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(n){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,n)},t.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},t.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?Qh:(this.currentObservers=null,a.push(n),new Hn(function(){r.currentObservers=null,Hr(a,n)}))},t.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},t.prototype.asObservable=function(){var n=new ee;return n.source=this,n},t.create=function(n,r){return new qo(n,r)},t}(ee),qo=function(e){Qe(t,e);function t(n,r){var i=e.call(this)||this;return i.destination=n,i.source=r,i}return t.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},t.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},t.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},t.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:Qh},t}(Ae),he=function(e){Qe(t,e);function t(n){var r=e.call(this)||this;return r._value=n,r}return Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(n){var r=e.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},t.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},t.prototype.next=function(n){e.prototype.next.call(this,this._value=n)},t}(Ae),vc={now:function(){return(vc.delegate||Date).now()},delegate:void 0},Tr=function(e){Qe(t,e);function t(n,r,i){n===void 0&&(n=1/0),r===void 0&&(r=1/0),i===void 0&&(i=vc);var s=e.call(this)||this;return s._bufferSize=n,s._windowTime=r,s._timestampProvider=i,s._buffer=[],s._infiniteTimeWindow=!0,s._infiniteTimeWindow=r===1/0,s._bufferSize=Math.max(1,n),s._windowTime=Math.max(1,r),s}return t.prototype.next=function(n){var r=this,i=r.isStopped,s=r._buffer,o=r._infiniteTimeWindow,a=r._timestampProvider,c=r._windowTime;i||(s.push(n),!o&&s.push(a.now()+c)),this._trimBuffer(),e.prototype.next.call(this,n)},t.prototype._subscribe=function(n){this._throwIfClosed(),this._trimBuffer();for(var r=this._innerSubscribe(n),i=this,s=i._infiniteTimeWindow,o=i._buffer,a=o.slice(),c=0;c<a.length&&!n.closed;c+=s?1:2)n.next(a[c]);return this._checkFinalizedStatuses(n),r},t.prototype._trimBuffer=function(){var n=this,r=n._bufferSize,i=n._timestampProvider,s=n._buffer,o=n._infiniteTimeWindow,a=(o?1:2)*r;if(r<1/0&&a<s.length&&s.splice(0,s.length-a),!o){for(var c=i.now(),l=0,u=1;u<s.length&&s[u]<=c;u+=2)l=u;l&&s.splice(0,l+1)}},t}(Ae),i3=function(e){Qe(t,e);function t(n,r){return e.call(this)||this}return t.prototype.schedule=function(n,r){return this},t}(Hn),bu={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,Ut([e,t],It(n)))},clearInterval:function(e){return clearInterval(e)},delegate:void 0},s3=function(e){Qe(t,e);function t(n,r){var i=e.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return t.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},t.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),bu.setInterval(n.flush.bind(n,this),i)},t.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&bu.clearInterval(r)},t.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},t.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Hr(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(i3),mu=function(){function e(t,n){n===void 0&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(t,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,t).schedule(r,n)},e.now=vc.now,e}(),o3=function(e){Qe(t,e);function t(n,r){r===void 0&&(r=mu.now);var i=e.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return t.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},t}(mu),bc=new o3(s3),a3=bc,se=new ee(function(e){return e.complete()});function tp(e){return e&&G(e.schedule)}function mc(e){return e[e.length-1]}function c3(e){return G(mc(e))?e.pop():void 0}function yr(e){return tp(mc(e))?e.pop():void 0}function np(e,t){return typeof mc(e)=="number"?e.pop():t}var rp=function(e){return e&&typeof e.length=="number"&&typeof e!="function"};function ip(e){return G(e?.then)}function sp(e){return G(e[wc])}function op(e){return Symbol.asyncIterator&&G(e?.[Symbol.asyncIterator])}function ap(e){return new TypeError("You provided "+(e!==null&&typeof e=="object"?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function l3(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var cp=l3();function lp(e){return G(e?.[cp])}function up(e){return z$(this,arguments,function(){var n,r,i,s;return Xh(this,function(o){switch(o.label){case 0:n=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Yn(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,Yn(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Yn(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function fp(e){return G(e?.getReader)}function _e(e){if(e instanceof ee)return e;if(e!=null){if(sp(e))return u3(e);if(rp(e))return f3(e);if(ip(e))return d3(e);if(op(e))return dp(e);if(lp(e))return h3(e);if(fp(e))return p3(e)}throw ap(e)}function u3(e){return new ee(function(t){var n=e[wc]();if(G(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function f3(e){return new ee(function(t){for(var n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}function d3(e){return new ee(function(t){e.then(function(n){t.closed||(t.next(n),t.complete())},function(n){return t.error(n)}).then(null,ep)})}function h3(e){return new ee(function(t){var n,r;try{for(var i=On(e),s=i.next();!s.done;s=i.next()){var o=s.value;if(t.next(o),t.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.complete()})}function dp(e){return new ee(function(t){g3(e,t).catch(function(n){return t.error(n)})})}function p3(e){return dp(up(e))}function g3(e,t){var n,r,i,s;return q$(this,void 0,void 0,function(){var o,a;return Xh(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=V$(e),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})}function ze(e,t,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(s),!i)return s}function hp(e,t){return t===void 0&&(t=0),te(function(n,r){n.subscribe(Z(r,function(i){return ze(r,e,function(){return r.next(i)},t)},function(){return ze(r,e,function(){return r.complete()},t)},function(i){return ze(r,e,function(){return r.error(i)},t)}))})}function pp(e,t){return t===void 0&&(t=0),te(function(n,r){r.add(e.schedule(function(){return n.subscribe(r)},t))})}function y3(e,t){return _e(e).pipe(pp(t),hp(t))}function w3(e,t){return _e(e).pipe(pp(t),hp(t))}function v3(e,t){return new ee(function(n){var r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}function b3(e,t){return new ee(function(n){var r;return ze(n,t,function(){r=e[cp](),ze(n,t,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return G(r?.return)&&r.return()}})}function gp(e,t){if(!e)throw new Error("Iterable cannot be null");return new ee(function(n){ze(n,t,function(){var r=e[Symbol.asyncIterator]();ze(n,t,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function m3(e,t){return gp(up(e),t)}function x3(e,t){if(e!=null){if(sp(e))return y3(e,t);if(rp(e))return v3(e,t);if(ip(e))return w3(e,t);if(op(e))return gp(e,t);if(lp(e))return b3(e,t);if(fp(e))return m3(e,t)}throw ap(e)}function Re(e,t){return t?x3(e,t):_e(e)}function be(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yr(e);return Re(e,n)}function zo(e,t){var n=G(e)?e:function(){return e},r=function(i){return i.error(n())};return new ee(r)}function gs(e){return!!e&&(e instanceof ee||G(e.lift)&&G(e.subscribe))}var E3=hs(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function io(e,t){return new Promise(function(n,r){var i=!1,s;e.subscribe({next:function(o){s=o,i=!0},error:r,complete:function(){i?n(s):r(new E3)}})})}function yp(e){return e instanceof Date&&!isNaN(e)}var $3=hs(function(e){return function(n){n===void 0&&(n=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=n}});function Vo(e,t){var n=yp(e)?{first:e}:typeof e=="number"?{each:e}:e,r=n.first,i=n.each,s=n.with,o=s===void 0?S3:s,a=n.scheduler,c=a===void 0?bc:a,l=n.meta,u=l===void 0?null:l;if(r==null&&i==null)throw new TypeError("No timeout provided.");return te(function(f,d){var h,g,p=null,y=0,v=function($){g=ze(d,c,function(){try{h.unsubscribe(),_e(o({meta:u,lastValue:p,seen:y})).subscribe(d)}catch(S){d.error(S)}},$)};h=f.subscribe(Z(d,function($){g?.unsubscribe(),y++,d.next(p=$),i>0&&v(i)},void 0,void 0,function(){g?.closed||g?.unsubscribe(),p=null})),!y&&v(r!=null?typeof r=="number"?r:+r-c.now():i)})}function S3(e){throw new $3(e)}function ge(e,t){return te(function(n,r){var i=0;n.subscribe(Z(r,function(s){r.next(e.call(t,s,i++))}))})}var _3=Array.isArray;function k3(e,t){return _3(t)?e.apply(void 0,Ut([],It(t))):e(t)}function A3(e){return ge(function(t){return k3(e,t)})}var C3=Array.isArray,R3=Object.getPrototypeOf,L3=Object.prototype,T3=Object.keys;function I3(e){if(e.length===1){var t=e[0];if(C3(t))return{args:t,keys:null};if(U3(t)){var n=T3(t);return{args:n.map(function(r){return t[r]}),keys:n}}}return{args:e,keys:null}}function U3(e){return e&&typeof e=="object"&&R3(e)===L3}function O3(e,t){return e.reduce(function(n,r,i){return n[r]=t[i],n},{})}function xc(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yr(e),r=c3(e),i=I3(e),s=i.args,o=i.keys;if(s.length===0)return Re([],n);var a=new ee(N3(s,n,o?function(c){return O3(o,c)}:Ze));return r?a.pipe(A3(r)):a}function N3(e,t,n){return n===void 0&&(n=Ze),function(r){xu(t,function(){for(var i=e.length,s=new Array(i),o=i,a=i,c=function(u){xu(t,function(){var f=Re(e[u],t),d=!1;f.subscribe(Z(r,function(h){s[u]=h,d||(d=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function xu(e,t,n){e?ze(n,e,t):t()}function B3(e,t,n,r,i,s,o,a){var c=[],l=0,u=0,f=!1,d=function(){f&&!c.length&&!l&&t.complete()},h=function(p){return l<r?g(p):c.push(p)},g=function(p){l++;var y=!1;_e(n(p,u++)).subscribe(Z(t,function(v){t.next(v)},function(){y=!0},void 0,function(){if(y)try{l--;for(var v=function(){var $=c.shift();o||g($)};c.length&&l<r;)v();d()}catch($){t.error($)}}))};return e.subscribe(Z(t,h,function(){f=!0,d()})),function(){}}function ys(e,t,n){return n===void 0&&(n=1/0),G(t)?ys(function(r,i){return ge(function(s,o){return t(r,s,i,o)})(_e(e(r,i)))},n):(typeof t=="number"&&(n=t),te(function(r,i){return B3(r,i,e,n)}))}function ws(e){return e===void 0&&(e=1/0),ys(Ze,e)}function M3(){return ws(1)}function P3(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return M3()(Re(e,yr(e)))}function Dr(e){return new ee(function(t){_e(e()).subscribe(t)})}function Nn(e,t,n){e===void 0&&(e=0),n===void 0&&(n=a3);var r=-1;return t!=null&&(tp(t)?n=t:r=t),new ee(function(i){var s=yp(e)?+e-n.now():e;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function Ee(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yr(e),r=np(e,1/0),i=e;return i.length?i.length===1?_e(i[0]):ws(r)(Re(i,n)):se}var si=new ee(lr);function Y(e,t){return te(function(n,r){var i=0;n.subscribe(Z(r,function(s){return e.call(t,s,i++)&&r.next(s)}))})}function wp(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var s=(t=yr(r))!==null&&t!==void 0?t:bc,o=(n=r[0])!==null&&n!==void 0?n:null,a=r[1]||1/0;return te(function(c,l){var u=[],f=!1,d=function(p){var y=p.buffer,v=p.subs;v.unsubscribe(),Hr(u,p),l.next(y),f&&h()},h=function(){if(u){var p=new Hn;l.add(p);var y=[],v={buffer:y,subs:p};u.push(v),ze(p,s,function(){return d(v)},e)}};o!==null&&o>=0?ze(l,s,h,o,!0):f=!0,h();var g=Z(l,function(p){var y,v,$=u.slice();try{for(var S=On($),_=S.next();!_.done;_=S.next()){var I=_.value,k=I.buffer;k.push(p),a<=k.length&&d(I)}}catch(R){y={error:R}}finally{try{_&&!_.done&&(v=S.return)&&v.call(S)}finally{if(y)throw y.error}}},function(){for(;u?.length;)l.next(u.shift().buffer);g?.unsubscribe(),l.complete(),l.unsubscribe()},void 0,function(){return u=null});c.subscribe(g)})}function Ce(e){return te(function(t,n){var r=null,i=!1,s;r=t.subscribe(Z(n,void 0,void 0,function(o){s=_e(e(o,Ce(e)(t))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function H3(e,t,n,r,i){return function(s,o){var a=n,c=t,l=0;s.subscribe(Z(o,function(u){var f=l++;c=a?e(c,u,f):(a=!0,u),o.next(c)},i))}}function An(e){return e<=0?function(){return se}:te(function(t,n){var r=0;t.subscribe(Z(n,function(i){++r<=e&&(n.next(i),e<=r&&n.complete())}))})}function Rr(){return te(function(e,t){e.subscribe(Z(t,lr))})}function F3(e,t){return te(function(n,r){var i=new Set;n.subscribe(Z(r,function(s){var o=e?e(s):s;i.has(o)||(i.add(o),r.next(s))})),t&&_e(t).subscribe(Z(r,function(){return i.clear()},lr))})}function Ec(e,t){return t===void 0&&(t=Ze),e=e??D3,te(function(n,r){var i,s=!0;n.subscribe(Z(r,function(o){var a=t(o);(s||!e(i,a))&&(s=!1,i=a,r.next(o))}))})}function D3(e,t){return e===t}function er(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(n){return P3(n,be.apply(void 0,Ut([],It(e))))}}function Zr(e){return te(function(t,n){try{t.subscribe(n)}finally{n.add(e)}})}function j3(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=yr(e),r=np(e,1/0);return te(function(i,s){ws(r)(Re(Ut([i],It(e)),n)).subscribe(s)})}function Ko(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return j3.apply(void 0,Ut([],It(e)))}function hi(e){var t,n=1/0,r;return e!=null&&(typeof e=="object"?(t=e.count,n=t===void 0?1/0:t,r=e.delay):n=e),n<=0?function(){return se}:te(function(i,s){var o=0,a,c=function(){if(a?.unsubscribe(),a=null,r!=null){var u=typeof r=="number"?Nn(r):_e(r(o)),f=Z(s,function(){f.unsubscribe(),l()});u.subscribe(f)}else l()},l=function(){var u=!1;a=i.subscribe(Z(s,void 0,function(){++o<n?a?c():u=!0:s.complete()})),u&&c()};l()})}function oi(e){e===void 0&&(e=1/0);var t;e&&typeof e=="object"?t=e:t={count:e};var n=t.count,r=n===void 0?1/0:n,i=t.delay,s=t.resetOnSuccess,o=s===void 0?!1:s;return r<=0?Ze:te(function(a,c){var l=0,u,f=function(){var d=!1;u=a.subscribe(Z(c,function(h){o&&(l=0),c.next(h)},void 0,function(h){if(l++<r){var g=function(){u?(u.unsubscribe(),u=null,f()):d=!0};if(i!=null){var p=typeof i=="number"?Nn(i):_e(i(h,l)),y=Z(c,function(){y.unsubscribe(),g()},function(){c.complete()});p.subscribe(y)}else g()}else c.error(h)})),d&&(u.unsubscribe(),u=null,f())};f()})}function vp(e,t){return te(H3(e,t,arguments.length>=2,!0))}function Oe(e){e===void 0&&(e={});var t=e.connector,n=t===void 0?function(){return new Ae}:t,r=e.resetOnError,i=r===void 0?!0:r,s=e.resetOnComplete,o=s===void 0?!0:s,a=e.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var u,f,d,h=0,g=!1,p=!1,y=function(){f?.unsubscribe(),f=void 0},v=function(){y(),u=d=void 0,g=p=!1},$=function(){var S=u;v(),S?.unsubscribe()};return te(function(S,_){h++,!p&&!g&&y();var I=d=d??n();_.add(function(){h--,h===0&&!p&&!g&&(f=so($,c))}),I.subscribe(_),!u&&h>0&&(u=new Fr({next:function(k){return I.next(k)},error:function(k){p=!0,y(),f=so(v,i,k),I.error(k)},complete:function(){g=!0,y(),f=so(v,o),I.complete()}}),_e(S).subscribe(u))})(l)}}function so(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(t===!0){e();return}if(t!==!1){var i=new Fr({next:function(){i.unsubscribe(),e()}});return _e(t.apply(void 0,Ut([],It(n)))).subscribe(i)}}function oo(e,t,n){var r,i=!1;return r=e,Oe({connector:function(){return new Tr(r,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}function cn(e,t){return te(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(Z(r,function(c){i?.unsubscribe();var l=0,u=s++;_e(e(c,u)).subscribe(i=Z(r,function(f){return r.next(t?t(c,f,u,l++):f)},function(){i=null,a()}))},function(){o=!0,a()}))})}function Ir(e){return te(function(t,n){_e(e).subscribe(Z(n,function(){return n.complete()},lr)),!n.closed&&t.subscribe(n)})}function W3(e,t){return t===void 0&&(t=!1),te(function(n,r){var i=0;n.subscribe(Z(r,function(s){var o=e(s,i++);(o||t)&&r.next(s),!o&&r.complete()}))})}function ce(e,t,n){var r=G(e)||t||n?{next:e,error:t,complete:n}:e;return r?te(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(Z(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):Ze}function bp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function q3(e,t){for(;e.length<t;)e="0"+e;return e}function mt(e,t){var n,r,i;if(t.length===0)return e;for(n=0,i=t.length;n<i;n++)r=t.charCodeAt(n),e=(e<<5)-e+r,e|=0;return e<0?e*-2:e}function z3(e,t,n){return Object.keys(t).sort().reduce(r,e);function r(i,s){return mp(i,t[s],s,n)}}function mp(e,t,n,r){var i=mt(mt(mt(e,n),V3(t)),typeof t);if(t===null)return mt(i,"null");if(t===void 0)return mt(i,"undefined");if(typeof t=="object"||typeof t=="function"){if(r.indexOf(t)!==-1)return mt(i,"[Circular]"+n);r.push(t);var s=z3(i,t,r);if(!("valueOf"in t)||typeof t.valueOf!="function")return s;try{return mt(s,String(t.valueOf()))}catch(o){return mt(s,"[valueOf exception]"+(o.stack||o.message))}}return mt(i,t.toString())}function V3(e){return Object.prototype.toString.call(e)}function K3(e){return q3(mp(0,e,"",[]).toString(16),8)}var G3=K3;const Z3=bp(G3);function Jr(e,t){return e[0]!==void 0&&e[1]!==void 0&&(t?e[0]===t:!0)}function xp(e){return Jr(e,"e")}function $c(e){return Jr(e,"p")}function J3(e){return Jr(e,"a")}function X3(e){return Jr(e,"t")}const Sc=(e,...t)=>t.reduce((n,r)=>{const i=[];for(const s of n)try{const o=r(s);if(o===void 0)continue;i.push(o)}catch{}return i},e);function Q3(e){return e.tags.filter(xp).map(t=>t[1])}function Y3(e){return e.tags.filter(J3).map(t=>t[1])}function je(e,t,n){if(Reflect.has(e,t))return Reflect.get(e,t);{const r=n();return Reflect.set(e,t,r),r}}const Eu=Symbol.for("event-store"),$u=Symbol.for("event-uid"),eS=Symbol.for("replaceable-address"),pi=Symbol.for("from-cache"),tS=Symbol.for("replaceable-identifier");function Ve(e){return W$(e)||ds(e)}function tr(e){let t=Reflect.get(e,$u);return t||(Ve(e.kind)?t=_c(e):t=e.id,Reflect.set(e,$u,t)),t}function _c(e){if(!Ve(e.kind))throw new Error("Event is not replaceable or addressable");return je(e,eS,()=>{const t=ds(e.kind)?kc(e):void 0;return st(e.kind,e.pubkey,t)})}function st(e,t,n){return e+":"+t+":"+(n??"")}function nS(e){Reflect.set(e,pi,!0)}function kc(e){return je(e,tS,()=>e.tags.find(t=>t[0]==="d")?.[1]??"")}function ao(){return Math.round(Date.now()/1e3)}const rS=Symbol("expiration-timestamp");function co(e){return je(e,rS,()=>{const t=e.tags.find(n=>n[0]==="expiration")?.[1];return t?parseInt(t):void 0})}const Ep=Symbol.for("encrypted-content"),$p={[z.EncryptedDirectMessage]:"nip04",[z.Seal]:"nip44",[z.GiftWrap]:"nip44"};function Sp(e,t){return $p[e]=t,e}function iS(e){return $p[e]!==void 0}function sS(e){return Reflect.get(e,Ep)}function oS(e){return Reflect.has(e,Ep)===!1}const _p=new Set([Sp(z.DraftLong,"nip04")]);function Pe(e,t){return _p.add(Sp(e,t)),e}function kp(e){return iS(e)&&_p.has(e)}function Ap(e){return oS(e)}function aS(e){if(!(!kp(e.kind)||Ap(e)))return sS(e)}function cS(e,t="https:"){return/^[a-zA-Z][a-zA-Z0-9+.-]+:/.test(e)?e:t+"//"+e}function lS(e){const t=typeof e=="string"?new URL(cS(e,"http:")):new URL(e);return t.protocol==="ws:"?t.protocol="http:":(t.protocol,t.protocol="https:"),typeof e=="string"?t.toString():t}function jr(e){let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),(t.port==="80"&&(t.protocol==="ws:"||t.protocol==="http:")||t.port==="443"&&(t.protocol==="wss:"||t.protocol==="https:"))&&(t.port=""),typeof e=="string"?t.toString():t}const uS=10009,fS=Symbol.for("hidden-tags"),dS=new Set([Pe(z.BookmarkList,"nip04"),Pe(z.InterestsList,"nip04"),Pe(z.Mutelist,"nip04"),Pe(z.CommunitiesList,"nip04"),Pe(z.PublicChatsList,"nip04"),Pe(z.SearchRelaysList,"nip04"),Pe(uS,"nip04"),Pe(z.Bookmarksets,"nip04"),Pe(z.Relaysets,"nip04"),Pe(z.Followsets,"nip04"),Pe(z.Curationsets,"nip04"),Pe(z.Interestsets,"nip04")]);function hS(e){return kp(e)&&dS.has(e)}function Cp(e){if(!(!hS(e.kind)||Ac(e)))return je(e,fS,()=>{const t=aS(e),n=JSON.parse(t);if(!Array.isArray(n))throw new Error("Content is not an array of tags");return n.filter(r=>Array.isArray(r)).map(r=>r.map(i=>String(i)))})}function Ac(e){return Ap(e)}const Su="abcdefghijklmnopqrstuvwxyz",Rp=new Set((Su+Su.toUpperCase()).split("")),_u=Symbol.for("indexable-tags");function gi(e){let t=Reflect.get(e,_u);if(!t){const n=new Set;for(const r of e.tags)r.length>=2&&r[0].length===1&&Rp.has(r[0])&&n.add(r[0]+":"+r[1]);t=n,Reflect.set(e,_u,n)}return t}function pS(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),i=e[n];if(i){const s=gi(t);if(i.some(o=>s.has(r+":"+o))===!1)return!1}}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function Go(e,t){for(let n=0;n<e.length;n++)if(pS(e[n],t))return!0;return!1}const Lr=Symbol.for("seen-relays");function Zo(e,t){return e[Lr]||(e[Lr]=new Set),e[Lr].add(t),e[Lr]}function gS(e){return e[Lr]}const yS=/^wss?:\/\/([-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}|localhost)\b([-a-zA-Z0-9()@:%_\+.~#?&\/\/=]*)$/;function Xr(e){return e.length>=8&&yS.test(e)}function Cc(...e){const t=new Set;for(const n of e)if(n)for(const r of n)try{const i=jr(r).toString();i&&t.add(i)}catch{}return Array.from(t)}function wS(e){return!!e?.toLowerCase()?.match(/^[0-9a-f]{64}$/)}function Lp(e,t=!1,n=!0){const r=e.split(":"),i=r[0]?parseInt(r[0]):void 0,s=r[1],o=r[2];if(i===void 0){if(n)return null;throw new Error("Missing kind")}if(s===void 0||s===""){if(n)return null;throw new Error("Missing pubkey")}if(t&&o===void 0){if(n)return null;throw new Error("Missing identifier")}return{kind:i,pubkey:s,identifier:o}}function ku(e){if(!e[1])throw new Error("Missing coordinate in tag");const t=Lp(e[1],!0,!1);return e[2]&&Xr(e[2])&&(t.relays=[e[2]]),t}function Tp(e){if(!e[1])throw new Error("Missing pubkey in tag");if(!wS(e[1]))throw new Error("Invalid pubkey");const t={pubkey:e[1]};return e[2]&&Xr(e[2])&&(t.relays=[e[2]]),t}function vS(e){return typeof e!="string"&&Reflect.has(e,"identifier")&&Reflect.has(e,"pubkey")&&Reflect.has(e,"kind")}function Au(e){return e.kind+":"+e.pubkey+":"+e.identifier}const bS=10063;function mS(e){const t=Array.isArray(e)?e:e.tags;return Sc(t,n=>{if(Jr(n,"server")&&URL.canParse(n[1]))return new URL("/",n[1])})}function xS(e){return typeof e=="string"&&(e={pubkey:e}),t=>t.replaceable({kind:bS,pubkey:e.pubkey,relays:e.relays}).pipe(ge(n=>n?mS(n):[]))}new TextDecoder("utf-8");new TextEncoder;function yi(e,t){const[n,r]=Jo(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function Jo(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}const ES=Symbol.for("profile-content");function Ip(e){return je(e,ES,()=>{const t=JSON.parse(e.content);return t.nip05&&typeof t.nip05!="string"&&(t.nip05=String(t.nip05)),t.website&&t.website?.length>0&&t.website?.startsWith("http")===!1&&(t.website="https://"+t.website),t})}function $S(e){if(!e||e.kind!==z.Metadata&&e.kind!==z.Handlerinformation)return!1;try{return Ip(e),!0}catch{return!1}}var Up={};(function(e){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0;function t(w){if(!Number.isSafeInteger(w))throw new Error(`Wrong integer: ${w}`)}e.assertNumber=t;function n(...w){const m=(b,E)=>C=>b(E(C)),x=Array.from(w).reverse().reduce((b,E)=>b?m(b,E.encode):E.encode,void 0),L=w.reduce((b,E)=>b?m(b,E.decode):E.decode,void 0);return{encode:x,decode:L}}function r(w){return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return m.map(x=>{if(t(x),x<0||x>=w.length)throw new Error(`Digit index outside alphabet: ${x} (alphabet: ${w.length})`);return w[x]})},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("alphabet.decode input should be array of strings");return m.map(x=>{if(typeof x!="string")throw new Error(`alphabet.decode: not string element=${x}`);const L=w.indexOf(x);if(L===-1)throw new Error(`Unknown letter: "${x}". Allowed: ${w}`);return L})}}}function i(w=""){if(typeof w!="string")throw new Error("join separator should be string");return{encode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="string")throw new Error("join.encode input should be array of strings");for(let x of m)if(typeof x!="string")throw new Error(`join.encode: non-string input=${x}`);return m.join(w)},decode:m=>{if(typeof m!="string")throw new Error("join.decode input should be string");return m.split(w)}}}function s(w,m="="){if(t(w),typeof m!="string")throw new Error("padding chr should be string");return{encode(x){if(!Array.isArray(x)||x.length&&typeof x[0]!="string")throw new Error("padding.encode input should be array of strings");for(let L of x)if(typeof L!="string")throw new Error(`padding.encode: non-string input=${L}`);for(;x.length*w%8;)x.push(m);return x},decode(x){if(!Array.isArray(x)||x.length&&typeof x[0]!="string")throw new Error("padding.encode input should be array of strings");for(let b of x)if(typeof b!="string")throw new Error(`padding.decode: non-string input=${b}`);let L=x.length;if(L*w%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;L>0&&x[L-1]===m;L--)if(!((L-1)*w%8))throw new Error("Invalid padding: string has too much padding");return x.slice(0,L)}}}function o(w){if(typeof w!="function")throw new Error("normalize fn should be function");return{encode:m=>m,decode:m=>w(m)}}function a(w,m,x){if(m<2)throw new Error(`convertRadix: wrong from=${m}, base cannot be less than 2`);if(x<2)throw new Error(`convertRadix: wrong to=${x}, base cannot be less than 2`);if(!Array.isArray(w))throw new Error("convertRadix: data should be array");if(!w.length)return[];let L=0;const b=[],E=Array.from(w);for(E.forEach(C=>{if(t(C),C<0||C>=m)throw new Error(`Wrong integer: ${C}`)});;){let C=0,B=!0;for(let N=L;N<E.length;N++){const F=E[N],O=m*C+F;if(!Number.isSafeInteger(O)||m*C/m!==C||O-F!==m*C)throw new Error("convertRadix: carry overflow");if(C=O%x,E[N]=Math.floor(O/x),!Number.isSafeInteger(E[N])||E[N]*x+C!==O)throw new Error("convertRadix: carry overflow");if(B)E[N]?B=!1:L=N;else continue}if(b.push(C),B)break}for(let C=0;C<w.length-1&&w[C]===0;C++)b.push(0);return b.reverse()}const c=(w,m)=>m?c(m,w%m):w,l=(w,m)=>w+(m-c(w,m));function u(w,m,x,L){if(!Array.isArray(w))throw new Error("convertRadix2: data should be array");if(m<=0||m>32)throw new Error(`convertRadix2: wrong from=${m}`);if(x<=0||x>32)throw new Error(`convertRadix2: wrong to=${x}`);if(l(m,x)>32)throw new Error(`convertRadix2: carry overflow from=${m} to=${x} carryBits=${l(m,x)}`);let b=0,E=0;const C=2**x-1,B=[];for(const N of w){if(t(N),N>=2**m)throw new Error(`convertRadix2: invalid data word=${N} from=${m}`);if(b=b<<m|N,E+m>32)throw new Error(`convertRadix2: carry overflow pos=${E} from=${m}`);for(E+=m;E>=x;E-=x)B.push((b>>E-x&C)>>>0);b&=2**E-1}if(b=b<<x-E&C,!L&&E>=m)throw new Error("Excess padding");if(!L&&b)throw new Error(`Non-zero padding: ${b}`);return L&&E>0&&B.push(b>>>0),B}function f(w){return t(w),{encode:m=>{if(!(m instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return a(Array.from(m),2**8,w)},decode:m=>{if(!Array.isArray(m)||m.length&&typeof m[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(a(m,w,2**8))}}}function d(w,m=!1){if(t(w),w<=0||w>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,w)>32||l(w,8)>32)throw new Error("radix2: carry overflow");return{encode:x=>{if(!(x instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(x),8,w,!m)},decode:x=>{if(!Array.isArray(x)||x.length&&typeof x[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(x,w,8,m))}}}function h(w){if(typeof w!="function")throw new Error("unsafeWrapper fn should be function");return function(...m){try{return w.apply(null,m)}catch{}}}function g(w,m){if(t(w),typeof m!="function")throw new Error("checksum fn should be function");return{encode(x){if(!(x instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const L=m(x).slice(0,w),b=new Uint8Array(x.length+w);return b.set(x),b.set(L,x.length),b},decode(x){if(!(x instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const L=x.slice(0,-w),b=m(L).slice(0,w),E=x.slice(-w);for(let C=0;C<w;C++)if(b[C]!==E[C])throw new Error("Invalid checksum");return L}}}e.utils={alphabet:r,chain:n,checksum:g,radix:f,radix2:d,join:i,padding:s},e.base16=n(d(4),r("0123456789ABCDEF"),i("")),e.base32=n(d(5),r("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),s(5),i("")),e.base32hex=n(d(5),r("0123456789ABCDEFGHIJKLMNOPQRSTUV"),s(5),i("")),e.base32crockford=n(d(5),r("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),i(""),o(w=>w.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),e.base64=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s(6),i("")),e.base64url=n(d(6),r("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),s(6),i(""));const p=w=>n(f(58),r(w),i(""));e.base58=p("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=p("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=p("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const y=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(w){let m="";for(let x=0;x<w.length;x+=8){const L=w.subarray(x,x+8);m+=e.base58.encode(L).padStart(y[L.length],"1")}return m},decode(w){let m=[];for(let x=0;x<w.length;x+=11){const L=w.slice(x,x+11),b=y.indexOf(L.length),E=e.base58.decode(L);for(let C=0;C<E.length-b;C++)if(E[C]!==0)throw new Error("base58xmr: wrong padding");m=m.concat(Array.from(E.slice(E.length-b)))}return Uint8Array.from(m)}};const v=w=>n(g(4,m=>w(w(m))),e.base58);e.base58check=v;const $=n(r("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),i("")),S=[996825010,642813549,513874426,1027748829,705979059];function _(w){const m=w>>25;let x=(w&33554431)<<5;for(let L=0;L<S.length;L++)(m>>L&1)===1&&(x^=S[L]);return x}function I(w,m,x=1){const L=w.length;let b=1;for(let E=0;E<L;E++){const C=w.charCodeAt(E);if(C<33||C>126)throw new Error(`Invalid prefix (${w})`);b=_(b)^C>>5}b=_(b);for(let E=0;E<L;E++)b=_(b)^w.charCodeAt(E)&31;for(let E of m)b=_(b)^E;for(let E=0;E<6;E++)b=_(b);return b^=x,$.encode(u([b%2**30],30,5,!1))}function k(w){const m=w==="bech32"?1:734539939,x=d(5),L=x.decode,b=x.encode,E=h(L);function C(O,P,K=90){if(typeof O!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof O}`);if(!Array.isArray(P)||P.length&&typeof P[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof P}`);const ae=O.length+7+P.length;if(K!==!1&&ae>K)throw new TypeError(`Length ${ae} exceeds limit ${K}`);return O=O.toLowerCase(),`${O}1${$.encode(P)}${I(O,P,m)}`}function B(O,P=90){if(typeof O!="string")throw new Error(`bech32.decode input should be string, not ${typeof O}`);if(O.length<8||P!==!1&&O.length>P)throw new TypeError(`Wrong string length: ${O.length} (${O}). Expected (8..${P})`);const K=O.toLowerCase();if(O!==K&&O!==O.toUpperCase())throw new Error("String must be lowercase or uppercase");O=K;const ae=O.lastIndexOf("1");if(ae===0||ae===-1)throw new Error('Letter "1" must be present between prefix and data only');const We=O.slice(0,ae),Be=O.slice(ae+1);if(Be.length<6)throw new Error("Data must be at least 6 characters long");const Ie=$.decode(Be).slice(0,-6),yt=I(We,Ie,m);if(!Be.endsWith(yt))throw new Error(`Invalid checksum in ${O}: expected "${yt}"`);return{prefix:We,words:Ie}}const N=h(B);function F(O){const{prefix:P,words:K}=B(O,!1);return{prefix:P,words:K,bytes:L(K)}}return{encode:C,decode:B,decodeToBytes:F,decodeUnsafe:N,fromWords:L,fromWordsUnsafe:E,toWords:b}}e.bech32=k("bech32"),e.bech32m=k("bech32m"),e.utf8={encode:w=>new TextDecoder().decode(w),decode:w=>new TextEncoder().encode(w)},e.hex=n(d(4),r("0123456789abcdef"),i(""),o(w=>{if(typeof w!="string"||w.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof w} with length ${w.length}`);return w.toLowerCase()}));const R={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},A=`Invalid encoding type. Available types: ${Object.keys(R).join(", ")}`,H=(w,m)=>{if(typeof w!="string"||!R.hasOwnProperty(w))throw new TypeError(A);if(!(m instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return R[w].encode(m)};e.bytesToString=H,e.str=e.bytesToString;const M=(w,m)=>{if(!R.hasOwnProperty(w))throw new TypeError(A);if(typeof m!="string")throw new TypeError("stringToBytes() expects string");return R[w].decode(m)};e.stringToBytes=M,e.bytes=e.stringToBytes})(Up);const{bech32:J5,hex:X5,utf8:Q5}=Up;BigInt(1e3),BigInt(1e6),BigInt(1e9),BigInt(1e12);BigInt("2100000000000000000");BigInt(1e11);const Cu={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27};for(let e=0,t=Object.keys(Cu);e<t.length;e++)t[e],Cu[t[e]].toString();const Ru=1111,SS=Symbol.for("public-contacts"),_S=Symbol.for("hidden-contacts");function kS(...e){const t=new Map;for(const n of e)if(Array.isArray(n))for(const r of n)r&&t.set(r.pubkey,r);else n&&t.set(n.pubkey,n);return Array.from(t.values())}function AS(e){return kS(CS(e),RS(e))}function CS(e){return je(e,SS,()=>Sc(e.tags,t=>$c(t)?t:void 0,Tp))}function RS(e){if(!Ac(e))return je(e,_S,()=>Sc(Cp(e),t=>$c(t)?t:void 0,Tp))}var Xo={exports:{}},lo,Lu;function LS(){if(Lu)return lo;Lu=1;var e=1e3,t=e*60,n=t*60,r=n*24,i=r*7,s=r*365.25;lo=function(u,f){f=f||{};var d=typeof u;if(d==="string"&&u.length>0)return o(u);if(d==="number"&&isFinite(u))return f.long?c(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function o(u){if(u=String(u),!(u.length>100)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(f){var d=parseFloat(f[1]),h=(f[2]||"ms").toLowerCase();switch(h){case"years":case"year":case"yrs":case"yr":case"y":return d*s;case"weeks":case"week":case"w":return d*i;case"days":case"day":case"d":return d*r;case"hours":case"hour":case"hrs":case"hr":case"h":return d*n;case"minutes":case"minute":case"mins":case"min":case"m":return d*t;case"seconds":case"second":case"secs":case"sec":case"s":return d*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return d;default:return}}}}function a(u){var f=Math.abs(u);return f>=r?Math.round(u/r)+"d":f>=n?Math.round(u/n)+"h":f>=t?Math.round(u/t)+"m":f>=e?Math.round(u/e)+"s":u+"ms"}function c(u){var f=Math.abs(u);return f>=r?l(u,f,r,"day"):f>=n?l(u,f,n,"hour"):f>=t?l(u,f,t,"minute"):f>=e?l(u,f,e,"second"):u+" ms"}function l(u,f,d,h){var g=f>=d*1.5;return Math.round(u/d)+" "+h+(g?"s":"")}return lo}function TS(e){n.debug=n,n.default=n,n.coerce=c,n.disable=o,n.enable=i,n.enabled=a,n.humanize=LS(),n.destroy=l,Object.keys(e).forEach(u=>{n[u]=e[u]}),n.names=[],n.skips=[],n.formatters={};function t(u){let f=0;for(let d=0;d<u.length;d++)f=(f<<5)-f+u.charCodeAt(d),f|=0;return n.colors[Math.abs(f)%n.colors.length]}n.selectColor=t;function n(u){let f,d=null,h,g;function p(...y){if(!p.enabled)return;const v=p,$=Number(new Date),S=$-(f||$);v.diff=S,v.prev=f,v.curr=$,f=$,y[0]=n.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let _=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(k,R)=>{if(k==="%%")return"%";_++;const A=n.formatters[R];if(typeof A=="function"){const H=y[_];k=A.call(v,H),y.splice(_,1),_--}return k}),n.formatArgs.call(v,y),(v.log||n.log).apply(v,y)}return p.namespace=u,p.useColors=n.useColors(),p.color=n.selectColor(u),p.extend=r,p.destroy=n.destroy,Object.defineProperty(p,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(h!==n.namespaces&&(h=n.namespaces,g=n.enabled(u)),g),set:y=>{d=y}}),typeof n.init=="function"&&n.init(p),p}function r(u,f){const d=n(this.namespace+(typeof f>"u"?":":f)+u);return d.log=this.log,d}function i(u){n.save(u),n.namespaces=u,n.names=[],n.skips=[];const f=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const d of f)d[0]==="-"?n.skips.push(d.slice(1)):n.names.push(d)}function s(u,f){let d=0,h=0,g=-1,p=0;for(;d<u.length;)if(h<f.length&&(f[h]===u[d]||f[h]==="*"))f[h]==="*"?(g=h,p=d,h++):(d++,h++);else if(g!==-1)h=g+1,p++,d=p;else return!1;for(;h<f.length&&f[h]==="*";)h++;return h===f.length}function o(){const u=[...n.names,...n.skips.map(f=>"-"+f)].join(",");return n.enable(""),u}function a(u){for(const f of n.skips)if(s(u,f))return!1;for(const f of n.names)if(s(u,f))return!0;return!1}function c(u){return u instanceof Error?u.stack||u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var IS=TS;(function(e,t){var n={};t.formatArgs=i,t.save=s,t.load=o,t.useColors=r,t.storage=a(),t.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let f=0,d=0;l[0].replace(/%[a-zA-Z%]/g,h=>{h!=="%%"&&(f++,h==="%c"&&(d=f))}),l.splice(d,0,u)}t.log=console.debug||console.log||(()=>{});function s(l){try{l?t.storage.setItem("debug",l):t.storage.removeItem("debug")}catch{}}function o(){let l;try{l=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=n.DEBUG),l}function a(){try{return localStorage}catch{}}e.exports=IS(t);const{formatters:c}=e.exports;c.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Xo,Xo.exports);var US=Xo.exports;const OS=bp(US),vs=OS("applesauce");class Tu{first=null;items=Object.create(null);last=null;max;resetTtl;size;ttl;constructor(t=0,n=0,r=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=r,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const n=this.items[t];delete this.items[t],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(t=this.keys()){return t.map(n=>[n,this.get(n)])}evict(t=!1){if(t||this.size>0){const n=this.first;delete this.items[n.key],--this.size===0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(t){let n;return this.has(t)&&(n=this.items[t].expiry),n}get(t){let n;if(this.has(t)){const r=this.items[t];this.ttl>0&&r.expiry<=Date.now()?this.delete(t):(n=r.value,this.set(t,n,!0))}return n}has(t){return t in this.items}keys(){const t=[];let n=this.first;for(;n!==null;)t.push(n.key),n=n.next;return t}set(t,n,r=!1,i=this.resetTtl){let s;if(r||this.has(t)){if(s=this.items[t],s.value=n,r===!1&&i&&(s.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==s){const o=this.last,a=s.next,c=s.prev;this.first===s&&(this.first=s.next),s.next=null,s.prev=this.last,o.next=s,c!==null&&(c.next=a),a!==null&&(a.prev=c)}}else this.max>0&&this.size===this.max&&this.evict(!0),s=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:n},++this.size===1?this.first=s:this.last.next=s;return this.last=s,this}values(t=this.keys()){return t.map(n=>this.get(n))}}class NS{log=vs.extend("EventSet");kinds=new Map;authors=new Map;tags=new Tu;created_at=[];events=new Tu;replaceable=new Map;insert$=new Ae;update$=new Ae;remove$=new Ae;onBeforeInsert;get size(){return this.events.size}touch(t){this.events.set(t.id,t)}hasEvent(t){return this.events.has(t)}getEvent(t){return this.events.get(t)}hasReplaceable(t,n,r){const i=this.replaceable.get(st(t,n,r));return!!i&&i.length>0}getReplaceable(t,n,r){const i=st(t,n,r);return this.replaceable.get(i)?.[0]}getReplaceableHistory(t,n,r){const i=st(t,n,r);return this.replaceable.get(i)}getByFilters(t){return this.getEventsForFilters(Array.isArray(t)?t:[t])}getTimeline(t){const n=[],r=this.getEventsForFilters(Array.isArray(t)?t:[t]);for(const i of r)yi(n,i);return n}add(t){const n=t.id,r=this.events.get(n);if(r)return r;if(this.onBeforeInsert?.(t)===!1)return null;this.events.set(n,t),this.getKindIndex(t.kind).add(t),this.getAuthorsIndex(t.pubkey).add(t);for(const i of gi(t))this.tags.has(i)&&this.getTagIndex(i).add(t);if(yi(this.created_at,t),Ve(t.kind)){const i=t.tags.find(a=>a[0]==="d")?.[1],s=st(t.kind,t.pubkey,i);let o=this.replaceable.get(s);this.replaceable.has(s)||(o=[],this.replaceable.set(s,o)),yi(o,t)}return this.insert$.next(t),t}update(t){const n=this.add(t);return n&&this.update$.next(n),n!==null}remove(t){let n=typeof t=="string"?this.events.get(t):t;if(!n)throw new Error("Missing event");const r=n.id;if(!this.events.has(r))return!1;this.getAuthorsIndex(n.pubkey).delete(n),this.getKindIndex(n.kind).delete(n);for(const s of gi(n))this.tags.has(s)&&this.getTagIndex(s).delete(n);const i=this.created_at.indexOf(n);if(this.created_at.splice(i,1),this.events.delete(r),Ve(n.kind)){const s=n.tags.find(c=>c[0]==="d")?.[1],o=st(n.kind,n.pubkey,s),a=this.replaceable.get(o);if(a&&a.includes(n)){const c=a.indexOf(n);a.splice(c,1)}}return this.claims.delete(n),this.remove$.next(n),!0}claims=new WeakMap;claim(t,n){this.claims.has(t)||this.claims.set(t,n),this.touch(t)}isClaimed(t){return this.claims.has(t)}removeClaim(t,n){this.claims.get(t)===n&&this.claims.delete(t)}clearClaim(t){this.claims.delete(t)}getKindIndex(t){return this.kinds.has(t)||this.kinds.set(t,new Set),this.kinds.get(t)}getAuthorsIndex(t){return this.authors.has(t)||this.authors.set(t,new Set),this.authors.get(t)}getTagIndex(t){if(!this.tags.has(t)){const n=new Set,r=Date.now();for(const s of this.events.values())gi(s).has(t)&&n.add(s);const i=Date.now()-r;i>100&&this.log(`Built index ${t} took ${i}ms`),this.tags.set(t,n)}return this.tags.get(t)}*iterateAuthors(t){for(const n of t){const r=this.authors.get(n);if(r)for(const i of r)yield i}}*iterateTag(t,n){for(const r of n){const i=this.getTagIndex(t+":"+r);if(i)for(const s of i)yield s}}*iterateKinds(t){for(const n of t){const r=this.kinds.get(n);if(r)for(const i of r)yield i}}*iterateTime(t,n){let r=0,i=this.created_at.length-1,s=n?Jo(this.created_at,a=>a.created_at-n):void 0;s&&(r=s[0]);const o=t?Jo(this.created_at,a=>a.created_at-t):void 0;o&&(i=o[0]);for(let a=r;a<i;a++)yield this.created_at[a]}*iterateIds(t){for(const n of t)this.events.has(n)&&(yield this.events.get(n))}getEventsForFilter(t){if(t.search)return new Set;let n=!0,r=new Set;const i=o=>{const a=o instanceof Set?o:new Set(o);if(n)r=a,n=!1;else for(const c of r)a.has(c)||r.delete(c);return r};t.ids&&i(this.iterateIds(t.ids));let s=null;t.since!==void 0&&(s=Array.from(this.iterateTime(t.since,t.until)),i(s));for(const o of Rp){const a=`#${o}`,c=t[a];c?.length&&i(this.iterateTag(o,c))}if(t.authors&&i(this.iterateAuthors(t.authors)),t.kinds&&i(this.iterateKinds(t.kinds)),t.since===void 0&&t.until!==void 0&&(s=Array.from(this.iterateTime(t.since,t.until)),i(s)),t.limit&&s){const o=new Set;for(const a of s){if(o.size>=t.limit)break;r.has(a)&&o.add(a)}return o}return r}getEventsForFilters(t){if(t.length===0)throw new Error("No Filters");let n=new Set;for(const r of t){const i=this.getEventsForFilter(r);for(const s of i)n.add(s)}return n}prune(t=1e3){let n=0,r=this.events.first;for(;r;){const i=r.value;if(!this.isClaimed(i)&&(this.remove(i),n++,n>=t))break;r=r.next}return n}reset(){this.events.clear(),this.kinds.clear(),this.authors.clear(),this.tags.clear(),this.created_at=[],this.replaceable.clear(),this.claims=new WeakMap}}vs.extend("EncryptedContentCache");vs.extend("event-cache");new TextDecoder;const BS=Symbol.for("mailboxes-inboxes"),MS=Symbol.for("mailboxes-outboxes");function PS(e){return je(e,BS,()=>{const t=[];for(const n of e.tags){const[r,i,s]=n;r==="r"&&i&&Xr(i)&&!t.includes(i)&&(s==="read"||s===void 0)&&t.push(jr(i))}return t})}function HS(e){return je(e,MS,()=>{const t=[];for(const n of e.tags){const[r,i,s]=n;r==="r"&&i&&Xr(i)&&!t.includes(i)&&(s==="write"||s===void 0)&&t.push(jr(i))}return t})}const FS=Symbol.for("mute-public"),DS=Symbol.for("mute-hidden");function jS(...e){const t={pubkeys:new Set,threads:new Set,hashtags:new Set,words:new Set};for(const n of e){for(const r of n.pubkeys)t.pubkeys.add(r);for(const r of n.threads)t.threads.add(r);for(const r of n.hashtags)t.hashtags.add(r);for(const r of n.words)t.words.add(r)}return t}function Op(e){const t=new Set(e.filter($c).map(s=>s[1])),n=new Set(e.filter(xp).map(s=>s[1])),r=new Set(e.filter(X3).map(s=>s[1].toLocaleLowerCase())),i=new Set(e.filter(s=>s[0]==="word"&&s[1]).map(s=>s[1].toLocaleLowerCase()));return{pubkeys:t,threads:n,hashtags:r,words:i}}function WS(e){const t=zS(e),n=qS(e);return t?jS(t,n):n}function qS(e){return je(e,FS,()=>Op(e.tags))}function zS(e){if(!Ac(e))return je(e,DS,()=>Op(Cp(e)))}var Iu;(function(e){e.nudity="nudity",e.malware="malware",e.profanity="profanity",e.illegal="illegal",e.spam="spam",e.impersonation="impersonation",e.other="other"})(Iu||(Iu={}));const VS=Symbol.for("nip10-thread-refs");function Uu(e){if(!e[1])throw new Error("Missing event id in tag");let t={id:e[1]};return e[2]&&Xr(e[2])&&(t.relays=[e[2]]),e[0]==="e"&&(e[3]==="root"||e[3]==="reply"||e[3]==="mention")&&e[4]&&e[4].length===64&&(t.author=e[4]),t}function KS(e){const t=e.filter(a=>a[0]==="e"&&a[1]),n=e.filter(a=>a[0]==="a"&&a[1]);let r=t.find(a=>a[3]==="root"),i=t.find(a=>a[3]==="reply"),s=n.find(a=>a[3]==="root"),o=n.find(a=>a[3]==="reply");if((!r||!i)&&(r=i=r||i),(!s||!o)&&(s=o=s||o),!r&&!i){const a=t.filter(c=>!c[3]);a.length>=1&&(r=a[0],i=a[a.length-1]??r)}return{root:r||s?{e:r,a:s}:void 0,reply:i||o?{e:i,a:o}:void 0}}function GS(e){return je(e,VS,()=>{const t=KS(e.tags);let n;if(t.root)try{n={e:t.root.e&&Uu(t.root.e),a:t.root.a&&ku(t.root.a)}}catch{}let r;if(t.reply)try{r={e:t.reply.e&&Uu(t.reply.e),a:t.reply.a&&ku(t.reply.a)}}catch{}return{root:n,reply:r}})}function Ou(e){return t=>{const n=new Set;return t.pipe(ce(r=>{if(r!==void 0)if(Array.isArray(r))for(const i of r)n.add(i),e.claim(i,t);else n.add(r),e.claim(r,t)}),Zr(()=>{for(const r of n)e.removeClaim(r,t)}))}}function Np(e){return t=>{let n;return t.pipe(ce(r=>{n&&e.removeClaim(n,t),r&&e.claim(r,t),n=r}),Zr(()=>{n&&e.removeClaim(n,t)}))}}function Rc(e){return t=>new ee(n=>{let r=!1;const i=t.subscribe({next:s=>{r=!0,n.next(s)},error:s=>n.error(s),complete:()=>n.complete()});return r||n.next(e),i})}function Bp(e){return typeof e=="string"&&(e={id:e}),t=>Ee(Dr(()=>{let n=t.getEvent(e.id);return n?be(n):t.eventLoader?Re(t.eventLoader(e)).pipe(Y(r=>!!r)):se}),t.insert$.pipe(Y(n=>n.id===e.id)),t.removed(e.id).pipe(er(void 0))).pipe(Np(t),Ec((n,r)=>n?.id===r?.id),Rc(void 0))}function Qo(e){return t=>{let n;return Ee(Dr(()=>{let r=t.getReplaceable(e.kind,e.pubkey,e.identifier);return r?be(r):e.identifier!==void 0?t.addressableLoader?Re(t.addressableLoader(e)).pipe(Y(i=>!!i)):se:t.replaceableLoader?Re(t.replaceableLoader(e)).pipe(Y(i=>!!i)):se}),t.insert$.pipe(Y(r=>r.pubkey==e.pubkey&&r.kind===e.kind&&(e.identifier!==void 0?kc(r)===e.identifier:!0)))).pipe(Ec((r,i)=>r.created_at>=i.created_at),ce(r=>n=r),Ir(t.remove$.pipe(Y(r=>r.id===n?.id))),er(void 0),hi(),Np(t),Rc(void 0))}}function ZS(e,t){return e=Array.isArray(e)?e:[e],n=>{const r=new Map;return Dr(()=>be(Array.from(n.getTimeline(e)))).pipe(Ou(n),Ko(n.insert$.pipe(Y(i=>Go(e,i)),Ou(n))),Ko(n.remove$.pipe(Y(i=>Go(e,i)),ge(i=>i.id))),vp((i,s)=>{if(typeof s=="string")return i.filter(a=>a.id!==s);if(Array.isArray(s)){if(!t)for(const a of s)Ve(a.kind)&&r.set(tr(a),a);return s}let o=[...i];if(!t&&Ve(s.kind)){const a=tr(s),c=r.get(a);if(c&&s.created_at<c.created_at)return i;r.set(a,s),c&&o.slice(o.indexOf(c),1)}return yi(o,s),o},[]),Ec(),Zr(()=>r.clear()))}}function JS(e){return t=>xc(Object.fromEntries(e.map(n=>[n,t.model(Bp,{id:n})])))}function XS(e){return t=>xc(Object.fromEntries(e.map(n=>[st(n.kind,n.pubkey,n.identifier),t.model(Qo,n)])))}function Mp(e,t=!0){return n=>n.pipe(ge(r=>e.add(r)),Y(r=>r!==null),t?F3():Ze)}class QS extends Error{}function YS(e,t){return Vo({first:e,with:()=>zo(()=>new QS("Timeout"))})}function Pp(e){return t=>{let n;return Ee(t.pipe(ce(r=>n=r)),e.update$.pipe(Y(r=>r.id===n?.id)))}}function e_(e){return typeof e=="string"&&(e={pubkey:e}),t=>t.replaceable({kind:z.Contacts,pubkey:e.pubkey,relays:e.relays}).pipe(Pp(t),ge(n=>n?AS(n):[]))}function t_(e){return t=>{const n=[{kinds:[Ru],"#e":[e.id]}];return ds(e.kind)&&n.push({kinds:[Ru],"#a":[_c(e)]}),t.timeline(n)}}function n_(e){return typeof e=="string"&&(e={pubkey:e}),t=>t.replaceable({kind:z.RelayList,pubkey:e.pubkey,relays:e.relays}).pipe(ge(n=>n&&{inboxes:PS(n),outboxes:HS(n)}))}function r_(e){return typeof e=="string"&&(e={pubkey:e}),t=>t.replaceable({kind:z.Mutelist,pubkey:e.pubkey,relays:e.relays}).pipe(Pp(t),ge(n=>n&&WS(n)))}function i_(e){return typeof e=="string"&&(e={pubkey:e}),t=>t.replaceable({kind:z.Metadata,pubkey:e.pubkey,relays:e.relays}).pipe(Y($S),ge(n=>n&&Ip(n)),Rc(void 0))}function s_(e){return t=>t.timeline(Ve(e.kind)?[{kinds:[z.Reaction],"#e":[e.id]},{kinds:[z.Reaction],"#a":[tr(e)]}]:[{kinds:[z.Reaction],"#e":[e.id]}])}const o_={kinds:[z.ShortTextNote]};function a_(e,t){const n=new Map,r=new Map,{kinds:i}={...o_,...t};let s="";const o={},a={kinds:i};return vS(e)?(s=Au(e),o.kinds=[e.kind],o.authors=[e.pubkey],o["#d"]=[e.identifier],a["#a"]=[s]):typeof e=="string"?(s=e,o.ids=[e],a["#e"]=[e]):(s=e.id,o.ids=[e.id],a["#e"]=[e.id]),c=>c.filters([o,a]).pipe(ge(l=>{if(!r.has(tr(l))){const u=GS(l),f=n.get(tr(l))||new Set,d={event:l,refs:u,replies:f};for(const h of f)h.parent=d;if(u.reply?.e||u.reply?.a){let h=u.reply.e?u.reply.e.id:Au(u.reply.a);if(d.parent=r.get(h),d.parent)d.parent.replies.add(d);else{let g=n.get(h);g||(g=new Set,n.set(h,g)),g.add(d)}}r.set(tr(l),d)}return{root:r.get(s),all:r}}))}class Ur{database;keepOldVersions=!1;keepExpired=!1;verifyEvent;insert$;update$;remove$;eventLoader;replaceableLoader;addressableLoader;constructor(){this.database=new NS,this.database.onBeforeInsert=t=>!(this.verifyEvent&&this.verifyEvent(t)===!1),this.database.insert$.subscribe(t=>{Reflect.set(t,Eu,this)}),this.database.remove$.subscribe(t=>{Reflect.deleteProperty(t,Eu)}),this.insert$=this.database.insert$,this.update$=this.database.update$,this.remove$=this.database.remove$}deletedIds=new Set;deletedCoords=new Map;checkDeleted(t){if(typeof t=="string")return this.deletedIds.has(t);if(this.deletedIds.has(t.id))return!0;if(ds(t.kind)){const n=t.tags.find(i=>i[0]==="d")?.[1],r=this.deletedCoords.get(st(t.kind,t.pubkey,n));if(r)return r>t.created_at}return!1}expirations=new Map;addExpiration(t){const n=co(t);n&&Number.isFinite(n)&&this.expirations.set(t.id,n)}expirationTimeout=null;nextExpirationCheck=null;handleExpiringEvent(t){const n=co(t);if(!n||(this.expirations.set(t.id,n),this.expirationTimeout&&this.nextExpirationCheck&&this.nextExpirationCheck<n))return;this.expirationTimeout&&clearTimeout(this.expirationTimeout);const r=n-ao();this.expirationTimeout=setTimeout(this.pruneExpired.bind(this),r*1e3+10),this.nextExpirationCheck=n}pruneExpired(){const t=ao();for(const[n,r]of this.expirations)r<=t&&(this.expirations.delete(n),this.remove(n));this.expirationTimeout&&clearTimeout(this.expirationTimeout),this.nextExpirationCheck=null,this.expirationTimeout=null}handleDeleteEvent(t){const n=Q3(t);for(const i of n){this.deletedIds.add(i);const s=this.database.getEvent(i);s&&this.database.remove(s)}const r=Y3(t);for(const i of r){this.deletedCoords.set(i,Math.max(this.deletedCoords.get(i)??0,t.created_at));const s=Lp(i);if(!s)continue;const o=this.database.getReplaceableHistory(s.kind,s.pubkey,s.identifier)??[];for(const a of o)a.created_at<t.created_at&&this.database.remove(a)}}static mergeDuplicateEvent(t,n){const r=gS(t);if(r)for(const s of r)Zo(n,s);const i=Reflect.get(t,pi);i&&!Reflect.get(n,pi)&&Reflect.set(n,pi,i)}add(t,n){if(t.kind===z.EventDeletion&&this.handleDeleteEvent(t),this.checkDeleted(t))return t;const r=co(t);if(this.keepExpired===!1&&r&&r<=ao())return null;const i=Ve(t.kind)?t.tags.find(o=>o[0]==="d")?.[1]:void 0;if(!this.keepOldVersions&&Ve(t.kind)){const o=this.database.getReplaceableHistory(t.kind,t.pubkey,i);if(o&&o.length>0&&o[0].created_at>=t.created_at)return Ur.mergeDuplicateEvent(t,o[0]),o[0]}else if(this.database.hasEvent(t.id)){const o=this.database.getEvent(t.id);if(o)return Ur.mergeDuplicateEvent(t,o),o}const s=this.database.add(t);if(s===null)return null;if(t!==s&&Ur.mergeDuplicateEvent(t,s),n&&Zo(s,n),!this.keepOldVersions&&Ve(t.kind)){const o=this.database.getReplaceableHistory(t.kind,t.pubkey,i);if(o){const a=Array.from(o).filter(c=>c.created_at<t.created_at);for(const c of a)this.database.remove(c);if(o.length!==a.length)return o[0]}}return this.keepExpired===!1&&r&&this.handleExpiringEvent(s),s}remove(t){return this.database.remove(t)}update(t){return this.database.update(t)}prune(t){return this.database.prune(t)}hasEvent(t){return this.database.hasEvent(t)}getEvent(t){return this.database.getEvent(t)}hasReplaceable(t,n,r){return this.database.hasReplaceable(t,n,r)}getReplaceable(t,n,r){return this.database.getReplaceable(t,n,r)}getReplaceableHistory(t,n,r){return this.database.getReplaceableHistory(t,n,r)}getByFilters(t){return this.database.getByFilters(t)}getTimeline(t){return this.database.getTimeline(t)}claim(t,n){this.database.claim(t,n)}isClaimed(t){return this.database.isClaimed(t)}removeClaim(t,n){this.database.removeClaim(t,n)}clearClaim(t){this.database.clearClaim(t)}models=new Map;modelKeepWarm=6e4;model(t,...n){let r=this.models.get(t);r||(r=new Map,this.models.set(t,r));const i=t.getKey?t.getKey(...n):Z3(n);let s=r.get(i);if(!s){const o=()=>{r.get(i)===s&&r.delete(i)};s=t(...n)(this).pipe(Zr(o),Oe({connector:()=>new Tr(1),resetOnComplete:()=>Nn(this.modelKeepWarm),resetOnRefCountZero:()=>Nn(this.modelKeepWarm)})),r.set(i,s)}return s}filters(t,n=!1){return t=Array.isArray(t)?t:[t],Ee(n?se:Re(this.getByFilters(t)),this.insert$.pipe(Y(r=>Go(t,r))))}removed(t){return this.checkDeleted(t)?se:this.remove$.pipe(Y(r=>r.id===t),An(1),ys(()=>se))}updated(t){return this.database.update$.pipe(Y(n=>n.id===t||n===t))}event(t){return typeof t=="string"&&(t={id:t}),this.model(Bp,t)}replaceable(...t){let n;if(t.length===1)n=t[0];else if(t.length===3||t.length===2){let[r,i,s]=t;n={kind:r,pubkey:i,identifier:s}}if(!n)throw new Error("Invalid arguments, expected address pointer or kind, pubkey, identifier");return this.model(Qo,n)}addressable(t){return this.model(Qo,t)}timeline(t,n=!1){return this.model(ZS,t,n)}profile(t){return this.model(i_,t)}contacts(t){return typeof t=="string"&&(t={pubkey:t}),this.model(e_,t)}mutes(t){return typeof t=="string"&&(t={pubkey:t}),this.model(r_,t)}mailboxes(t){return typeof t=="string"&&(t={pubkey:t}),this.model(n_,t)}blossomServers(t){return typeof t=="string"&&(t={pubkey:t}),this.model(xS,t)}reactions(t){return this.model(s_,t)}thread(t){return this.model(a_,t)}comments(t){return this.model(t_,t)}events(t){return this.model(JS,t)}replaceableSet(t){return this.model(XS,t)}}const c_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Hp=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+=c_[n[e]&63];return t};function Fp(e){return W3(t=>t!=="EOSE",e)}function Yo(){return e=>e.pipe(Y(t=>t!=="EOSE"))}class l_{relays;constructor(t){this.relays=t}mergeEOSE(...t){const n=Ee(...t).pipe(Yo()),r=Ee(...t.map(i=>i.pipe(Fp(),Rr()))).pipe(er("EOSE"));return Ee(n,r)}req(t,n=Hp(8)){const r=this.relays.map(i=>i.req(t,n).pipe(Ce(()=>be("EOSE"))));return this.mergeEOSE(...r)}event(t){return Ee(...this.relays.map(n=>n.event(t).pipe(Ce(r=>be({ok:!1,from:n.url,message:r?.message||"Unknown error"})))))}publish(t,n){return Promise.all(this.relays.map(r=>r.publish(t,n).catch(i=>({ok:!1,from:r.url,message:i?.message||"Unknown error"}))))}request(t,n){return Ee(...this.relays.map(r=>r.request(t,n).pipe(Ce(()=>se))))}subscription(t,n){return this.mergeEOSE(...this.relays.map(r=>r.subscription(t,n).pipe(Ce(()=>se))))}}const uo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lc=e=>e instanceof Uint8Array,fo=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),rt=(e,t)=>e<<32-t|e>>>t,u_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!u_)throw new Error("Non little-endian hardware is not supported");const f_=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function me(e){if(!Lc(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=f_[e[n]];return t}function Bn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const i=r*2,s=e.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function d_(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Wr(e){if(typeof e=="string"&&(e=d_(e)),!Lc(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function bs(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!Lc(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Dp=class{clone(){return this._cloneInto()}};function jp(e){const t=r=>e().update(Wr(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Wp(e=32){if(uo&&typeof uo.getRandomValues=="function")return uo.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ea(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function h_(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function qp(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function p_(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ea(e.outputLen),ea(e.blockLen)}function g_(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function y_(e,t){qp(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ut={number:ea,bool:h_,bytes:qp,hash:p_,exists:g_,output:y_};function w_(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}let v_=class extends Dp{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=fo(this.buffer)}update(t){ut.exists(this);const{view:n,buffer:r,blockLen:i}=this;t=Wr(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=fo(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ut.exists(this),ut.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;w_(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=fo(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}};const b_=(e,t,n)=>e&t^~e&n,m_=(e,t,n)=>e&t^e&n^t&n,x_=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rn=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),sn=new Uint32Array(64);let zp=class extends v_{constructor(){super(64,32,8,!1),this.A=rn[0]|0,this.B=rn[1]|0,this.C=rn[2]|0,this.D=rn[3]|0,this.E=rn[4]|0,this.F=rn[5]|0,this.G=rn[6]|0,this.H=rn[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)sn[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=sn[f-15],h=sn[f-2],g=rt(d,7)^rt(d,18)^d>>>3,p=rt(h,17)^rt(h,19)^h>>>10;sn[f]=p+sn[f-7]+g+sn[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const d=rt(a,6)^rt(a,11)^rt(a,25),h=u+d+b_(a,c,l)+x_[f]+sn[f]|0,p=(rt(r,2)^rt(r,13)^rt(r,22))+m_(r,i,s)|0;u=l,l=c,c=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){sn.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},E_=class extends zp{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}};const wr=jp(()=>new zp);jp(()=>new E_);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function vr(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function jt(...e){const t=(i,s)=>o=>i(s(o)),n=Array.from(e).reverse().reduce((i,s)=>i?t(i,s.encode):s.encode,void 0),r=e.reduce((i,s)=>i?t(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Wt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(vr(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function qt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function ms(e,t="="){if(vr(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Vp(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Nu(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach(o=>{if(vr(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[c]=Math.floor(u/n),!Number.isSafeInteger(s[c])||s[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(i.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)i.push(0);return i.reverse()}const Kp=(e,t)=>t?Kp(t,e%t):e,Mi=(e,t)=>e+(t-Kp(e,t));function ta(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Mi(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Mi(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const c of e){if(vr(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(i=i<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function $_(e){return vr(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Nu(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Nu(t,e,2**8))}}}function vn(e,t=!1){if(vr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Mi(8,e)>32||Mi(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return ta(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(ta(n,e,8,t))}}}function Bu(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const S_=jt(vn(4),Wt("0123456789ABCDEF"),qt("")),__=jt(vn(5),Wt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ms(5),qt(""));jt(vn(5),Wt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ms(5),qt(""));jt(vn(5),Wt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),qt(""),Vp(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Ot=jt(vn(6),Wt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ms(6),qt("")),k_=jt(vn(6),Wt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ms(6),qt("")),Tc=e=>jt($_(58),Wt(e),qt("")),na=Tc("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Tc("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Tc("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Mu=[0,2,3,5,6,7,9,10,11],A_={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=na.encode(r).padStart(Mu[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=Mu.indexOf(r.length),s=na.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},ra=jt(Wt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),qt("")),Pu=[996825010,642813549,513874426,1027748829,705979059];function Sr(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Pu.length;r++)(t>>r&1)===1&&(n^=Pu[r]);return n}function Hu(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=Sr(i)^o>>5}i=Sr(i);for(let s=0;s<r;s++)i=Sr(i)^e.charCodeAt(s)&31;for(let s of t)i=Sr(i)^s;for(let s=0;s<6;s++)i=Sr(i);return i^=n,ra.encode(ta([i%2**30],30,5,!1))}function Gp(e){const t=e==="bech32"?1:734539939,n=vn(5),r=n.decode,i=n.encode,s=Bu(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);return u=u.toLowerCase(),`${u}1${ra.encode(f)}${Hu(u,f,t)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=d;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=u.slice(0,h),p=u.slice(h+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");const y=ra.decode(p).slice(0,-6),v=Hu(g,y,t);if(!p.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:g,words:y}}const c=Bu(a);function l(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const ur=Gp("bech32");Gp("bech32m");const C_={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},R_=jt(vn(4),Wt("0123456789abcdef"),qt(""),Vp(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),L_={utf8:C_,hex:R_,base16:S_,base32:__,base64:Ot,base64url:k_,base58:na,base58xmr:A_};`${Object.keys(L_).join(", ")}`;let Zp=class extends Dp{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ut.hash(t);const r=Wr(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return ut.exists(this),this.iHash.update(t),this}digestInto(t){ut.exists(this),ut.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const xs=(e,t,n)=>new Zp(e,t).update(n).digest();xs.create=(e,t)=>new Zp(e,t);function T_(e,t,n){return ut.hash(e),xs(e,Wr(n),Wr(t))}const ho=new Uint8Array([0]),Fu=new Uint8Array;function I_(e,t,n,r=32){if(ut.hash(e),ut.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);n===void 0&&(n=Fu);const s=new Uint8Array(i*e.outputLen),o=xs.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)ho[0]=l+1,a.update(l===0?Fu:c).update(n).update(ho).digestInto(c),s.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),ho.fill(0),s.slice(0,r)}var U_=Object.defineProperty,X=(e,t)=>{for(var n in t)U_(e,n,{get:t[n],enumerable:!0})},Vn=Symbol("verified"),O_=e=>e instanceof Object;function Ic(e){if(!O_(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var N_={};X(N_,{Queue:()=>H_,QueueNode:()=>Jp,binarySearch:()=>Uc,bytesToHex:()=>me,hexToBytes:()=>Bn,insertEventIntoAscendingList:()=>P_,insertEventIntoDescendingList:()=>M_,normalizeURL:()=>B_,utf8Decoder:()=>At,utf8Encoder:()=>Je});var At=new TextDecoder("utf-8"),Je=new TextEncoder;function B_(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function M_(e,t){const[n,r]=Uc(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function P_(e,t){const[n,r]=Uc(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return r||e.splice(n,0,t),e}function Uc(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var Jp=class{value;next=null;prev=null;constructor(t){this.value=t}},H_=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const n=new Jp(t);return this.last?this.last===this.first?(this.last=n,this.last.prev=this.first,this.first.next=n):(n.prev=this.last,this.last.next=n,this.last=n):(this.first=n,this.last=n),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const n=this.first;return this.first=null,this.last=null,n.value}const t=this.first;return this.first=t.next,this.first&&(this.first.prev=null),t.value}},F_=class{generateSecretKey(){return oe.utils.randomPrivateKey()}getPublicKey(t){return me(oe.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=me(oe.getPublicKey(n)),r.id=wi(r),r.sig=me(oe.sign(wi(r),n)),r[Vn]=!0,r}verifyEvent(t){if(typeof t[Vn]=="boolean")return t[Vn];const n=wi(t);if(n!==t.id)return t[Vn]=!1,!1;try{const r=oe.verify(t.sig,n,t.pubkey);return t[Vn]=r,r}catch{return t[Vn]=!1,!1}}};function D_(e){if(!Ic(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function wi(e){let t=wr(Je.encode(D_(e)));return me(t)}var Es=new F_,j_=Es.generateSecretKey,Oc=Es.getPublicKey,pt=Es.finalizeEvent,Nc=Es.verifyEvent,W_={};X(W_,{Application:()=>j4,BadgeAward:()=>X_,BadgeDefinition:()=>N4,BlockedRelaysList:()=>b4,BookmarkList:()=>y4,Bookmarksets:()=>I4,Calendar:()=>Z4,CalendarEventRSVP:()=>J4,ChannelCreation:()=>n0,ChannelHideMessage:()=>s0,ChannelMessage:()=>i0,ChannelMetadata:()=>r0,ChannelMuteUser:()=>o0,ClassifiedListing:()=>z4,ClientAuth:()=>c0,CommunitiesList:()=>w4,CommunityDefinition:()=>Y4,CommunityPostApproval:()=>s4,Contacts:()=>G_,CreateOrUpdateProduct:()=>P4,CreateOrUpdateStall:()=>M4,Curationsets:()=>U4,Date:()=>K4,DirectMessageRelaysList:()=>$4,DraftClassifiedListing:()=>V4,DraftLong:()=>F4,Emojisets:()=>D4,EncryptedDirectMessage:()=>Z_,EventDeletion:()=>J_,FileMetadata:()=>Y_,FileServerPreference:()=>S4,Followsets:()=>R4,GenericRepost:()=>Fc,Genericlists:()=>L4,GiftWrap:()=>a0,HTTPAuth:()=>Dc,Handlerinformation:()=>Q4,Handlerrecommendation:()=>X4,Highlights:()=>d4,InterestsList:()=>x4,Interestsets:()=>B4,JobFeedback:()=>c4,JobRequest:()=>o4,JobResult:()=>a4,Label:()=>i4,LightningPubRPC:()=>k4,LiveChatMessage:()=>e4,LiveEvent:()=>W4,LongFormArticle:()=>H4,Metadata:()=>V_,Mutelist:()=>h4,NWCWalletInfo:()=>_4,NWCWalletRequest:()=>l0,NWCWalletResponse:()=>A4,NostrConnect:()=>C4,OpenTimestamps:()=>Q_,Pinlist:()=>p4,PrivateDirectMessage:()=>t0,ProblemTracker:()=>t4,ProfileBadges:()=>O4,PublicChatsList:()=>v4,Reaction:()=>Hc,RecommendRelay:()=>K_,RelayList:()=>g4,Relaysets:()=>T4,Report:()=>n4,Reporting:()=>r4,Repost:()=>Pc,Seal:()=>e0,SearchRelaysList:()=>m4,ShortTextNote:()=>Yp,Time:()=>G4,UserEmojiList:()=>E4,UserStatuses:()=>q4,Zap:()=>f4,ZapGoal:()=>l4,ZapRequest:()=>u4,classifyKind:()=>q_,isAddressableKind:()=>Mc,isEphemeralKind:()=>Qp,isKind:()=>z_,isRegularKind:()=>Xp,isReplaceableKind:()=>Bc});function Xp(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Bc(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Qp(e){return 2e4<=e&&e<3e4}function Mc(e){return 3e4<=e&&e<4e4}function q_(e){return Xp(e)?"regular":Bc(e)?"replaceable":Qp(e)?"ephemeral":Mc(e)?"parameterized":"unknown"}function z_(e,t){const n=t instanceof Array?t:[t];return Ic(e)&&n.includes(e.kind)||!1}var V_=0,Yp=1,K_=2,G_=3,Z_=4,J_=5,Pc=6,Hc=7,X_=8,e0=13,t0=14,Fc=16,n0=40,r0=41,i0=42,s0=43,o0=44,Q_=1040,a0=1059,Y_=1063,e4=1311,t4=1971,n4=1984,r4=1984,i4=1985,s4=4550,o4=5999,a4=6999,c4=7e3,l4=9041,u4=9734,f4=9735,d4=9802,h4=1e4,p4=10001,g4=10002,y4=10003,w4=10004,v4=10005,b4=10006,m4=10007,x4=10015,E4=10030,$4=10050,S4=10096,_4=13194,k4=21e3,c0=22242,l0=23194,A4=23195,C4=24133,Dc=27235,R4=3e4,L4=30001,T4=30002,I4=30003,U4=30004,O4=30008,N4=30009,B4=30015,M4=30017,P4=30018,H4=30023,F4=30024,D4=30030,j4=30078,W4=30311,q4=30315,z4=30402,V4=30403,K4=31922,G4=31923,Z4=31924,J4=31925,X4=31989,Q4=31990,Y4=34550,ek={};X(ek,{getHex64:()=>jc,getInt:()=>u0,getSubscriptionId:()=>tk,matchEventId:()=>nk,matchEventKind:()=>ik,matchEventPubkey:()=>rk});function jc(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function u0(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function tk(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return e.slice(r+1,s)}function nk(e,t){return t===jc(e,"id")}function rk(e,t){return t===jc(e,"pubkey")}function ik(e,t){return t===u0(e,"kind")}var f0={};X(f0,{makeAuthEvent:()=>sk});function sk(e,t){return{kind:c0,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var ok;try{ok=WebSocket}catch{}var ak;try{ak=WebSocket}catch{}var ck={};X(ck,{BECH32_REGEX:()=>d0,Bech32MaxSize:()=>Wc,NostrTypeGuard:()=>lk,decode:()=>$s,decodeNostrURI:()=>fk,encodeBytes:()=>_s,naddrEncode:()=>wk,neventEncode:()=>yk,noteEncode:()=>pk,nprofileEncode:()=>gk,npubEncode:()=>hk,nsecEncode:()=>dk});var lk={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Wc=5e3,d0=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function uk(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function fk(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),$s(e)}catch{return{type:"invalid",data:null}}}function $s(e){let{prefix:t,words:n}=ur.decode(e,Wc),r=new Uint8Array(ur.fromWords(n));switch(t){case"nprofile":{let i=po(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:me(i[0][0]),relays:i[1]?i[1].map(s=>At.decode(s)):[]}}}case"nevent":{let i=po(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:me(i[0][0]),relays:i[1]?i[1].map(s=>At.decode(s)):[],author:i[2]?.[0]?me(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(me(i[3][0]),16):void 0}}}case"naddr":{let i=po(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:At.decode(i[0][0]),pubkey:me(i[2][0]),kind:parseInt(me(i[3][0]),16),relays:i[1]?i[1].map(s=>At.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:me(r)};default:throw new Error(`unknown prefix ${t}`)}}function po(e){let t={},n=e;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function dk(e){return _s("nsec",e)}function hk(e){return _s("npub",Bn(e))}function pk(e){return _s("note",Bn(e))}function Ss(e,t){let n=ur.toWords(t);return ur.encode(e,n,Wc)}function _s(e,t){return Ss(e,t)}function gk(e){let t=qc({0:[Bn(e.pubkey)],1:(e.relays||[]).map(n=>Je.encode(n))});return Ss("nprofile",t)}function yk(e){let t;e.kind!==void 0&&(t=uk(e.kind));let n=qc({0:[Bn(e.id)],1:(e.relays||[]).map(r=>Je.encode(r)),2:e.author?[Bn(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Ss("nevent",n)}function wk(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=qc({0:[Je.encode(e.identifier)],1:(e.relays||[]).map(r=>Je.encode(r)),2:[Bn(e.pubkey)],3:[new Uint8Array(t)]});return Ss("naddr",n)}function qc(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),t.push(s)})}),bs(...t)}var vk={};X(vk,{decrypt:()=>bk,encrypt:()=>h0});function h0(e,t,n){const r=e instanceof Uint8Array?me(e):e,i=Le.getSharedSecret(r,"02"+t),s=p0(i);let o=Uint8Array.from(Wp(16)),a=Je.encode(n),c=gn(s,o).encrypt(a),l=Ot.encode(new Uint8Array(c)),u=Ot.encode(new Uint8Array(o.buffer));return`${l}?iv=${u}`}function bk(e,t,n){const r=e instanceof Uint8Array?me(e):e;let[i,s]=n.split("?iv="),o=Le.getSharedSecret(r,"02"+t),a=p0(o),c=Ot.decode(s),l=Ot.decode(i),u=gn(a,c).decrypt(l);return At.decode(u)}function p0(e){return e.slice(1,33)}var mk={};X(mk,{NIP05_REGEX:()=>zc,isNip05:()=>xk,isValid:()=>Sk,queryProfile:()=>g0,searchDomain:()=>$k,useFetchImplementation:()=>Ek});var zc=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,xk=e=>zc.test(e||""),ks;try{ks=fetch}catch{}function Ek(e){ks=e}async function $k(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await ks(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function g0(e){const t=e.match(zc);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await ks(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function Sk(e,t){const n=await g0(t);return n?n.pubkey===e:!1}var _k={};X(_k,{parse:()=>kk});function kk(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if(s[0]==="e"&&s[1]){const[o,a,c,l,u]=s,f={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=f;continue}if(l==="reply"){t.reply=f;continue}if(l==="mention"){t.mentions.push(f);continue}n?r=f:n=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let s=t.mentions.indexOf(i);if(s!==-1&&t.mentions.splice(s,1),i.author){let o=t.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let s=t.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),t}var Ak={};X(Ak,{fetchRelayInformation:()=>Rk,useFetchImplementation:()=>Ck});var y0;try{y0=fetch}catch{}function Ck(e){y0=e}async function Rk(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Lk={};X(Lk,{fastEventHash:()=>v0,getPow:()=>w0,minePow:()=>Tk});function w0(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function Tk(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=v0(r),w0(r.id)>=t)break}return r}function v0(e){return me(wr(Je.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var Ik={};X(Ik,{unwrapEvent:()=>qk,unwrapManyEvents:()=>zk,wrapEvent:()=>T0,wrapManyEvents:()=>Wk});var Uk={};X(Uk,{createRumor:()=>A0,createSeal:()=>C0,createWrap:()=>R0,unwrapEvent:()=>Jc,unwrapManyEvents:()=>L0,wrapEvent:()=>Pi,wrapManyEvents:()=>Dk});var Ok={};X(Ok,{decrypt:()=>Zc,encrypt:()=>Gc,getConversationKey:()=>Vc,v2:()=>Hk});var b0=1,m0=65535;function Vc(e,t){const n=Le.getSharedSecret(e,"02"+t).subarray(1,33);return T_(wr,n,"nip44-v2")}function x0(e,t){const n=I_(wr,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Kc(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Nk(e){if(!Number.isSafeInteger(e)||e<b0||e>m0)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Bk(e){const t=Je.encode(e),n=t.length,r=Nk(n),i=new Uint8Array(Kc(n)-n);return bs(r,t,i)}function Mk(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<b0||t>m0||n.length!==t||e.length!==2+Kc(t))throw new Error("invalid padding");return At.decode(n)}function E0(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=bs(n,t);return xs(wr,e,r)}function Pk(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=Ot.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Gc(e,t,n=Wp(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=x0(t,n),o=Bk(e),a=yn(r,i,o),c=E0(s,a,n);return Ot.encode(bs(new Uint8Array([2]),n,a,c))}function Zc(e,t){const{nonce:n,ciphertext:r,mac:i}=Pk(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=x0(t,n),c=E0(a,r,n);if(!Xi(c,i))throw new Error("invalid MAC");const l=yn(s,o,r);return Mk(l)}var Hk={utils:{getConversationKey:Vc,calcPaddedLen:Kc},encrypt:Gc,decrypt:Zc},Fk=2*24*60*60,$0=()=>Math.round(Date.now()/1e3),S0=()=>Math.round($0()-Math.random()*Fk),_0=(e,t)=>Vc(e,t),k0=(e,t,n)=>Gc(JSON.stringify(e),_0(t,n)),Du=(e,t)=>JSON.parse(Zc(e.content,_0(t,e.pubkey)));function A0(e,t){const n={created_at:$0(),content:"",tags:[],...e,pubkey:Oc(t)};return n.id=wi(n),n}function C0(e,t,n){return pt({kind:e0,content:k0(e,t,n),created_at:S0(),tags:[]},t)}function R0(e,t){const n=j_();return pt({kind:a0,content:k0(e,n,t),created_at:S0(),tags:[["p",t]]},n)}function Pi(e,t,n){const r=A0(e,t),i=C0(r,t,n);return R0(i,n)}function Dk(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Oc(t),i=[Pi(e,t,r)];return n.forEach(s=>{i.push(Pi(e,t,s))}),i}function Jc(e,t){const n=Du(e,t);return Du(n,t)}function L0(e,t){let n=[];return e.forEach(r=>{n.push(Jc(r,t))}),n.sort((r,i)=>r.created_at-i.created_at),n}function jk(e,t,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:t0,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function T0(e,t,n,r,i){const s=jk(t,n,r,i);return Pi(s,e,t.publicKey)}function Wk(e,t,n,r,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Oc(e)},...t].map(o=>T0(e,o,n,r,i))}var qk=Jc,zk=L0,Vk={};X(Vk,{finishRepostEvent:()=>Kk,getRepostedEvent:()=>Gk,getRepostedEventPointer:()=>I0});function Kk(e,t,n,r){let i;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===Yp?i=Pc:(i=Fc,s.push(["k",String(t.kind)])),pt({kind:i,tags:s,content:e.content===""||t.tags?.find(o=>o[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function I0(e){if(![Pc,Fc].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function Gk(e,{skipVerification:t}={}){const n=I0(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!Nc(r)))return r}var Zk={};X(Zk,{NOSTR_URI_REGEX:()=>Xc,parse:()=>Xk,test:()=>Jk});var Xc=new RegExp(`nostr:(${d0.source})`);function Jk(e){return typeof e=="string"&&new RegExp(`^${Xc.source}$`).test(e)}function Xk(e){const t=e.match(new RegExp(`^${Xc.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:$s(t[1])}}var Qk={};X(Qk,{finishReactionEvent:()=>Yk,getReactedEventPointer:()=>eA});function Yk(e,t,n){const r=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return pt({...e,kind:Hc,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function eA(e){if(e.kind!==Hc)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var tA={};X(tA,{parse:()=>rA});var nA=/\W/m,ju=/\W |\W$|$|,| /m;function*rA(e){const t=e.length;let n=0,r=0;for(;r<t;){let i=e.indexOf(":",r);if(i===-1)break;if(e.substring(i-5,i)==="nostr"){const s=e.substring(i+60).match(nA),o=s?i+60+s.index:t;try{let a,{data:c,type:l}=$s(e.substring(i+1,o));switch(l){case"npub":a={pubkey:c};break;case"nsec":case"note":r=o+1;continue;default:a=c}n!==i-5&&(yield{type:"text",text:e.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(e.substring(i-5,i)==="https"||e.substring(i-4,i)==="http"){const s=e.substring(i+4).match(ju),o=s?i+4+s.index:t,a=e[i-1]==="s"?5:4;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),c.pathname.endsWith(".png")||c.pathname.endsWith(".jpg")||c.pathname.endsWith(".jpeg")||c.pathname.endsWith(".gif")||c.pathname.endsWith(".webp")){yield{type:"image",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp4")||c.pathname.endsWith(".avi")||c.pathname.endsWith(".webm")||c.pathname.endsWith(".mkv")){yield{type:"video",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp3")||c.pathname.endsWith(".aac")||c.pathname.endsWith(".ogg")||c.pathname.endsWith(".opus")){yield{type:"audio",url:c.toString()},r=o,n=r;continue}yield{type:"url",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(e.substring(i-3,i)==="wss"||e.substring(i-2,i)==="ws"){const s=e.substring(i+4).match(ju),o=s?i+4+s.index:t,a=e[i-1]==="s"?3:2;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),yield{type:"relay",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==t&&(yield{type:"text",text:e.substring(n)})}var iA={};X(iA,{channelCreateEvent:()=>sA,channelHideMessageEvent:()=>cA,channelMessageEvent:()=>aA,channelMetadataEvent:()=>oA,channelMuteUserEvent:()=>lA});var sA=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return pt({kind:n0,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},oA=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return pt({kind:r0,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},aA=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),pt({kind:i0,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},cA=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return pt({kind:s0,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},lA=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return pt({kind:o0,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},uA={};X(uA,{EMOJI_SHORTCODE_REGEX:()=>U0,matchAll:()=>fA,regex:()=>Qc,replaceAll:()=>dA});var U0=/:(\w+):/,Qc=()=>new RegExp(`\\B${U0.source}\\B`,"g");function*fA(e){const t=e.matchAll(Qc());for(const n of t)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function dA(e,t){return e.replaceAll(Qc(),(n,r)=>t({shortcode:n,name:r}))}var hA={};X(hA,{useFetchImplementation:()=>pA,validateGithub:()=>gA});var Yc;try{Yc=fetch}catch{}function pA(e){Yc=e}async function gA(e,t,n){try{return await(await Yc(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var yA={};X(yA,{makeNwcRequestEvent:()=>vA,parseConnectionString:()=>wA});function wA(e){const{host:t,pathname:n,searchParams:r}=new URL(e),i=n||t,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function vA(e,t,n){const i=h0(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:l0,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return pt(s,t)}var bA={};X(bA,{normalizeIdentifier:()=>mA});function mA(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var xA={};X(xA,{getSatoshisAmountFromBolt11:()=>AA,getZapEndpoint:()=>$A,makeZapReceipt:()=>kA,makeZapRequest:()=>SA,useFetchImplementation:()=>EA,validateZapRequest:()=>_A});var el;try{el=fetch}catch{}function EA(e){el=e}async function $A(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:o}=ur.decode(n,1e3),a=ur.fromWords(o);t=At.decode(a)}else if(r){let[o,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await el(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function SA({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};if(t&&typeof t=="string"&&s.tags.push(["e",t]),t&&typeof t=="object"){if(Bc(t.kind)){const o=["a",`${t.kind}:${t.pubkey}:`];s.tags.push(o)}else if(Mc(t.kind)){let o=t.tags.find(([c,l])=>c==="d"&&l);if(!o)throw new Error("d tag not found or is empty");const a=["a",`${t.kind}:${t.pubkey}:${o[1]}`];s.tags.push(a)}}return s}function _A(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Ic(t))return"Zap request is not a valid Nostr event.";if(!Nc(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function kA({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}function AA(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const c=parseInt(r.substring(0,a));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var CA={};X(CA,{getToken:()=>RA,hashPayload:()=>tl,unpackEventFromToken:()=>N0,validateEvent:()=>D0,validateEventKind:()=>M0,validateEventMethodTag:()=>H0,validateEventPayloadTag:()=>F0,validateEventTimestamp:()=>B0,validateEventUrlTag:()=>P0,validateToken:()=>LA});var O0="Nostr ";async function RA(e,t,n,r=!1,i){const s={kind:Dc,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",tl(i)]);const o=await n(s);return(r?O0:"")+Ot.encode(Je.encode(JSON.stringify(o)))}async function LA(e,t,n){const r=await N0(e).catch(s=>{throw s});return await D0(r,t,n).catch(s=>{throw s})}async function N0(e){if(!e)throw new Error("Missing token");e=e.replace(O0,"");const t=At.decode(Ot.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function B0(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function M0(e){return e.kind===Dc}function P0(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function H0(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function tl(e){const t=wr(Je.encode(JSON.stringify(e)));return me(t)}function F0(e,t){const n=e.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=tl(t);return n.length>0&&n[1]===r}async function D0(e,t,n,r){if(!Nc(e))throw new Error("Invalid nostr event, signature invalid");if(!M0(e))throw new Error("Invalid nostr event, kind invalid");if(!B0(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!P0(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!H0(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!F0(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var TA={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},IA="WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }",UA=function(e){Qe(t,e);function t(n,r){var i=e.call(this)||this;if(i._socket=null,n instanceof ee)i.destination=r,i.source=n;else{var s=i._config=Wo({},TA);if(i._output=new Ae,typeof n=="string")s.url=n;else for(var o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new Tr}return i}return t.prototype.lift=function(n){var r=new t(this._config,this.destination);return r.operator=n,r.source=this,r},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new Tr),this._output=new Ae},t.prototype.multiplex=function(n,r,i){var s=this;return new ee(function(o){try{s.next(n())}catch(c){o.error(c)}var a=s.subscribe({next:function(c){try{i(c)&&o.next(c)}catch(l){o.error(l)}},error:function(c){return o.error(c)},complete:function(){return o.complete()}});return function(){try{s.next(r())}catch(c){o.error(c)}a.unsubscribe()}})},t.prototype._connectSocket=function(){var n=this,r=this._config,i=r.WebSocketCtor,s=r.protocol,o=r.url,a=r.binaryType,c=this._output,l=null;try{l=s?new i(o,s):new i(o),this._socket=l,a&&(this._socket.binaryType=a)}catch(f){c.error(f);return}var u=new Hn(function(){n._socket=null,l&&l.readyState===1&&l.close()});l.onopen=function(f){var d=n._socket;if(!d){l.close(),n._resetState();return}var h=n._config.openObserver;h&&h.next(f);var g=n.destination;n.destination=ps.create(function(p){if(l.readyState===1)try{var y=n._config.serializer;l.send(y(p))}catch(v){n.destination.error(v)}},function(p){var y=n._config.closingObserver;y&&y.next(void 0),p&&p.code?l.close(p.code,p.reason):c.error(new TypeError(IA)),n._resetState()},function(){var p=n._config.closingObserver;p&&p.next(void 0),l.close(),n._resetState()}),g&&g instanceof Tr&&u.add(g.subscribe(n.destination))},l.onerror=function(f){n._resetState(),c.error(f)},l.onclose=function(f){l===n._socket&&n._resetState();var d=n._config.closeObserver;d&&d.next(f),f.wasClean?c.complete():c.error(f)},l.onmessage=function(f){try{var d=n._config.deserializer;c.next(d(f))}catch(h){c.error(h)}}},t.prototype._subscribe=function(n){var r=this,i=this.source;return i?i.subscribe(n):(this._socket||this._connectSocket(),this._output.subscribe(n),n.add(function(){var s=r._socket;r._output.observers.length===0&&(s&&(s.readyState===1||s.readyState===0)&&s.close(),r._resetState())}),n)},t.prototype.unsubscribe=function(){var n=this._socket;n&&(n.readyState===1||n.readyState===0)&&n.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(qo);function OA(e){return new UA(e)}function NA(e){return t=>t.pipe(ce(n=>{typeof n!="string"&&Zo(n,e)}))}const go={count:10,delay:1e3,resetOnSuccess:!0};class Wu extends Error{}class Hi{url;log=vs.extend("Relay");socket;ready$=new he(!0);reconnectTimer;attempts$=new he(0);connected$=new he(!1);challenge$=new he(null);authenticated$;authenticationResponse$=new he(null);notices$=new he([]);error$=new he(null);message$;notice$;information$;_nip11=null;limitations$;open$=new Ae;close$=new Ae;closing$=new Ae;get connected(){return this.connected$.value}get challenge(){return this.challenge$.value}get notices(){return this.notices$.value}get authenticated(){return this.authenticationResponse?.ok===!0}get authenticationResponse(){return this.authenticationResponse$.value}get information(){return this._nip11}eoseTimeout=1e4;eventTimeout=1e4;keepAlive=3e4;receivedAuthRequiredForReq=new he(!1);receivedAuthRequiredForEvent=new he(!1);authRequiredForRead$;authRequiredForPublish$;resetState(){this.challenge$.value!==null&&this.challenge$.next(null),this.authenticationResponse$.value&&this.authenticationResponse$.next(null),this.notices$.value.length>0&&this.notices$.next([]),this.receivedAuthRequiredForReq.value&&this.receivedAuthRequiredForReq.next(!1),this.receivedAuthRequiredForEvent.value&&this.receivedAuthRequiredForEvent.next(!1)}watchTower;constructor(t,n){this.url=t,this.log=this.log.extend(t),n?.eoseTimeout!==void 0&&(this.eoseTimeout=n.eoseTimeout),n?.eventTimeout!==void 0&&(this.eventTimeout=n.eventTimeout),n?.keepAlive!==void 0&&(this.keepAlive=n.keepAlive),this.authenticated$=this.authenticationResponse$.pipe(ge(a=>a?.ok===!0)),this.reconnectTimer=Hi.createReconnectTimer(t),this.open$.subscribe(()=>{this.log("Connected"),this.connected$.next(!0),this.attempts$.next(0),this.error$.next(null),this.resetState()}),this.close$.subscribe(a=>{this.log("Disconnected"),this.connected$.next(!1),this.attempts$.next(this.attempts$.value+1),this.resetState(),a.wasClean||this.startReconnectTimer(a)}),this.socket=OA({url:t,openObserver:this.open$,closeObserver:this.close$,closingObserver:this.closing$,WebSocketCtor:n?.WebSocket}),this.information$=Dr(()=>(this.log("Fetching NIP-11 information document"),Hi.fetchInformationDocument(this.url))).pipe(Ce(()=>be(null)),oo(1),ce(a=>this._nip11=a)),this.limitations$=this.information$.pipe(ge(a=>a?.limitation)),this.authRequiredForRead$=this.receivedAuthRequiredForReq.pipe(ce(a=>a&&this.log("Auth required for REQ")),oo(1)),this.authRequiredForPublish$=this.receivedAuthRequiredForEvent.pipe(ce(a=>a&&this.log("Auth required for EVENT")),oo(1));const r=this.socket.pipe(Y(a=>Array.isArray(a)&&a[0]==="NOTICE"),ge(a=>a[1]),vp((a,c)=>[...a,c],[]),ce(a=>this.notices$.next(a))),i=this.socket.pipe(Y(a=>a[0]==="AUTH"),ge(a=>a[1]),ce(a=>{this.log("Received AUTH challenge",a),this.challenge$.next(a)})),s=new Ae,o=this.socket.pipe(ce(a=>s.next(a)));this.message$=s.asObservable(),this.notice$=this.message$.pipe(Y(a=>Array.isArray(a)&&a[0]==="NOTICE"),ge(a=>a[1])),this.watchTower=this.ready$.pipe(cn(a=>a?Ee(o,r,i,this.information$).pipe(Rr(),Ce(c=>(this.startReconnectTimer(c instanceof Error?c:new Error("Connection error")),si)),Oe({resetOnRefCountZero:()=>Nn(this.keepAlive)})):si),Oe())}startReconnectTimer(t){this.ready$.value&&(this.error$.next(t instanceof Error?t:new Error("Connection error")),this.ready$.next(!1),this.reconnectTimer(t,this.attempts$.value).pipe(An(1)).subscribe(()=>this.ready$.next(!0)))}waitForAuth(t,n){return xc([t,this.authenticated$]).pipe(Ko(this.watchTower),Y(([r,i])=>!r||i),An(1),cn(()=>n))}waitForReady(t){return this.ready$.value?t:this.ready$.pipe(Y(n=>n),An(1),cn(()=>t))}multiplex(t,n,r){return this.socket.multiplex(t,n,r)}send(t){this.socket.next(t)}req(t,n=Hp()){const r=gs(t)?t:Ee(be(t),si),i=r.pipe(Rr(),er(null)),s=this.socket.pipe(Y(c=>Array.isArray(c)&&(c[0]==="EVENT"||c[0]==="CLOSED"||c[0]==="EOSE")&&c[1]===n),Oe()),o=r.pipe(ce(c=>this.socket.next(Array.isArray(c)?["REQ",n,...c]:["REQ",n,c])),Zr(()=>this.socket.next(["CLOSE",n])),cn(()=>s)),a=Ee(this.watchTower,o).pipe(Ir(s.pipe(Rr(),er(!0))),Ir(i),ge(c=>{if(c[0]==="EOSE")return"EOSE";if(c[0]==="CLOSED")throw new Wu(c[2]);return c[2]}),Ce(c=>(c instanceof Wu&&c.message.startsWith("auth-required")&&!this.receivedAuthRequiredForReq.value&&(this.log("Auth required for REQ"),this.receivedAuthRequiredForReq.next(!0)),zo(()=>c))),NA(this.url),Vo({first:this.eoseTimeout,with:()=>Ee(be("EOSE"),si)}),Oe());return this.waitForReady(this.waitForAuth(this.authRequiredForRead$,a))}event(t,n="EVENT"){const r=Dr(()=>(this.socket.next([n,t]),this.socket.pipe(Y(s=>s[0]==="OK"&&s[1]===t.id),ge(s=>({ok:s[2],message:s[3],from:this.url}))))).pipe(Oe()),i=Ee(this.watchTower,r).pipe(Ir(r.pipe(Rr(),er(!0))),An(1),ce(({ok:s,message:o})=>{s===!1&&o?.startsWith("auth-required")&&!this.receivedAuthRequiredForEvent.value&&(this.log("Auth required for publish"),this.receivedAuthRequiredForEvent.next(!0))}),Vo({first:this.eventTimeout,with:()=>be({ok:!1,from:this.url,message:"Timeout"})}),Oe());return n==="AUTH"?this.waitForReady(i):this.waitForReady(this.waitForAuth(this.authRequiredForPublish$,i))}auth(t){return io(this.event(t,"AUTH").pipe(ce(n=>this.authenticationResponse$.next(n))))}authenticate(t){if(!this.challenge)throw new Error("Have not received authentication challenge");const n=t.signEvent(f0.makeAuthEvent(this.url,this.challenge)),r=n instanceof Promise?Re(n):be(n);return io(r.pipe(cn(i=>this.auth(i))))}customRetryOperator(t,n){return t===!1?Ze:typeof t=="number"?oi({...n,count:t}):t===!0?n?oi(n):oi():oi({...n,...t})}customRepeatOperator(t){return t===!1||t===void 0?Ze:t===!0?hi():hi(t)}subscription(t,n){return this.req(t,n?.id).pipe(this.customRetryOperator(n?.retries??n?.reconnect??!0,go),this.customRepeatOperator(n?.resubscribe),Oe())}request(t,n){return this.req(t,n?.id).pipe(this.customRetryOperator(n?.retries??n?.reconnect??!0,go),this.customRepeatOperator(n?.resubscribe),Fp(),Oe())}publish(t,n){return io(this.event(t).pipe(ys(r=>r.ok===!1&&r.message?.startsWith("auth-required:")?zo(()=>new Error(r.message)):be(r)),this.customRetryOperator(n?.retries??n?.reconnect??!0,go),Oe()))}close(){this.socket.unsubscribe()}static fetchInformationDocument(t){return Re(fetch(lS(t),{headers:{Accept:"application/nostr+json"}}).then(n=>n.json())).pipe(Ce(()=>be(null)),YS(1e4))}static createReconnectTimer(t){return(n,r=0)=>{const i=Math.min(Math.pow(1.5,r)*1e3,3e5);return Nn(i)}}}class BA{options;groups$=new he(new Map);get groups(){return this.groups$.value}relays$=new he(new Map);get relays(){return this.relays$.value}blacklist=new Set;constructor(t){this.options=t}filterBlacklist(t){return t.filter(n=>!this.blacklist.has(n))}relay(t){if(t=jr(t),this.blacklist.has(t))throw new Error("Relay is on blacklist");let n=this.relays.get(t);return n||(n=new Hi(t,this.options),this.relays.set(t,n),this.relays$.next(this.relays),n)}group(t){t=t.map(i=>jr(i)),t=this.filterBlacklist(t);const n=t.sort().join(",");let r=this.groups.get(n);return r||(r=new l_(t.map(i=>this.relay(i))),this.groups$.next(this.groups.set(n,r)),r)}remove(t,n=!0){let r;if(typeof t=="string"){if(r=this.relays.get(t),!r)return}else if(Array.from(this.relays.values()).some(i=>i===t))r=t;else return;n&&r?.close(),this.relays.delete(r.url),this.relays$.next(this.relays)}req(t,n,r){return this.group(t).req(n,r)}event(t,n){return this.group(t).event(n)}publish(t,n,r){return this.group(t).publish(n,r)}request(t,n,r){return this.group(t).request(n,r)}subscription(t,n,r){return this.group(t).subscription(n,r)}}function j0(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function W0(e){return 3e4<=e&&e<4e4}function yo(e){return Array.from(new Set(e))}function qu(e){const t={};t.kinds=yo(e.map(r=>r.kind)),t.authors=yo(e.map(r=>r.pubkey));const n=yo(e.map(r=>r.identifier).filter(r=>!!r));return n.length>0&&(t["#d"]=n),t}function nl(e){const t=e.filter(i=>j0(i.kind)),n=e.filter(i=>W0(i.kind)),r=[];if(t.length>0){const i=zu(t);r.push(...Array.from(i.values()).map(qu))}if(n.length>0){const i=zu(n);r.push(...Array.from(i.values()).map(qu))}return r}function MA(e){return W0(e.kind)?!!e.identifier:j0(e.kind)}function PA(e){const t=new Map;for(const n of e)t.has(n.kind)?t.get(n.kind).push(n):t.set(n.kind,[n]);return t}function HA(e){const t=new Map;for(const n of e)t.has(n.pubkey)?t.get(n.pubkey).push(n):t.set(n.pubkey,[n]);return t}function zu(e){const t=new Set(e.map(r=>r.kind));return new Set(e.map(r=>r.pubkey)).size<t.size?HA(e):PA(e)}function FA(e,t){const n=e(t);return gs(n)?n:n instanceof Promise?Re(n).pipe(cn(r=>Array.isArray(r)?Re(r):be(r))):Array.isArray(n)?Re(n):be(n)}function q0(e,t){return FA(e,t).pipe(ce(n=>nS(n)))}function z0(e,t){return gs(e)?e.pipe(An(1),cn(t)):t(e)}function V0(e,t,n,r){const i=new Ae,s=new Ae;return i.pipe(e).subscribe(o=>{if(o.length!==0)return s.next(t(o).pipe(Oe({resetOnRefCountZero:!1,resetOnComplete:!1,resetOnError:!1})))}),o=>new ee(a=>(i.next(o),s.pipe(An(1),ws(),Y(c=>n(o,c)),r??Ze).subscribe(a)))}function DA(e,t,n){if(typeof e=="function")return e(t,n);if(typeof e=="object"&&"request"in e)return e.request(t,n);throw new Error("Invalid upstream pool")}function K0(e){return(t,n)=>DA(e,t,n)}function jA(e){return new ee(t=>{let n;const r=i=>{const s=i?e.next(i):e.next(),o=a=>{if(a.done)return t.complete();const c=[];gs(a.value)?n=a.value.subscribe({next:l=>{c.push(l),t.next(l)},error:l=>{t.error(l)},complete:()=>{r(c)}}):(c.push(a.value),t.next(a.value),r(c))};s instanceof Promise?s.then(o,a=>t.error(a)):o(s)};return r(),()=>n?.unsubscribe()}).pipe(Oe())}function G0(e){return(...t)=>jA(e(...t))}function WA(e){return t=>(t=t.filter(n=>n.cache!==!1),t.length===0?se:q0(e,nl(t)))}function qA(e){return t=>{const n=Cc(...t.map(i=>i.relays));if(n.length===0)return se;const r=nl(t);return e(n,r)}}function Vu(e,t){return n=>z0(t,r=>{if(r.length===0)return se;const i=nl(n);return e(r,i)})}function zA(...e){return G0(function*(t){if(t=KA(t.filter(MA)),t.length===0)return;let n=Array.from(t);for(const r of e){if(r===void 0)continue;const i=yield r(n).pipe(Ce(()=>se)),s=new Set(i.filter(o=>Ve(o.kind)).map(o=>_c(o)));if(n=n.filter(o=>!s.has(st(o.kind,o.pubkey,o.identifier))),n.length===0)return}})}function VA(e){const t={...e};return e.relays&&(t.relays=[...e.relays]),t}function KA(e){const t=new Map;for(const n of e){const r=st(n.kind,n.pubkey,n.identifier);if(t.has(r)){const i=t.get(r);n.relays&&n.relays.length>0&&(i.relays?i.relays=Cc(i.relays,n.relays):i.relays=n.relays),n.cache===!1&&(i.cache=!1)}else t.set(r,VA(n))}return Array.from(t.values())}function GA(e,t){const n=K0(e);return V0(wp(t?.bufferTime??1e3,void 0,t?.bufferSize??200),zA(t?.cacheRequest?WA(t.cacheRequest):void 0,t?.followRelayHints!==!1?qA(n):void 0,t?.extraRelays?Vu(n,t.extraRelays):void 0,t?.lookupRelays?Vu(n,t.lookupRelays):void 0),(r,i)=>i.kind===r.kind&&i.pubkey===r.pubkey&&(r.identifier?kc(i)===r.identifier:!0),t?.eventStore&&Mp(t.eventStore))}var Ku;(function(e){e.Error="error",e.Missing="missing",e.Found="found"})(Ku||(Ku={}));function ZA(e){let t=new Map;for(let n of e){let r=t.get(n.id);r&&n.relays?r.relays?r.relays=[...r.relays,...n.relays.filter(i=>!r.relays.includes(i))]:r.relays=[...n.relays]:r||t.set(n.id,{...n})}return Array.from(t.values())}function JA(e,t){let n=new Map;for(const r of e){let i=Cc(r.relays,t);for(const s of i)n.has(s)?n.get(s)?.push(r):n.set(s,[r])}return n}function XA(e){return t=>(t=t.filter(n=>n.cache!==!1),t.length===0?se:q0(e,[{ids:t.map(n=>n.id)}]))}function Z0(e,t){return n=>z0(t,r=>e(r,[{ids:n.map(i=>i.id)}]))}function QA(e,t){return Z0(e,[t])}function YA(e,t=QA){const n=new Map,r=i=>{let s=n.get(i);return s||(s=t(e,i),n.set(i,s)),s};return i=>{const s=JA(i);return Ee(...Array.from(s).map(([o,a])=>r(o)(a)))}}function e8(...e){return G0(function*(t){if(t=ZA(t),t.length===0)return;const n=new Set;let r=Array.from(t);for(const i of e)if(i!==void 0&&(yield i(r).pipe(Ce(()=>se),ce(s=>n.add(s.id))),r=r.filter(s=>!n.has(s.id)),r.length===0))return})}function t8(e,t){const n=K0(e);return V0(wp(t?.bufferTime??1e3,void 0,t?.bufferSize??200),e8(t?.cacheRequest?XA(t.cacheRequest):void 0,t?.followRelayHints!==!1?YA(n):void 0,t?.extraRelays?Z0(n,t.extraRelays):void 0),(r,i)=>i.id===r.id,t?.eventStore&&Mp(t.eventStore))}const wo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const rl=e=>e instanceof Uint8Array,vo=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),it=(e,t)=>e<<32-t|e>>>t,n8=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!n8)throw new Error("Non little-endian hardware is not supported");const r8=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function xe(e){if(!rl(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=r8[e[n]];return t}function Mn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const i=r*2,s=e.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[r]=o}return n}function i8(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function qr(e){if(typeof e=="string"&&(e=i8(e)),!rl(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function As(...e){const t=new Uint8Array(e.reduce((r,i)=>r+i.length,0));let n=0;return e.forEach(r=>{if(!rl(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class J0{clone(){return this._cloneInto()}}function X0(e){const t=r=>e().update(qr(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Q0(e=32){if(wo&&typeof wo.getRandomValues=="function")return wo.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function ia(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function s8(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function Y0(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function o8(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");ia(e.outputLen),ia(e.blockLen)}function a8(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function c8(e,t){Y0(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ft={number:ia,bool:s8,bytes:Y0,hash:o8,exists:a8,output:c8};function l8(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+l,a,r)}class u8 extends J0{constructor(t,n,r,i){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=vo(this.buffer)}update(t){ft.exists(this);const{view:n,buffer:r,blockLen:i}=this;t=qr(t);const s=t.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=vo(t);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(t.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ft.exists(this),ft.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)n[f]=0;l8(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=vo(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return t.length=i,t.pos=a,t.finished=s,t.destroyed=o,i%n&&t.buffer.set(r),t}}const f8=(e,t,n)=>e&t^~e&n,d8=(e,t,n)=>e&t^e&n^t&n,h8=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),on=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),an=new Uint32Array(64);class eg extends u8{constructor(){super(64,32,8,!1),this.A=on[0]|0,this.B=on[1]|0,this.C=on[2]|0,this.D=on[3]|0,this.E=on[4]|0,this.F=on[5]|0,this.G=on[6]|0,this.H=on[7]|0}get(){const{A:t,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[t,n,r,i,s,o,a,c]}set(t,n,r,i,s,o,a,c){this.A=t|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(t,n){for(let f=0;f<16;f++,n+=4)an[f]=t.getUint32(n,!1);for(let f=16;f<64;f++){const d=an[f-15],h=an[f-2],g=it(d,7)^it(d,18)^d>>>3,p=it(h,17)^it(h,19)^h>>>10;an[f]=p+an[f-7]+g+an[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const d=it(a,6)^it(a,11)^it(a,25),h=u+d+f8(a,c,l)+h8[f]+an[f]|0,p=(it(r,2)^it(r,13)^it(r,22))+d8(r,i,s)|0;u=l,l=c,c=a,a=o+h|0,o=s,s=i,i=r,r=h+p|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){an.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class p8 extends eg{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const br=X0(()=>new eg);X0(()=>new p8);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function mr(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function zt(...e){const t=(i,s)=>o=>i(s(o)),n=Array.from(e).reverse().reduce((i,s)=>i?t(i,s.encode):s.encode,void 0),r=e.reduce((i,s)=>i?t(i,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Vt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(mr(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function Kt(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Cs(e,t="="){if(mr(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of n)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function tg(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Gu(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach(o=>{if(mr(o),o<0||o>=t)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],u=t*o+l;if(!Number.isSafeInteger(u)||t*o/t!==o||u-l!==t*o)throw new Error("convertRadix: carry overflow");if(o=u%n,s[c]=Math.floor(u/n),!Number.isSafeInteger(s[c])||s[c]*n+o!==u)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(i.push(o),a)break}for(let o=0;o<e.length-1&&e[o]===0;o++)i.push(0);return i.reverse()}const ng=(e,t)=>t?ng(t,e%t):e,Fi=(e,t)=>e+(t-ng(e,t));function sa(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Fi(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Fi(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const c of e){if(mr(c),c>=2**t)throw new Error(`convertRadix2: invalid data word=${c} from=${t}`);if(i=i<<t|c,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function g8(e){return mr(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Gu(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Gu(t,e,2**8))}}}function bn(e,t=!1){if(mr(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Fi(8,e)>32||Fi(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return sa(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(sa(n,e,8,t))}}}function Zu(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const y8=zt(bn(4),Vt("0123456789ABCDEF"),Kt("")),w8=zt(bn(5),Vt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Cs(5),Kt(""));zt(bn(5),Vt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Cs(5),Kt(""));zt(bn(5),Vt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Kt(""),tg(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Nt=zt(bn(6),Vt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Cs(6),Kt("")),v8=zt(bn(6),Vt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Cs(6),Kt("")),il=e=>zt(g8(58),Vt(e),Kt("")),oa=il("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");il("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");il("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ju=[0,2,3,5,6,7,9,10,11],b8={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=oa.encode(r).padStart(Ju[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=Ju.indexOf(r.length),s=oa.decode(r);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},aa=zt(Vt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Kt("")),Xu=[996825010,642813549,513874426,1027748829,705979059];function _r(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Xu.length;r++)(t>>r&1)===1&&(n^=Xu[r]);return n}function Qu(e,t,n=1){const r=e.length;let i=1;for(let s=0;s<r;s++){const o=e.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${e})`);i=_r(i)^o>>5}i=_r(i);for(let s=0;s<r;s++)i=_r(i)^e.charCodeAt(s)&31;for(let s of t)i=_r(i)^s;for(let s=0;s<6;s++)i=_r(i);return i^=n,aa.encode(sa([i%2**30],30,5,!1))}function rg(e){const t=e==="bech32"?1:734539939,n=bn(5),r=n.decode,i=n.encode,s=Zu(r);function o(u,f,d=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const h=u.length+7+f.length;if(d!==!1&&h>d)throw new TypeError(`Length ${h} exceeds limit ${d}`);return u=u.toLowerCase(),`${u}1${aa.encode(f)}${Qu(u,f,t)}`}function a(u,f=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||f!==!1&&u.length>f)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${f})`);const d=u.toLowerCase();if(u!==d&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=d;const h=u.lastIndexOf("1");if(h===0||h===-1)throw new Error('Letter "1" must be present between prefix and data only');const g=u.slice(0,h),p=u.slice(h+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");const y=aa.decode(p).slice(0,-6),v=Qu(g,y,t);if(!p.endsWith(v))throw new Error(`Invalid checksum in ${u}: expected "${v}"`);return{prefix:g,words:y}}const c=Zu(a);function l(u){const{prefix:f,words:d}=a(u,!1);return{prefix:f,words:d,bytes:r(d)}}return{encode:o,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:i}}const fr=rg("bech32");rg("bech32m");const m8={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},x8=zt(bn(4),Vt("0123456789abcdef"),Kt(""),tg(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),E8={utf8:m8,hex:x8,base16:y8,base32:w8,base64:Nt,base64url:v8,base58:oa,base58xmr:b8};`${Object.keys(E8).join(", ")}`;class ig extends J0{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ft.hash(t);const r=qr(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?t.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=t.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(t){return ft.exists(this),this.iHash.update(t),this}digestInto(t){ft.exists(this),ft.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return t=t,t.finished=i,t.destroyed=s,t.blockLen=o,t.outputLen=a,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Rs=(e,t,n)=>new ig(e,t).update(n).digest();Rs.create=(e,t)=>new ig(e,t);function $8(e,t,n){return ft.hash(e),Rs(e,qr(n),qr(t))}const bo=new Uint8Array([0]),Yu=new Uint8Array;function S8(e,t,n,r=32){if(ft.hash(e),ft.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);n===void 0&&(n=Yu);const s=new Uint8Array(i*e.outputLen),o=Rs.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let l=0;l<i;l++)bo[0]=l+1,a.update(l===0?Yu:c).update(n).update(bo).digestInto(c),s.set(c,e.outputLen*l),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),bo.fill(0),s.slice(0,r)}var _8=Object.defineProperty,Q=(e,t)=>{for(var n in t)_8(e,n,{get:t[n],enumerable:!0})},Kn=Symbol("verified"),k8=e=>e instanceof Object;function sl(e){if(!k8(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var A8={};Q(A8,{Queue:()=>T8,QueueNode:()=>sg,binarySearch:()=>ol,bytesToHex:()=>xe,hexToBytes:()=>Mn,insertEventIntoAscendingList:()=>L8,insertEventIntoDescendingList:()=>R8,normalizeURL:()=>C8,utf8Decoder:()=>Ct,utf8Encoder:()=>Xe});var Ct=new TextDecoder("utf-8"),Xe=new TextEncoder;function C8(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function R8(e,t){const[n,r]=ol(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function L8(e,t){const[n,r]=ol(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return r||e.splice(n,0,t),e}function ol(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var sg=class{value;next=null;prev=null;constructor(e){this.value=e}},T8=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new sg(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},I8=class{generateSecretKey(){return oe.utils.randomPrivateKey()}getPublicKey(e){return xe(oe.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=xe(oe.getPublicKey(t)),n.id=vi(n),n.sig=xe(oe.sign(vi(n),t)),n[Kn]=!0,n}verifyEvent(e){if(typeof e[Kn]=="boolean")return e[Kn];const t=vi(e);if(t!==e.id)return e[Kn]=!1,!1;try{const n=oe.verify(e.sig,t,e.pubkey);return e[Kn]=n,n}catch{return e[Kn]=!1,!1}}};function U8(e){if(!sl(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function vi(e){let t=br(Xe.encode(U8(e)));return xe(t)}var Ls=new I8,O8=Ls.generateSecretKey,al=Ls.getPublicKey,gt=Ls.finalizeEvent,cl=Ls.verifyEvent,Cn={};Q(Cn,{Application:()=>UC,BadgeAward:()=>j8,BadgeDefinition:()=>kC,BlockedRelaysList:()=>uC,BookmarkList:()=>aC,Bookmarksets:()=>$C,Calendar:()=>FC,CalendarEventRSVP:()=>DC,ChannelCreation:()=>fg,ChannelHideMessage:()=>pg,ChannelMessage:()=>hg,ChannelMetadata:()=>dg,ChannelMuteUser:()=>gg,ClassifiedListing:()=>BC,ClientAuth:()=>wg,CommunitiesList:()=>cC,CommunityDefinition:()=>qC,CommunityPostApproval:()=>J8,Contacts:()=>H8,CreateOrUpdateProduct:()=>RC,CreateOrUpdateStall:()=>CC,Curationsets:()=>SC,Date:()=>PC,DirectMessageRelaysList:()=>pC,DraftClassifiedListing:()=>MC,DraftLong:()=>TC,Emojisets:()=>IC,EncryptedDirectMessage:()=>F8,EventDeletion:()=>D8,FileMetadata:()=>q8,FileServerPreference:()=>gC,Followsets:()=>mC,GenericRepost:()=>hl,Genericlists:()=>xC,GiftWrap:()=>yg,HTTPAuth:()=>pl,Handlerinformation:()=>WC,Handlerrecommendation:()=>jC,Highlights:()=>rC,InterestsList:()=>dC,Interestsets:()=>AC,JobFeedback:()=>Y8,JobRequest:()=>X8,JobResult:()=>Q8,Label:()=>Z8,LightningPubRPC:()=>wC,LiveChatMessage:()=>z8,LiveEvent:()=>OC,LongFormArticle:()=>LC,Metadata:()=>M8,Mutelist:()=>iC,NWCWalletInfo:()=>yC,NWCWalletRequest:()=>vg,NWCWalletResponse:()=>vC,NostrConnect:()=>bC,OpenTimestamps:()=>W8,Pinlist:()=>sC,PrivateDirectMessage:()=>ug,ProblemTracker:()=>V8,ProfileBadges:()=>_C,PublicChatsList:()=>lC,Reaction:()=>dl,RecommendRelay:()=>P8,RelayList:()=>oC,Relaysets:()=>EC,Report:()=>K8,Reporting:()=>G8,Repost:()=>fl,Seal:()=>lg,SearchRelaysList:()=>fC,ShortTextNote:()=>cg,Time:()=>HC,UserEmojiList:()=>hC,UserStatuses:()=>NC,Zap:()=>nC,ZapGoal:()=>eC,ZapRequest:()=>tC,classifyKind:()=>N8,isAddressableKind:()=>ul,isEphemeralKind:()=>ag,isKind:()=>B8,isRegularKind:()=>og,isReplaceableKind:()=>ll});function og(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function ll(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function ag(e){return 2e4<=e&&e<3e4}function ul(e){return 3e4<=e&&e<4e4}function N8(e){return og(e)?"regular":ll(e)?"replaceable":ag(e)?"ephemeral":ul(e)?"parameterized":"unknown"}function B8(e,t){const n=t instanceof Array?t:[t];return sl(e)&&n.includes(e.kind)||!1}var M8=0,cg=1,P8=2,H8=3,F8=4,D8=5,fl=6,dl=7,j8=8,lg=13,ug=14,hl=16,fg=40,dg=41,hg=42,pg=43,gg=44,W8=1040,yg=1059,q8=1063,z8=1311,V8=1971,K8=1984,G8=1984,Z8=1985,J8=4550,X8=5999,Q8=6999,Y8=7e3,eC=9041,tC=9734,nC=9735,rC=9802,iC=1e4,sC=10001,oC=10002,aC=10003,cC=10004,lC=10005,uC=10006,fC=10007,dC=10015,hC=10030,pC=10050,gC=10096,yC=13194,wC=21e3,wg=22242,vg=23194,vC=23195,bC=24133,pl=27235,mC=3e4,xC=30001,EC=30002,$C=30003,SC=30004,_C=30008,kC=30009,AC=30015,CC=30017,RC=30018,LC=30023,TC=30024,IC=30030,UC=30078,OC=30311,NC=30315,BC=30402,MC=30403,PC=31922,HC=31923,FC=31924,DC=31925,jC=31989,WC=31990,qC=34550,zC={};Q(zC,{getHex64:()=>gl,getInt:()=>bg,getSubscriptionId:()=>VC,matchEventId:()=>KC,matchEventKind:()=>ZC,matchEventPubkey:()=>GC});function gl(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function bg(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function VC(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return e.slice(r+1,s)}function KC(e,t){return t===gl(e,"id")}function GC(e,t){return t===gl(e,"pubkey")}function ZC(e,t){return t===bg(e,"kind")}var JC={};Q(JC,{makeAuthEvent:()=>XC});function XC(e,t){return{kind:wg,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var QC;try{QC=WebSocket}catch{}var YC;try{YC=WebSocket}catch{}var e6={};Q(e6,{BECH32_REGEX:()=>mg,Bech32MaxSize:()=>yl,NostrTypeGuard:()=>t6,decode:()=>Ts,decodeNostrURI:()=>r6,encodeBytes:()=>Us,naddrEncode:()=>l6,neventEncode:()=>c6,noteEncode:()=>o6,nprofileEncode:()=>a6,npubEncode:()=>s6,nsecEncode:()=>i6});var t6={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},yl=5e3,mg=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function n6(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function r6(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),Ts(e)}catch{return{type:"invalid",data:null}}}function Ts(e){let{prefix:t,words:n}=fr.decode(e,yl),r=new Uint8Array(fr.fromWords(n));switch(t){case"nprofile":{let i=mo(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:xe(i[0][0]),relays:i[1]?i[1].map(s=>Ct.decode(s)):[]}}}case"nevent":{let i=mo(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:xe(i[0][0]),relays:i[1]?i[1].map(s=>Ct.decode(s)):[],author:i[2]?.[0]?xe(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(xe(i[3][0]),16):void 0}}}case"naddr":{let i=mo(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Ct.decode(i[0][0]),pubkey:xe(i[2][0]),kind:parseInt(xe(i[3][0]),16),relays:i[1]?i[1].map(s=>Ct.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:xe(r)};default:throw new Error(`unknown prefix ${t}`)}}function mo(e){let t={},n=e;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function i6(e){return Us("nsec",e)}function s6(e){return Us("npub",Mn(e))}function o6(e){return Us("note",Mn(e))}function Is(e,t){let n=fr.toWords(t);return fr.encode(e,n,yl)}function Us(e,t){return Is(e,t)}function a6(e){let t=wl({0:[Mn(e.pubkey)],1:(e.relays||[]).map(n=>Xe.encode(n))});return Is("nprofile",t)}function c6(e){let t;e.kind!==void 0&&(t=n6(e.kind));let n=wl({0:[Mn(e.id)],1:(e.relays||[]).map(r=>Xe.encode(r)),2:e.author?[Mn(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Is("nevent",n)}function l6(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=wl({0:[Xe.encode(e.identifier)],1:(e.relays||[]).map(r=>Xe.encode(r)),2:[Mn(e.pubkey)],3:[new Uint8Array(t)]});return Is("naddr",n)}function wl(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),t.push(s)})}),As(...t)}var u6={};Q(u6,{decrypt:()=>f6,encrypt:()=>xg});function xg(e,t,n){const r=e instanceof Uint8Array?xe(e):e,i=Le.getSharedSecret(r,"02"+t),s=Eg(i);let o=Uint8Array.from(Q0(16)),a=Xe.encode(n),c=gn(s,o).encrypt(a),l=Nt.encode(new Uint8Array(c)),u=Nt.encode(new Uint8Array(o.buffer));return`${l}?iv=${u}`}function f6(e,t,n){const r=e instanceof Uint8Array?xe(e):e;let[i,s]=n.split("?iv="),o=Le.getSharedSecret(r,"02"+t),a=Eg(o),c=Nt.decode(s),l=Nt.decode(i),u=gn(a,c).decrypt(l);return Ct.decode(u)}function Eg(e){return e.slice(1,33)}var d6={};Q(d6,{NIP05_REGEX:()=>vl,isNip05:()=>h6,isValid:()=>y6,queryProfile:()=>$g,searchDomain:()=>g6,useFetchImplementation:()=>p6});var vl=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,h6=e=>vl.test(e||""),Os;try{Os=fetch}catch{}function p6(e){Os=e}async function g6(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await Os(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function $g(e){const t=e.match(vl);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await Os(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[n];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function y6(e,t){const n=await $g(t);return n?n.pubkey===e:!1}var w6={};Q(w6,{parse:()=>v6});function v6(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if(s[0]==="e"&&s[1]){const[o,a,c,l,u]=s,f={id:a,relays:c?[c]:[],author:u};if(l==="root"){t.root=f;continue}if(l==="reply"){t.reply=f;continue}if(l==="mention"){t.mentions.push(f);continue}n?r=f:n=f,t.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,c]=s;t.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let s=t.mentions.indexOf(i);if(s!==-1&&t.mentions.splice(s,1),i.author){let o=t.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let s=t.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),t}var b6={};Q(b6,{fetchRelayInformation:()=>x6,useFetchImplementation:()=>m6});var Sg;try{Sg=fetch}catch{}function m6(e){Sg=e}async function x6(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var E6={};Q(E6,{fastEventHash:()=>kg,getPow:()=>_g,minePow:()=>$6});function _g(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function $6(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=kg(r),_g(r.id)>=t)break}return r}function kg(e){return xe(br(Xe.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var S6={};Q(S6,{unwrapEvent:()=>B6,unwrapManyEvents:()=>M6,wrapEvent:()=>Hg,wrapManyEvents:()=>N6});var _6={};Q(_6,{createRumor:()=>Ng,createSeal:()=>Bg,createWrap:()=>Mg,unwrapEvent:()=>$l,unwrapManyEvents:()=>Pg,wrapEvent:()=>Di,wrapManyEvents:()=>U6});var k6={};Q(k6,{decrypt:()=>El,encrypt:()=>xl,getConversationKey:()=>bl,v2:()=>T6});var Ag=1,Cg=65535;function bl(e,t){const n=Le.getSharedSecret(e,"02"+t).subarray(1,33);return $8(br,n,"nip44-v2")}function Rg(e,t){const n=S8(br,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function ml(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function A6(e){if(!Number.isSafeInteger(e)||e<Ag||e>Cg)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function C6(e){const t=Xe.encode(e),n=t.length,r=A6(n),i=new Uint8Array(ml(n)-n);return As(r,t,i)}function R6(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Ag||t>Cg||n.length!==t||e.length!==2+ml(t))throw new Error("invalid padding");return Ct.decode(n)}function Lg(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=As(n,t);return Rs(br,e,r)}function L6(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=Nt.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function xl(e,t,n=Q0(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=Rg(t,n),o=C6(e),a=yn(r,i,o),c=Lg(s,a,n);return Nt.encode(As(new Uint8Array([2]),n,a,c))}function El(e,t){const{nonce:n,ciphertext:r,mac:i}=L6(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=Rg(t,n),c=Lg(a,r,n);if(!Xi(c,i))throw new Error("invalid MAC");const l=yn(s,o,r);return R6(l)}var T6={utils:{getConversationKey:bl,calcPaddedLen:ml},encrypt:xl,decrypt:El},I6=2*24*60*60,Tg=()=>Math.round(Date.now()/1e3),Ig=()=>Math.round(Tg()-Math.random()*I6),Ug=(e,t)=>bl(e,t),Og=(e,t,n)=>xl(JSON.stringify(e),Ug(t,n)),ef=(e,t)=>JSON.parse(El(e.content,Ug(t,e.pubkey)));function Ng(e,t){const n={created_at:Tg(),content:"",tags:[],...e,pubkey:al(t)};return n.id=vi(n),n}function Bg(e,t,n){return gt({kind:lg,content:Og(e,t,n),created_at:Ig(),tags:[]},t)}function Mg(e,t){const n=O8();return gt({kind:yg,content:Og(e,n,t),created_at:Ig(),tags:[["p",t]]},n)}function Di(e,t,n){const r=Ng(e,t),i=Bg(r,t,n);return Mg(i,n)}function U6(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=al(t),i=[Di(e,t,r)];return n.forEach(s=>{i.push(Di(e,t,s))}),i}function $l(e,t){const n=ef(e,t);return ef(n,t)}function Pg(e,t){let n=[];return e.forEach(r=>{n.push($l(r,t))}),n.sort((r,i)=>r.created_at-i.created_at),n}function O6(e,t,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:ug,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function Hg(e,t,n,r,i){const s=O6(t,n,r,i);return Di(s,e,t.publicKey)}function N6(e,t,n,r,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:al(e)},...t].map(o=>Hg(e,o,n,r,i))}var B6=$l,M6=Pg,P6={};Q(P6,{finishRepostEvent:()=>H6,getRepostedEvent:()=>F6,getRepostedEventPointer:()=>Fg});function H6(e,t,n,r){let i;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===cg?i=fl:(i=hl,s.push(["k",String(t.kind)])),gt({kind:i,tags:s,content:e.content===""||t.tags?.find(o=>o[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function Fg(e){if(![fl,hl].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function F6(e,{skipVerification:t}={}){const n=Fg(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!cl(r)))return r}var D6={};Q(D6,{NOSTR_URI_REGEX:()=>Sl,parse:()=>W6,test:()=>j6});var Sl=new RegExp(`nostr:(${mg.source})`);function j6(e){return typeof e=="string"&&new RegExp(`^${Sl.source}$`).test(e)}function W6(e){const t=e.match(new RegExp(`^${Sl.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:Ts(t[1])}}var q6={};Q(q6,{finishReactionEvent:()=>z6,getReactedEventPointer:()=>V6});function z6(e,t,n){const r=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return gt({...e,kind:dl,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function V6(e){if(e.kind!==dl)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var K6={};Q(K6,{parse:()=>Z6});var G6=/\W/m,tf=/\W |\W$|$|,| /m;function*Z6(e){const t=e.length;let n=0,r=0;for(;r<t;){let i=e.indexOf(":",r);if(i===-1)break;if(e.substring(i-5,i)==="nostr"){const s=e.substring(i+60).match(G6),o=s?i+60+s.index:t;try{let a,{data:c,type:l}=Ts(e.substring(i+1,o));switch(l){case"npub":a={pubkey:c};break;case"nsec":case"note":r=o+1;continue;default:a=c}n!==i-5&&(yield{type:"text",text:e.substring(n,i-5)}),yield{type:"reference",pointer:a},r=o,n=r;continue}catch{r=i+1;continue}}else if(e.substring(i-5,i)==="https"||e.substring(i-4,i)==="http"){const s=e.substring(i+4).match(tf),o=s?i+4+s.index:t,a=e[i-1]==="s"?5:4;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),c.pathname.endsWith(".png")||c.pathname.endsWith(".jpg")||c.pathname.endsWith(".jpeg")||c.pathname.endsWith(".gif")||c.pathname.endsWith(".webp")){yield{type:"image",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp4")||c.pathname.endsWith(".avi")||c.pathname.endsWith(".webm")||c.pathname.endsWith(".mkv")){yield{type:"video",url:c.toString()},r=o,n=r;continue}if(c.pathname.endsWith(".mp3")||c.pathname.endsWith(".aac")||c.pathname.endsWith(".ogg")||c.pathname.endsWith(".opus")){yield{type:"audio",url:c.toString()},r=o,n=r;continue}yield{type:"url",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else if(e.substring(i-3,i)==="wss"||e.substring(i-2,i)==="ws"){const s=e.substring(i+4).match(tf),o=s?i+4+s.index:t,a=e[i-1]==="s"?3:2;try{let c=new URL(e.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==i-a&&(yield{type:"text",text:e.substring(n,i-a)}),yield{type:"relay",url:c.toString()},r=o,n=r;continue}catch{r=o+1;continue}}else{r=i+1;continue}}n!==t&&(yield{type:"text",text:e.substring(n)})}var J6={};Q(J6,{channelCreateEvent:()=>X6,channelHideMessageEvent:()=>e5,channelMessageEvent:()=>Y6,channelMetadataEvent:()=>Q6,channelMuteUserEvent:()=>t5});var X6=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return gt({kind:fg,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Q6=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return gt({kind:dg,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Y6=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),gt({kind:hg,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},e5=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return gt({kind:pg,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},t5=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return gt({kind:gg,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},n5={};Q(n5,{EMOJI_SHORTCODE_REGEX:()=>Dg,matchAll:()=>r5,regex:()=>_l,replaceAll:()=>i5});var Dg=/:(\w+):/,_l=()=>new RegExp(`\\B${Dg.source}\\B`,"g");function*r5(e){const t=e.matchAll(_l());for(const n of t)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function i5(e,t){return e.replaceAll(_l(),(n,r)=>t({shortcode:n,name:r}))}var s5={};Q(s5,{useFetchImplementation:()=>o5,validateGithub:()=>a5});var kl;try{kl=fetch}catch{}function o5(e){kl=e}async function a5(e,t,n){try{return await(await kl(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var c5={};Q(c5,{makeNwcRequestEvent:()=>u5,parseConnectionString:()=>l5});function l5(e){const{host:t,pathname:n,searchParams:r}=new URL(e),i=n||t,s=r.get("relay"),o=r.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function u5(e,t,n){const i=xg(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:vg,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return gt(s,t)}var f5={};Q(f5,{normalizeIdentifier:()=>d5});function d5(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var h5={};Q(h5,{getSatoshisAmountFromBolt11:()=>b5,getZapEndpoint:()=>g5,makeZapReceipt:()=>v5,makeZapRequest:()=>y5,useFetchImplementation:()=>p5,validateZapRequest:()=>w5});var Al;try{Al=fetch}catch{}function p5(e){Al=e}async function g5(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:o}=fr.decode(n,1e3),a=fr.fromWords(o);t=Ct.decode(a)}else if(r){let[o,a]=r.split("@");t=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await Al(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function y5({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};if(t&&typeof t=="string"&&s.tags.push(["e",t]),t&&typeof t=="object"){if(ll(t.kind)){const o=["a",`${t.kind}:${t.pubkey}:`];s.tags.push(o)}else if(ul(t.kind)){let o=t.tags.find(([c,l])=>c==="d"&&l);if(!o)throw new Error("d tag not found or is empty");const a=["a",`${t.kind}:${t.pubkey}:${o[1]}`];s.tags.push(a)}}return s}function w5(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!sl(t))return"Zap request is not a valid Nostr event.";if(!cl(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,o])=>s==="p"&&o);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,o])=>s==="e"&&o);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function v5({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}function b5(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=r.length-1;if(o&&a++,a<1)return 0;const c=parseInt(r.substring(0,a));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var m5={};Q(m5,{getToken:()=>x5,hashPayload:()=>Cl,unpackEventFromToken:()=>Wg,validateEvent:()=>Zg,validateEventKind:()=>zg,validateEventMethodTag:()=>Kg,validateEventPayloadTag:()=>Gg,validateEventTimestamp:()=>qg,validateEventUrlTag:()=>Vg,validateToken:()=>E5});var jg="Nostr ";async function x5(e,t,n,r=!1,i){const s={kind:pl,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",Cl(i)]);const o=await n(s);return(r?jg:"")+Nt.encode(Xe.encode(JSON.stringify(o)))}async function E5(e,t,n){const r=await Wg(e).catch(s=>{throw s});return await Zg(r,t,n).catch(s=>{throw s})}async function Wg(e){if(!e)throw new Error("Missing token");e=e.replace(jg,"");const t=Ct.decode(Nt.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function qg(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function zg(e){return e.kind===pl}function Vg(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Kg(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Cl(e){const t=br(Xe.encode(JSON.stringify(e)));return xe(t)}function Gg(e,t){const n=e.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=Cl(t);return n.length>0&&n[1]===r}async function Zg(e,t,n,r){if(!cl(e))throw new Error("Invalid nostr event, signature invalid");if(!zg(e))throw new Error("Invalid nostr event, kind invalid");if(!qg(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Vg(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Kg(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Gg(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}Cn.Contacts,Cn.Mutelist,Cn.Pinlist,Cn.BookmarkList;Cn.Bookmarksets,Cn.Followsets;const nf=Math.floor(Date.now()/1e3-1800);class $5{eventStore;pool;eventLoader;addressLoader;defaultRelays=["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://relay.snort.social","wss://relay.primal.net","wss://nostr.mom"];relayStatuses$=new he(new Map);eventsByKind$=new he({});totalEvents$=new he(0);dbQuota$=new he({used:0,total:0});events$=new he(null);relayStatuses=new Map;eventCounts={};hashtagEvents=new Map;hashtagRelayDistribution=new Map;stopCleanup$=new he(!1);constructor(){this.eventStore=new Ur,this.pool=new BA,this.eventLoader=t8(this.pool,{eventStore:this.eventStore,extraRelays:this.defaultRelays}),this.addressLoader=GA(this.pool,{eventStore:this.eventStore,extraRelays:this.defaultRelays}),this.initializeRelayStatuses(),this.startEventSubscriptions(),this.startCleanupTimer(),this.updateDbQuota()}initializeRelayStatuses(){this.defaultRelays.forEach(t=>{this.relayStatuses.set(t,{url:t,connected:!1,eventsReceived:0})}),this.relayStatuses$.next(new Map(this.relayStatuses))}startEventSubscriptions(){const t=this.defaultRelays.map(n=>this.pool.relay(n).subscription({kinds:[0,1,20,21,22,10002,1063],since:nf}).pipe(Yo(),ce(r=>this.handleEvent(r,n)),Ce(r=>(console.error(`Relay ${n} error:`,r),this.updateRelayStatus(n,!1,r.message),se))));Ee(...t).subscribe({next:n=>{this.eventStore.add(n),this.updateEventCounts(n),this.trackHashtagEvents(n),this.updateDbQuota(),this.events$.next(n)},error:n=>{console.error("Subscription error:",n)}})}handleEvent(t,n){this.updateRelayStatus(n,!0),this.trackHashtagRelayDistribution(t,n),t.kind===1&&this.fetchUserProfile(t.pubkey),t.kind===0&&this.fetchUserRelayList(t.pubkey)}updateRelayStatus(t,n,r){const i=this.relayStatuses.get(t);i&&(i.connected=n,n?(i.eventsReceived+=1,i.lastActivity=new Date,i.error=void 0):r&&(i.error=r),this.relayStatuses.set(t,i),this.relayStatuses$.next(new Map(this.relayStatuses)))}trackHashtagEvents(t){t.tags.filter(r=>r[0]==="t"&&r[1]).map(r=>r[1].toLowerCase()).forEach(r=>{this.hashtagEvents.has(r)||this.hashtagEvents.set(r,[]);const i=this.hashtagEvents.get(r);i.some(s=>s.id===t.id)||i.unshift(t),i.length>100&&i.splice(100)})}trackHashtagRelayDistribution(t,n){t.tags.filter(i=>i[0]==="t"&&i[1]).map(i=>i[1].toLowerCase()).forEach(i=>{this.hashtagRelayDistribution.has(i)||this.hashtagRelayDistribution.set(i,new Map);const s=this.hashtagRelayDistribution.get(i);s.set(n,(s.get(n)||0)+1)})}updateEventCounts(t){this.eventCounts[t.kind]=(this.eventCounts[t.kind]||0)+1,this.eventsByKind$.next({...this.eventCounts});const n=Object.values(this.eventCounts).reduce((r,i)=>r+i,0);this.totalEvents$.next(n)}fetchUserProfile(t){this.eventStore.getReplaceable(0,t)||this.addressLoader({kind:0,pubkey:t,relays:this.defaultRelays}).pipe(Ce(r=>(console.error("Error fetching profile for",t,r),se))).subscribe()}fetchUserRelayList(t){this.addressLoader({kind:10002,pubkey:t,relays:this.defaultRelays}).pipe(Ce(n=>(console.error("Error fetching relay list for",t,n),se)),ce(n=>{n&&this.processRelayListEvent(n)})).subscribe()}processRelayListEvent(t){const r=t.tags.filter(i=>i[0]==="r"&&i[1]).map(i=>i[1]).filter(i=>!this.relayStatuses.has(i));r.length>0&&r.forEach(i=>{this.connectToRelay(i)})}startCleanupTimer(){Nn(0,10*60*1e3).pipe(Ir(this.stopCleanup$),cn(()=>be(this.cleanupOldEvents()))).subscribe()}cleanupOldEvents(){const t=this.totalEvents$.value,n=Math.max(0,t-1e3);for(let r=0;r<n;r++)console.log(`Would remove old event #${r}`);return this.updateDbQuota(),n}updateDbQuota(){const t=this.totalEvents$.value,n=Array.from(this.hashtagEvents.values()).reduce((l,u)=>l+u.length,0),r=t*600,i=0,s=n*50,o=this.relayStatuses.size*200,a=r+i+s+o,c=150*1024*1024;this.dbQuota$.next({used:Math.max(a,1024),total:c})}getEventStore(){return this.eventStore}getRelayPool(){return this.pool}connectToRelay(t){this.relayStatuses.has(t)||this.relayStatuses.set(t,{url:t,connected:!1,eventsReceived:0}),this.pool.relay(t).subscription({kinds:[0,1,20,21,22,10002,1063],since:nf}).pipe(Yo(),ce(n=>this.handleEvent(n,t)),Ce(n=>(console.error(`New relay ${t} error:`,n),this.updateRelayStatus(t,!1,n.message),se))).subscribe(n=>{this.eventStore.add(n),this.updateEventCounts(n),this.trackHashtagEvents(n),this.updateDbQuota(),this.events$.next(n)})}disconnect(){this.stopCleanup$.next(!0)}removeRelay(t){this.pool.remove(t),this.relayStatuses.delete(t),this.relayStatuses$.next(new Map(this.relayStatuses))}getHashtagEvents(t){return this.hashtagEvents.get(t.toLowerCase())||[]}getAllHashtagEvents(){return new Map(this.hashtagEvents)}getHashtagRelayDistribution(t){const n=this.hashtagRelayDistribution.get(t.toLowerCase());return n?Array.from(n.entries()).map(([r,i])=>({relay:r,count:i})):[]}}var S5=D("<div class=panel-overlay>"),_5=D("<div class=panel-content>"),k5=D('<div class="min-h-screen flex flex-col bg-wireframe-50 text-wireframe-900 font-mono"><main class="flex-1 overflow-auto">');const A5=()=>{let e=[];const t=new $5;ca(()=>{const i=Date.now(),s=setInterval(()=>{U.stats.setStat("uptime",Date.now()-i)},1e3);e.push(()=>clearInterval(s));const o=t.relayStatuses$.subscribe(f=>{const d=Array.from(f.values()).map(h=>({url:h.url,enabled:!0,read:!0,write:!0,metrics:{url:h.url,connected:h.connected,connectionTime:0,eventsReceived:h.eventsReceived,lastEventTime:h.lastActivity?.getTime()||0,latency:0,errors:0,subscriptions:0,error:h.error}}));U.relays.setRelays(d),U.stats.setStat("activeRelays",d.filter(h=>h.metrics.connected).length)}),a=t.events$.subscribe(f=>{if(!f)return;if(U.stats.setStat("lastUpdate",Date.now()),f.kind===0)try{const h=JSON.parse(f.content);h.pubkey=f.pubkey,U.profiles.setProfile(h)}catch(h){console.error("Error parsing profile content",h)}f.tags.filter(h=>h[0]==="t").map(h=>h[1]).forEach(h=>{U.hashtags.updateHashtagCount(h,f.created_at)}),U.stats.setStat("uniqueHashtags",U.hashtags.hashtags.length)}),c=t.totalEvents$.subscribe(f=>{U.stats.setStat("eventsReceived",f)});e.push(()=>{o.unsubscribe(),a.unsubscribe(),c.unsubscribe(),t.disconnect()});const l=f=>{f.key==="Escape"&&(U.ui.closePanel(),U.hashtags.setSelectedHashtag(null)),f.key==="/"&&(f.ctrlKey||f.metaKey)&&(f.preventDefault(),document.getElementById("search-input")?.focus())};document.addEventListener("keydown",l),e.push(()=>document.removeEventListener("keydown",l));const u=fy();e.push(u)}),Wi(()=>{e.forEach(i=>i())});const n=()=>{U.ui.closePanel()},r=()=>dy()==="hashtag"?()=>q(x2,{nostrService:t}):()=>q(z1,{});return(()=>{var i=k5(),s=i.firstChild;return T(i,q(P1,{}),s),T(s,()=>r()()),T(i,q(Z1,{nostrService:t}),null),T(i,q(Fe,{get when(){return U.ui.activePanel()},get children(){var o=S5();return o.$$click=n,o}}),null),T(i,q(Fe,{get when(){return U.ui.activePanel()==="relay"},get children(){var o=_5();return T(o,q(t2,{nostrService:t})),o}}),null),i})()};Vr(["click"]);const C5=document.getElementById("root");cy(()=>q(A5,{}),C5);
